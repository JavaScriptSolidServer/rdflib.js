!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(function(){try{return require("window")}catch(t){}}()):"function"==typeof define&&define.amd?define(["window"],e):"object"==typeof exports?exports.$rdf=e(function(){try{return require("window")}catch(t){}}()):t.$rdf=e(t.window)}(self,t=>(()=>{var e,r,n,s,i={312(t,e){var r,n;void 0===(n="function"==typeof(r=function(){"use strict";function t(e,r,n,s){this.message=e,this.expected=r,this.found=n,this.location=s,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}return function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}(t,Error),t.buildMessage=function(t,e){var r={literal:function(t){return'"'+s(t.text)+'"'},class:function(t){var e,r="";for(e=0;e<t.parts.length;e++)r+=t.parts[e]instanceof Array?i(t.parts[e][0])+"-"+i(t.parts[e][1]):i(t.parts[e]);return"["+(t.inverted?"^":"")+r+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function s(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+n(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+n(t)})}function i(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+n(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+n(t)})}function a(t){return r[t.type](t)}return"Expected "+function(t){var e,r,n=new Array(t.length);for(e=0;e<t.length;e++)n[e]=a(t[e]);if(n.sort(),n.length>0){for(e=1,r=1;e<n.length;e++)n[e-1]!==n[e]&&(n[r]=n[e],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(t)+" but "+function(t){return t?'"'+s(t)+'"':"end of input"}(e)+" found."},{SyntaxError:t,parse:function(e,r){r=void 0!==r?r:{};var n,s={},i={turtleDoc:Qr},a=Qr,o=function(t){var e=An.toJSON();return e["@graph"]=[],t.filter(t=>Array.isArray(t)).forEach(t=>{t.forEach(t=>{e["@graph"].push(t)})}),1===e["@graph"].length&&(Object.assign(e,e["@graph"][0]),delete e["@graph"]),e},h="\ufeff",l=Br("\ufeff",!1),c=".",u=Br(".",!1),d=function(t){return t},f="#",p=Br("#",!1),m=/^[^\n]/,w=Vr(["\n"],!0,!1),g="\n",v=Br("\n",!1),b=function(t){return t.join("")},y="@prefix",T=Br("@prefix",!1),x=function(t,e){return An.addPrefix(""===t?"0":t,e),{}},N="@base",A=Br("@base",!1),C=function(t){return An.addBase(t),{}},O=/^[Bb]/,E=Vr(["B","b"],!1,!1),R=/^[Aa]/,S=Vr(["A","a"],!1,!1),k=/^[Ss]/,j=Vr(["S","s"],!1,!1),I=/^[Ee]/,F=Vr(["E","e"],!1,!1),D=/^[Pp]/,M=Vr(["P","p"],!1,!1),L=/^[Rr]/,_=Vr(["R","r"],!1,!1),U=/^[Ff]/,P=Vr(["F","f"],!1,!1),q=/^[Ii]/,H=Vr(["I","i"],!1,!1),X=/^[Xx]/,B=Vr(["X","x"],!1,!1),V=function(t,e){var r={};return"string"==typeof t&&"[]"!==t?r["@id"]=t:"object"==typeof t&&Object.assign(r,t),e&&Object.assign(r,e),[r]},z=function(t,e){var r={};return t&&Object.assign(r,t),e&&Object.assign(r,e),[r]},$=";",W=Br(";",!1),Q=function(t,e,r,n){var s={};return s[r]=n,s},G=function(t,e,r){return r},Y=function(t,e,r){var n={};return r.unshift(function(t,e){var r={};return r[t]=e,r}(t,e)),r.forEach(t=>{t&&Object.keys(t).forEach(e=>{t[e].forEach(t=>{"@type"===e&&void 0!==t["@id"]&&(t=t["@id"]),void 0===n[e]?n[e]=t:Array.isArray(n[e])?n[e].push(t):n[e]=[n[e],t]})})}),n},Z=",",J=Br(",",!1),K=function(t,e){return e},tt=function(t,e){return e.unshift(t),e},et="a",rt=Br("a",!1),nt=function(){return"@type"},st=function(t){return Cn(t,!0)},it=function(t){return Cn(t,!1)},at=function(t){return"[]"===t?{}:{"@id":t}},ot=function(t){return{"@id":t}},ht="[",lt=Br("[",!1),ct="]",ut=Br("]",!1),dt="(",ft=Br("(",!1),pt=")",mt=Br(")",!1),wt=function(t){return{"@list":t}},gt=function(t,e){return{"@value":t,"@language":e}},vt="^^",bt=Br("^^",!1),yt=function(t,e){if("http://www.w3.org/2001/XMLSchema#boolean"===e&&"true"===t)return!0;if("http://www.w3.org/2001/XMLSchema#boolean"===e&&"false"===t)return!1;if("http://www.w3.org/2001/XMLSchema#integer"===e)return parseInt(t);if("http://www.w3.org/2001/XMLSchema#double"===e)return parseFloat(t);const r=An.resolve(e,!0);if(r){const n=e.split(":")[0];if("http://www.w3.org/2001/XMLSchema#boolean"===r&&"true"===t)return An.decrement(n),!0;if("http://www.w3.org/2001/XMLSchema#boolean"===r&&"false"===t)return An.decrement(n),!1;if("http://www.w3.org/2001/XMLSchema#integer"===r)return An.decrement(n),parseInt(t);if("http://www.w3.org/2001/XMLSchema#double"===r)return An.decrement(n),parseFloat(t)}return{"@value":t,"@type":e}},Tt="true",xt=Br("true",!1),Nt=function(){return!0},At="false",Ct=Br("false",!1),Ot=function(){return!1},Et=function(t){return t+":"},Rt="<",St=Br("<",!1),kt=/^[^\0- <>"{}|\^`\\]/,jt=Vr([["\0"," "],"<",">",'"',"{","}","|","^","`","\\"],!0,!1),It=">",Ft=Br(">",!1),Dt=function(t){const e=t.map(t=>65536<=t.codePointAt(0)&&t.codePointAt(0)<=983039?"a":1===t.length?t:6===t.length?String.fromCharCode("0x"+t.substring(2)):10===t.length?String.fromCodePoint("0x"+t.substring(2)):t).join("");if(e.match(/^[^\u0000-\u0020<>"{}|^`\\]*$/)){var r=t.join("");try{return An.resolve(r)}catch(t){Xr("Invalid IRIREF "+r)}}else Xr("Invalid IRIREF "+t.join("")+" / "+e)},Mt=":",Lt=Br(":",!1),_t=function(t){return t=t||"0",!1===An.hasPrefix(t)&&Xr("undefined prefix "+t),t},Ut=function(t){return t||""},Pt=function(t,e){return An.increment(t),An.resolve(t+":"+e)},qt="_:",Ht=Br("_:",!1),Xt=/^[0-9]/,Bt=Vr([["0","9"]],!1,!1),Vt="@",zt=Br("@",!1),$t=/^[a-zA-Z]/,Wt=Vr([["a","z"],["A","Z"]],!1,!1),Qt="-",Gt=Br("-",!1),Yt=/^[a-zA-Z0-9]/,Zt=Vr([["a","z"],["A","Z"],["0","9"]],!1,!1),Jt=function(t,e){return"-"+e.join("")},Kt=function(t,e){return t.join("")+e.join("")},te=/^[+\-]/,ee=Vr(["+","-"],!1,!1),re=function(t){return t.match(/^[0+][0-9]+$/)?{"@value":t,"@type":"http://www.w3.org/2001/XMLSchema#integer"}:parseInt(t)},ne=function(t){return{"@value":t,"@type":"http://www.w3.org/2001/XMLSchema#decimal"}},se=function(t){return{"@value":t,"@type":"http://www.w3.org/2001/XMLSchema#double"}},ie=/^[eE]/,ae=Vr(["e","E"],!1,!1),oe='"',he=Br('"',!1),le=/^[^"\\\n\r]/,ce=Vr(['"',"\\","\n","\r"],!0,!1),ue="'",de=Br("'",!1),fe=/^[^'\\\n\r]/,pe=Vr(["'","\\","\n","\r"],!0,!1),me="'''",we=Br("'''",!1),ge=/^[^'\\]/,ve=Vr(["'","\\"],!0,!1),be="''",ye=Br("''",!1),Te=function(t,e){return"''"+e.join("")},xe=function(t,e){return"'"+e.join("")},Ne=function(t,e){return t.join("")+e.join("")},Ae='"""',Ce=Br('"""',!1),Oe=/^[^"\\]/,Ee=Vr(['"',"\\"],!0,!1),Re='""',Se=Br('""',!1),ke=function(t,e){return'""'+e.join("")},je=function(t,e){return'"'+e.join("")},Ie="\\U",Fe=Br("\\U",!1),De=function(t){return String.fromCodePoint(parseInt(t.join(""),16))},Me="\\u",Le=Br("\\u",!1),_e=function(t){return String.fromCharCode(parseInt(t.join(""),16))},Ue="\\t",Pe=Br("\\t",!1),qe=function(){return"\t"},He="\\b",Xe=Br("\\b",!1),Be=function(){return"\b"},Ve="\\n",ze=Br("\\n",!1),$e=function(){return"\n"},We="\\r",Qe=Br("\\r",!1),Ge=function(){return"\r"},Ye="\\f",Ze=Br("\\f",!1),Je=function(){return"\f"},Ke='\\"',tr=Br('\\"',!1),er=function(){return'"'},rr="\\'",nr=Br("\\'",!1),sr=function(){return"'"},ir="\\\\",ar=Br("\\\\",!1),or=function(){return"\\"},hr=/^[ \t\r\n]/,lr=Vr([" ","\t","\r","\n"],!1,!1),cr=function(){return"[]"},ur=/^[\uD800-\uDBFF]/,dr=Vr([["\ud800","\udbff"]],!1,!1),fr=/^[\uDC00-\uDFFF]/,pr=Vr([["\udc00","\udfff"]],!1,!1),mr=function(t,e){return t+e},wr=/^[A-Za-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,gr=Vr([["A","Z"],["a","z"],["À","Ö"],["Ø","ö"],["ø","˿"],["Ͱ","ͽ"],["Ϳ","῿"],["‌","‍"],["⁰","↏"],["Ⰰ","⿯"],["、","퟿"],["豈","﷏"],["ﷰ","�"]],!1,!1),vr="_",br=Br("_",!1),yr="·",Tr=Br("·",!1),xr=/^[\u0300-\u036F]/,Nr=Vr([["̀","ͯ"]],!1,!1),Ar=/^[\u203F-\u2040]/,Cr=Vr([["‿","⁀"]],!1,!1),Or=function(t,e,r,n){return r.join("")+n.join("")},Er=function(t,e,r){return t+e.join("")+r.join("")},Rr="%",Sr=Br("%",!1),kr=/^[0-9A-Fa-f]/,jr=Vr([["0","9"],["A","F"],["a","f"]],!1,!1),Ir="\\",Fr=Br("\\",!1),Dr=/^[_~.!$&'()*+,;=\/?#@%\-]/,Mr=Vr(["_","~",".","!","$","&","'","(",")","*","+",",",";","=","/","?","#","@","%","-"],!1,!1),Lr=0,_r=0,Ur=[{line:1,column:1}],Pr=0,qr=[],Hr=0;if("startRule"in r){if(!(r.startRule in i))throw new Error("Can't start parsing from rule \""+r.startRule+'".');a=i[r.startRule]}function Xr(e,r){throw function(e,r){return new t(e,null,null,r)}(e,r=void 0!==r?r:$r(_r,Lr))}function Br(t,e){return{type:"literal",text:t,ignoreCase:e}}function Vr(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function zr(t){var r,n=Ur[t];if(n)return n;for(r=t-1;!Ur[r];)r--;for(n={line:(n=Ur[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Ur[t]=n,n}function $r(t,e){var r=zr(t),n=zr(e);return{start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function Wr(t){Lr<Pr||(Lr>Pr&&(Pr=Lr,qr=[]),qr.push(t))}function Qr(){var t,e,r,n,i;for(t=Lr,e=[],r=Gr();r!==s;)e.push(r),r=Gr();if(e!==s){for(r=[],n=Yr();n!==s;)r.push(n),n=Yr();if(r!==s){for(n=[],i=Zr();i!==s;)n.push(i),i=Zr();n!==s?(_r=t,t=e=o(r)):(Lr=t,t=s)}else Lr=t,t=s}else Lr=t,t=s;return t}function Gr(){var t;return 65279===e.charCodeAt(Lr)?(t=h,Lr++):(t=s,0===Hr&&Wr(l)),t}function Yr(){var t,r,n,i;if((t=function(){var t;return(t=function(){var t,r,n,i,a,o,h,l,d;for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();if(r!==s)if(e.substr(Lr,7)===y?(n=y,Lr+=7):(n=s,0===Hr&&Wr(T)),n!==s){for(i=[],a=Zr();a!==s;)i.push(a),a=Zr();if(i!==s)if((a=cn())!==s){for(o=[],h=Zr();h!==s;)o.push(h),h=Zr();if(o!==s)if((h=hn())!==s){for(l=[],d=Zr();d!==s;)l.push(d),d=Zr();l!==s?(46===e.charCodeAt(Lr)?(d=c,Lr++):(d=s,0===Hr&&Wr(u)),d!==s?(_r=t,t=r=x(a,h)):(Lr=t,t=s)):(Lr=t,t=s)}else Lr=t,t=s;else Lr=t,t=s}else Lr=t,t=s;else Lr=t,t=s}else Lr=t,t=s;else Lr=t,t=s;return t}())===s&&(t=function(){var t,r,n,i,a,o,h;for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();if(r!==s)if(e.substr(Lr,5)===N?(n=N,Lr+=5):(n=s,0===Hr&&Wr(A)),n!==s){for(i=[],a=Zr();a!==s;)i.push(a),a=Zr();if(i!==s)if((a=hn())!==s){for(o=[],h=Zr();h!==s;)o.push(h),h=Zr();o!==s?(46===e.charCodeAt(Lr)?(h=c,Lr++):(h=s,0===Hr&&Wr(u)),h!==s?(_r=t,t=r=C(a)):(Lr=t,t=s)):(Lr=t,t=s)}else Lr=t,t=s;else Lr=t,t=s}else Lr=t,t=s;else Lr=t,t=s;return t}())===s&&(t=function(){var t,r,n,i,a,o,h,l,c,u,d,f;for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();if(r!==s)if(D.test(e.charAt(Lr))?(n=e.charAt(Lr),Lr++):(n=s,0===Hr&&Wr(M)),n!==s)if(L.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(_)),i!==s)if(I.test(e.charAt(Lr))?(a=e.charAt(Lr),Lr++):(a=s,0===Hr&&Wr(F)),a!==s)if(U.test(e.charAt(Lr))?(o=e.charAt(Lr),Lr++):(o=s,0===Hr&&Wr(P)),o!==s)if(q.test(e.charAt(Lr))?(h=e.charAt(Lr),Lr++):(h=s,0===Hr&&Wr(H)),h!==s)if(X.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(B)),l!==s){for(c=[],u=Zr();u!==s;)c.push(u),u=Zr();if(c!==s)if((u=cn())!==s){for(d=[],f=Zr();f!==s;)d.push(f),f=Zr();d!==s&&(f=hn())!==s?(_r=t,t=r=x(u,f)):(Lr=t,t=s)}else Lr=t,t=s;else Lr=t,t=s}else Lr=t,t=s;else Lr=t,t=s;else Lr=t,t=s;else Lr=t,t=s;else Lr=t,t=s;else Lr=t,t=s;else Lr=t,t=s;return t}())===s&&(t=function(){var t,r,n,i,a,o,h,l;for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();if(r!==s)if(O.test(e.charAt(Lr))?(n=e.charAt(Lr),Lr++):(n=s,0===Hr&&Wr(E)),n!==s)if(R.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(S)),i!==s)if(k.test(e.charAt(Lr))?(a=e.charAt(Lr),Lr++):(a=s,0===Hr&&Wr(j)),a!==s)if(I.test(e.charAt(Lr))?(o=e.charAt(Lr),Lr++):(o=s,0===Hr&&Wr(F)),o!==s){for(h=[],l=Zr();l!==s;)h.push(l),l=Zr();h!==s&&(l=hn())!==s?(_r=t,t=r=C(l)):(Lr=t,t=s)}else Lr=t,t=s;else Lr=t,t=s;else Lr=t,t=s;else Lr=t,t=s;else Lr=t,t=s;return t}()),t}())===s)if(t=Lr,(r=function(){var t,e,r;return t=Lr,(e=function(){var t,e;return t=Lr,(e=nn())!==s&&(_r=t,e=st(e)),(t=e)===s&&(t=on())===s&&(t=an()),t}())!==s&&(r=Jr())!==s?(_r=t,t=e=V(e,r)):(Lr=t,t=s),t===s&&(t=Lr,(e=rn())!==s?((r=Jr())===s&&(r=null),r!==s?(_r=t,t=e=z(e,r)):(Lr=t,t=s)):(Lr=t,t=s)),t}())!==s){for(n=[],i=Zr();i!==s;)n.push(i),i=Zr();n!==s?(46===e.charCodeAt(Lr)?(i=c,Lr++):(i=s,0===Hr&&Wr(u)),i!==s?(_r=t,t=r=d(r)):(Lr=t,t=s)):(Lr=t,t=s)}else Lr=t,t=s;return t}function Zr(){var t;return(t=function(){var t;return hr.test(e.charAt(Lr))?(t=e.charAt(Lr),Lr++):(t=s,0===Hr&&Wr(lr)),t}())===s&&(t=function(){var t,r,n,i;if(t=Lr,35===e.charCodeAt(Lr)?(r=f,Lr++):(r=s,0===Hr&&Wr(p)),r!==s){for(n=[],m.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(w));i!==s;)n.push(i),m.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(w));n!==s?(10===e.charCodeAt(Lr)?(i=g,Lr++):(i=s,0===Hr&&Wr(v)),i!==s?(_r=t,t=r=b(n)):(Lr=t,t=s)):(Lr=t,t=s)}else Lr=t,t=s;return t}()),t}function Jr(){var t,r,n,i,a,o,h,l,c,u;if(t=Lr,(r=tn())!==s)if((n=Kr())!==s){for(i=[],a=Lr,o=[],h=Zr();h!==s;)o.push(h),h=Zr();for(o!==s?(59===e.charCodeAt(Lr)?(h=$,Lr++):(h=s,0===Hr&&Wr(W)),h!==s?(l=Lr,(c=tn())!==s&&(u=Kr())!==s?(_r=l,l=c=Q(r,n,c,u)):(Lr=l,l=s),l===s&&(l=null),l!==s?(_r=a,a=o=G(r,n,l)):(Lr=a,a=s)):(Lr=a,a=s)):(Lr=a,a=s);a!==s;){for(i.push(a),a=Lr,o=[],h=Zr();h!==s;)o.push(h),h=Zr();o!==s?(59===e.charCodeAt(Lr)?(h=$,Lr++):(h=s,0===Hr&&Wr(W)),h!==s?(l=Lr,(c=tn())!==s&&(u=Kr())!==s?(_r=l,l=c=Q(r,n,c,u)):(Lr=l,l=s),l===s&&(l=null),l!==s?(_r=a,a=o=G(r,n,l)):(Lr=a,a=s)):(Lr=a,a=s)):(Lr=a,a=s)}i!==s?(_r=t,t=r=Y(r,n,i)):(Lr=t,t=s)}else Lr=t,t=s;else Lr=t,t=s;return t}function Kr(){var t,r,n,i,a,o,h;if(t=Lr,(r=en())!==s){for(n=[],i=Lr,a=[],o=Zr();o!==s;)a.push(o),o=Zr();for(a!==s?(44===e.charCodeAt(Lr)?(o=Z,Lr++):(o=s,0===Hr&&Wr(J)),o!==s&&(h=en())!==s?(_r=i,i=a=K(r,h)):(Lr=i,i=s)):(Lr=i,i=s);i!==s;){for(n.push(i),i=Lr,a=[],o=Zr();o!==s;)a.push(o),o=Zr();a!==s?(44===e.charCodeAt(Lr)?(o=Z,Lr++):(o=s,0===Hr&&Wr(J)),o!==s&&(h=en())!==s?(_r=i,i=a=K(r,h)):(Lr=i,i=s)):(Lr=i,i=s)}n!==s?(_r=t,t=r=tt(r,n)):(Lr=t,t=s)}else Lr=t,t=s;return t}function tn(){var t,r,n;if(t=Lr,(r=function(){var t,e,r;for(t=Lr,e=[],r=Zr();r!==s;)e.push(r),r=Zr();return e!==s&&(r=an())!==s?(_r=t,t=e=d(r)):(Lr=t,t=s),t}())!==s&&(_r=t,r=d(r)),(t=r)===s){for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();r!==s?(97===e.charCodeAt(Lr)?(n=et,Lr++):(n=s,0===Hr&&Wr(rt)),n!==s?(_r=t,t=r=nt()):(Lr=t,t=s)):(Lr=t,t=s)}return t}function en(){var t,r;return(t=function(){var t;return(t=function(){var t,r,n,i,a,o,h;for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();if(r!==s)if((n=sn())!==s){for(i=[],a=Zr();a!==s;)i.push(a),a=Zr();i!==s&&(a=function(){var t,r,n,i,a,o,h,l;if(t=Lr,64===e.charCodeAt(Lr)?(r=Vt,Lr++):(r=s,0===Hr&&Wr(zt)),r!==s){if(n=[],$t.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(Wt)),i!==s)for(;i!==s;)n.push(i),$t.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(Wt));else n=s;if(n!==s){if(i=[],a=Lr,45===e.charCodeAt(Lr)?(o=Qt,Lr++):(o=s,0===Hr&&Wr(Gt)),o!==s){if(h=[],Yt.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(Zt)),l!==s)for(;l!==s;)h.push(l),Yt.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(Zt));else h=s;h!==s?(_r=a,a=o=Jt(n,h)):(Lr=a,a=s)}else Lr=a,a=s;for(;a!==s;)if(i.push(a),a=Lr,45===e.charCodeAt(Lr)?(o=Qt,Lr++):(o=s,0===Hr&&Wr(Gt)),o!==s){if(h=[],Yt.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(Zt)),l!==s)for(;l!==s;)h.push(l),Yt.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(Zt));else h=s;h!==s?(_r=a,a=o=Jt(n,h)):(Lr=a,a=s)}else Lr=a,a=s;i!==s?(_r=t,t=r=Kt(n,i)):(Lr=t,t=s)}else Lr=t,t=s}else Lr=t,t=s;return t}())!==s?(_r=t,t=r=gt(n,a)):(Lr=t,t=s)}else Lr=t,t=s;else Lr=t,t=s;if(t===s){for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();if(r!==s)if((n=sn())!==s){for(i=[],a=Zr();a!==s;)i.push(a),a=Zr();if(i!==s)if(e.substr(Lr,2)===vt?(a=vt,Lr+=2):(a=s,0===Hr&&Wr(bt)),a!==s){for(o=[],h=Zr();h!==s;)o.push(h),h=Zr();o!==s&&(h=an())!==s?(_r=t,t=r=yt(n,h)):(Lr=t,t=s)}else Lr=t,t=s;else Lr=t,t=s}else Lr=t,t=s;else Lr=t,t=s;if(t===s){for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();r!==s&&(n=sn())!==s?(_r=t,t=r=d(n)):(Lr=t,t=s)}}return t}())===s&&(t=function(){var t,r,n;for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();return r!==s?((n=function(){var t,r,n,i,a,o,h,l,d;if(t=Lr,r=Lr,n=Lr,te.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(ee)),i===s&&(i=null),i!==s){if(a=Lr,o=[],Xt.test(e.charAt(Lr))?(h=e.charAt(Lr),Lr++):(h=s,0===Hr&&Wr(Bt)),h!==s)for(;h!==s;)o.push(h),Xt.test(e.charAt(Lr))?(h=e.charAt(Lr),Lr++):(h=s,0===Hr&&Wr(Bt));else o=s;if(o!==s)if(46===e.charCodeAt(Lr)?(h=c,Lr++):(h=s,0===Hr&&Wr(u)),h!==s){for(l=[],Xt.test(e.charAt(Lr))?(d=e.charAt(Lr),Lr++):(d=s,0===Hr&&Wr(Bt));d!==s;)l.push(d),Xt.test(e.charAt(Lr))?(d=e.charAt(Lr),Lr++):(d=s,0===Hr&&Wr(Bt));l!==s&&(d=un())!==s?a=o=[o,h,l,d]:(Lr=a,a=s)}else Lr=a,a=s;else Lr=a,a=s;if(a===s){if(a=Lr,46===e.charCodeAt(Lr)?(o=c,Lr++):(o=s,0===Hr&&Wr(u)),o!==s){if(h=[],Xt.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(Bt)),l!==s)for(;l!==s;)h.push(l),Xt.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(Bt));else h=s;h!==s&&(l=un())!==s?a=o=[o,h,l]:(Lr=a,a=s)}else Lr=a,a=s;if(a===s){if(a=Lr,o=[],Xt.test(e.charAt(Lr))?(h=e.charAt(Lr),Lr++):(h=s,0===Hr&&Wr(Bt)),h!==s)for(;h!==s;)o.push(h),Xt.test(e.charAt(Lr))?(h=e.charAt(Lr),Lr++):(h=s,0===Hr&&Wr(Bt));else o=s;o!==s&&(h=un())!==s?a=o=[o,h]:(Lr=a,a=s)}}a!==s?n=i=[i,a]:(Lr=n,n=s)}else Lr=n,n=s;return(r=n!==s?e.substring(r,Lr):n)!==s&&(_r=t,r=se(r)),r}())===s&&(n=function(){var t,r,n,i,a,o,h,l;if(t=Lr,r=Lr,n=Lr,te.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(ee)),i===s&&(i=null),i!==s){for(a=[],Xt.test(e.charAt(Lr))?(o=e.charAt(Lr),Lr++):(o=s,0===Hr&&Wr(Bt));o!==s;)a.push(o),Xt.test(e.charAt(Lr))?(o=e.charAt(Lr),Lr++):(o=s,0===Hr&&Wr(Bt));if(a!==s)if(46===e.charCodeAt(Lr)?(o=c,Lr++):(o=s,0===Hr&&Wr(u)),o!==s){if(h=[],Xt.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(Bt)),l!==s)for(;l!==s;)h.push(l),Xt.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(Bt));else h=s;h!==s?n=i=[i,a,o,h]:(Lr=n,n=s)}else Lr=n,n=s;else Lr=n,n=s}else Lr=n,n=s;return(r=n!==s?e.substring(r,Lr):n)!==s&&(_r=t,r=ne(r)),r}())===s&&(n=function(){var t,r,n,i,a,o;if(t=Lr,r=Lr,n=Lr,te.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(ee)),i===s&&(i=null),i!==s){if(a=[],Xt.test(e.charAt(Lr))?(o=e.charAt(Lr),Lr++):(o=s,0===Hr&&Wr(Bt)),o!==s)for(;o!==s;)a.push(o),Xt.test(e.charAt(Lr))?(o=e.charAt(Lr),Lr++):(o=s,0===Hr&&Wr(Bt));else a=s;a!==s?n=i=[i,a]:(Lr=n,n=s)}else Lr=n,n=s;return(r=n!==s?e.substring(r,Lr):n)!==s&&(_r=t,r=re(r)),r}()),n!==s?(_r=t,t=r=d(n)):(Lr=t,t=s)):(Lr=t,t=s),t}())===s&&(t=function(){var t,r,n;for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();if(r!==s?(e.substr(Lr,4)===Tt?(n=Tt,Lr+=4):(n=s,0===Hr&&Wr(xt)),n!==s?(_r=t,t=r=Nt()):(Lr=t,t=s)):(Lr=t,t=s),t===s){for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();r!==s?(e.substr(Lr,5)===At?(n=At,Lr+=5):(n=s,0===Hr&&Wr(Ct)),n!==s?(_r=t,t=r=Ot()):(Lr=t,t=s)):(Lr=t,t=s)}return t}()),t}())===s&&(t=Lr,(r=nn())!==s&&(_r=t,r=it(r)),(t=r)===s&&(t=Lr,(r=on())!==s&&(_r=t,r=at(r)),(t=r)===s&&(t=Lr,(r=rn())!==s&&(_r=t,r=d(r)),(t=r)===s&&(t=Lr,(r=an())!==s&&(_r=t,r=ot(r)),t=r)))),t}function rn(){var t,r,n,i,a,o;for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();if(r!==s)if(91===e.charCodeAt(Lr)?(n=ht,Lr++):(n=s,0===Hr&&Wr(lt)),n!==s)if((i=Jr())!==s){for(a=[],o=Zr();o!==s;)a.push(o),o=Zr();a!==s?(93===e.charCodeAt(Lr)?(o=ct,Lr++):(o=s,0===Hr&&Wr(ut)),o!==s?(_r=t,t=r=d(i)):(Lr=t,t=s)):(Lr=t,t=s)}else Lr=t,t=s;else Lr=t,t=s;else Lr=t,t=s;return t}function nn(){var t,r,n,i,a,o;for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();if(r!==s)if(40===e.charCodeAt(Lr)?(n=dt,Lr++):(n=s,0===Hr&&Wr(ft)),n!==s){for(i=[],a=en();a!==s;)i.push(a),a=en();if(i!==s){for(a=[],o=Zr();o!==s;)a.push(o),o=Zr();a!==s?(41===e.charCodeAt(Lr)?(o=pt,Lr++):(o=s,0===Hr&&Wr(mt)),o!==s?(_r=t,t=r=wt(i)):(Lr=t,t=s)):(Lr=t,t=s)}else Lr=t,t=s}else Lr=t,t=s;else Lr=t,t=s;return t}function sn(){var t,r,n;for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();return r!==s?((n=function(){var t,r,n,i,a,o,h,l;if(t=Lr,e.substr(Lr,3)===me?(r=me,Lr+=3):(r=s,0===Hr&&Wr(we)),r!==s){for(n=[],ge.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(ve)),i===s&&(i=fn())===s&&(i=dn());i!==s;)n.push(i),ge.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(ve)),i===s&&(i=fn())===s&&(i=dn());if(n!==s){if(i=[],a=Lr,e.substr(Lr,2)===be?(o=be,Lr+=2):(o=s,0===Hr&&Wr(ye)),o!==s){if(h=[],ge.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(ve)),l===s&&(l=fn())===s&&(l=dn()),l!==s)for(;l!==s;)h.push(l),ge.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(ve)),l===s&&(l=fn())===s&&(l=dn());else h=s;h!==s?(_r=a,a=o=Te(n,h)):(Lr=a,a=s)}else Lr=a,a=s;if(a===s)if(a=Lr,39===e.charCodeAt(Lr)?(o=ue,Lr++):(o=s,0===Hr&&Wr(de)),o!==s){if(h=[],ge.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(ve)),l===s&&(l=fn())===s&&(l=dn()),l!==s)for(;l!==s;)h.push(l),ge.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(ve)),l===s&&(l=fn())===s&&(l=dn());else h=s;h!==s?(_r=a,a=o=xe(n,h)):(Lr=a,a=s)}else Lr=a,a=s;for(;a!==s;){if(i.push(a),a=Lr,e.substr(Lr,2)===be?(o=be,Lr+=2):(o=s,0===Hr&&Wr(ye)),o!==s){if(h=[],ge.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(ve)),l===s&&(l=fn())===s&&(l=dn()),l!==s)for(;l!==s;)h.push(l),ge.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(ve)),l===s&&(l=fn())===s&&(l=dn());else h=s;h!==s?(_r=a,a=o=Te(n,h)):(Lr=a,a=s)}else Lr=a,a=s;if(a===s)if(a=Lr,39===e.charCodeAt(Lr)?(o=ue,Lr++):(o=s,0===Hr&&Wr(de)),o!==s){if(h=[],ge.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(ve)),l===s&&(l=fn())===s&&(l=dn()),l!==s)for(;l!==s;)h.push(l),ge.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(ve)),l===s&&(l=fn())===s&&(l=dn());else h=s;h!==s?(_r=a,a=o=xe(n,h)):(Lr=a,a=s)}else Lr=a,a=s}i!==s?(e.substr(Lr,3)===me?(a=me,Lr+=3):(a=s,0===Hr&&Wr(we)),a!==s?(_r=t,t=r=Ne(n,i)):(Lr=t,t=s)):(Lr=t,t=s)}else Lr=t,t=s}else Lr=t,t=s;return t}())===s&&(n=function(){var t,r,n,i,a,o,h,l;if(t=Lr,e.substr(Lr,3)===Ae?(r=Ae,Lr+=3):(r=s,0===Hr&&Wr(Ce)),r!==s){for(n=[],Oe.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(Ee)),i===s&&(i=fn())===s&&(i=dn());i!==s;)n.push(i),Oe.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(Ee)),i===s&&(i=fn())===s&&(i=dn());if(n!==s){if(i=[],a=Lr,e.substr(Lr,2)===Re?(o=Re,Lr+=2):(o=s,0===Hr&&Wr(Se)),o!==s){if(h=[],Oe.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(Ee)),l===s&&(l=fn())===s&&(l=dn()),l!==s)for(;l!==s;)h.push(l),Oe.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(Ee)),l===s&&(l=fn())===s&&(l=dn());else h=s;h!==s?(_r=a,a=o=ke(n,h)):(Lr=a,a=s)}else Lr=a,a=s;if(a===s)if(a=Lr,34===e.charCodeAt(Lr)?(o=oe,Lr++):(o=s,0===Hr&&Wr(he)),o!==s){if(h=[],Oe.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(Ee)),l===s&&(l=fn())===s&&(l=dn()),l!==s)for(;l!==s;)h.push(l),Oe.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(Ee)),l===s&&(l=fn())===s&&(l=dn());else h=s;h!==s?(_r=a,a=o=je(n,h)):(Lr=a,a=s)}else Lr=a,a=s;for(;a!==s;){if(i.push(a),a=Lr,e.substr(Lr,2)===Re?(o=Re,Lr+=2):(o=s,0===Hr&&Wr(Se)),o!==s){if(h=[],Oe.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(Ee)),l===s&&(l=fn())===s&&(l=dn()),l!==s)for(;l!==s;)h.push(l),Oe.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(Ee)),l===s&&(l=fn())===s&&(l=dn());else h=s;h!==s?(_r=a,a=o=ke(n,h)):(Lr=a,a=s)}else Lr=a,a=s;if(a===s)if(a=Lr,34===e.charCodeAt(Lr)?(o=oe,Lr++):(o=s,0===Hr&&Wr(he)),o!==s){if(h=[],Oe.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(Ee)),l===s&&(l=fn())===s&&(l=dn()),l!==s)for(;l!==s;)h.push(l),Oe.test(e.charAt(Lr))?(l=e.charAt(Lr),Lr++):(l=s,0===Hr&&Wr(Ee)),l===s&&(l=fn())===s&&(l=dn());else h=s;h!==s?(_r=a,a=o=je(n,h)):(Lr=a,a=s)}else Lr=a,a=s}i!==s?(e.substr(Lr,3)===Ae?(a=Ae,Lr+=3):(a=s,0===Hr&&Wr(Ce)),a!==s?(_r=t,t=r=Ne(n,i)):(Lr=t,t=s)):(Lr=t,t=s)}else Lr=t,t=s}else Lr=t,t=s;return t}())===s&&(n=function(){var t,r,n,i;if(t=Lr,39===e.charCodeAt(Lr)?(r=ue,Lr++):(r=s,0===Hr&&Wr(de)),r!==s){for(n=[],fe.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(pe)),i===s&&(i=fn())===s&&(i=dn());i!==s;)n.push(i),fe.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(pe)),i===s&&(i=fn())===s&&(i=dn());n!==s?(39===e.charCodeAt(Lr)?(i=ue,Lr++):(i=s,0===Hr&&Wr(de)),i!==s?(_r=t,t=r=b(n)):(Lr=t,t=s)):(Lr=t,t=s)}else Lr=t,t=s;return t}())===s&&(n=function(){var t,r,n,i;if(t=Lr,34===e.charCodeAt(Lr)?(r=oe,Lr++):(r=s,0===Hr&&Wr(he)),r!==s){for(n=[],le.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(ce)),i===s&&(i=fn())===s&&(i=dn());i!==s;)n.push(i),le.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(ce)),i===s&&(i=fn())===s&&(i=dn());n!==s?(34===e.charCodeAt(Lr)?(i=oe,Lr++):(i=s,0===Hr&&Wr(he)),i!==s?(_r=t,t=r=b(n)):(Lr=t,t=s)):(Lr=t,t=s)}else Lr=t,t=s;return t}()),n!==s?(_r=t,t=r=d(n)):(Lr=t,t=s)):(Lr=t,t=s),t}function an(){var t,r,n;for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();if(r!==s&&(n=hn())!==s?(_r=t,t=r=d(n)):(Lr=t,t=s),t===s){for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();r!==s&&(n=function(){var t,r;return(t=function(){var t,r,n;return t=Lr,(r=ln())!==s&&(n=function(){var t,r,n,i,a,o,h,l;if(t=Lr,(r=mn())===s&&(58===e.charCodeAt(Lr)?(r=Mt,Lr++):(r=s,0===Hr&&Wr(Lt)),r===s&&(Xt.test(e.charAt(Lr))?(r=e.charAt(Lr),Lr++):(r=s,0===Hr&&Wr(Bt)),r===s&&(r=vn()))),r!==s){for(n=[],(i=wn())===s&&(58===e.charCodeAt(Lr)?(i=Mt,Lr++):(i=s,0===Hr&&Wr(Lt)),i===s&&(i=vn()));i!==s;)n.push(i),(i=wn())===s&&(58===e.charCodeAt(Lr)?(i=Mt,Lr++):(i=s,0===Hr&&Wr(Lt)),i===s&&(i=vn()));if(n!==s){if(i=[],a=Lr,o=[],46===e.charCodeAt(Lr)?(h=c,Lr++):(h=s,0===Hr&&Wr(u)),h!==s)for(;h!==s;)o.push(h),46===e.charCodeAt(Lr)?(h=c,Lr++):(h=s,0===Hr&&Wr(u));else o=s;if(o!==s){if(h=[],(l=wn())===s&&(58===e.charCodeAt(Lr)?(l=Mt,Lr++):(l=s,0===Hr&&Wr(Lt)),l===s&&(l=vn())),l!==s)for(;l!==s;)h.push(l),(l=wn())===s&&(58===e.charCodeAt(Lr)?(l=Mt,Lr++):(l=s,0===Hr&&Wr(Lt)),l===s&&(l=vn()));else h=s;h!==s?(_r=a,a=o=Or(r,n,o,h)):(Lr=a,a=s)}else Lr=a,a=s;for(;a!==s;){if(i.push(a),a=Lr,o=[],46===e.charCodeAt(Lr)?(h=c,Lr++):(h=s,0===Hr&&Wr(u)),h!==s)for(;h!==s;)o.push(h),46===e.charCodeAt(Lr)?(h=c,Lr++):(h=s,0===Hr&&Wr(u));else o=s;if(o!==s){if(h=[],(l=wn())===s&&(58===e.charCodeAt(Lr)?(l=Mt,Lr++):(l=s,0===Hr&&Wr(Lt)),l===s&&(l=vn())),l!==s)for(;l!==s;)h.push(l),(l=wn())===s&&(58===e.charCodeAt(Lr)?(l=Mt,Lr++):(l=s,0===Hr&&Wr(Lt)),l===s&&(l=vn()));else h=s;h!==s?(_r=a,a=o=Or(r,n,o,h)):(Lr=a,a=s)}else Lr=a,a=s}i!==s?(_r=t,t=r=Er(r,n,i)):(Lr=t,t=s)}else Lr=t,t=s}else Lr=t,t=s;return t}())!==s?(_r=t,t=r=Pt(r,n)):(Lr=t,t=s),t}())===s&&(t=Lr,(r=ln())!==s&&(_r=t,r=Et(r)),t=r),t}())!==s?(_r=t,t=r=d(n)):(Lr=t,t=s)}return t}function on(){var t,r,n;for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();if(r!==s&&(n=function(){var t,r,n,i,a,o,h,l,d,f;if(t=Lr,r=Lr,e.substr(Lr,2)===qt?(n=qt,Lr+=2):(n=s,0===Hr&&Wr(Ht)),n!==s)if((i=mn())===s&&(Xt.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(Bt))),i!==s){for(a=[],o=wn();o!==s;)a.push(o),o=wn();if(a!==s){if(o=[],h=Lr,l=[],46===e.charCodeAt(Lr)?(d=c,Lr++):(d=s,0===Hr&&Wr(u)),d!==s)for(;d!==s;)l.push(d),46===e.charCodeAt(Lr)?(d=c,Lr++):(d=s,0===Hr&&Wr(u));else l=s;if(l!==s){if(d=[],(f=wn())!==s)for(;f!==s;)d.push(f),f=wn();else d=s;d!==s?h=l=[l,d]:(Lr=h,h=s)}else Lr=h,h=s;for(;h!==s;){if(o.push(h),h=Lr,l=[],46===e.charCodeAt(Lr)?(d=c,Lr++):(d=s,0===Hr&&Wr(u)),d!==s)for(;d!==s;)l.push(d),46===e.charCodeAt(Lr)?(d=c,Lr++):(d=s,0===Hr&&Wr(u));else l=s;if(l!==s){if(d=[],(f=wn())!==s)for(;f!==s;)d.push(f),f=wn();else d=s;d!==s?h=l=[l,d]:(Lr=h,h=s)}else Lr=h,h=s}o!==s?r=n=[n,i,a,o]:(Lr=r,r=s)}else Lr=r,r=s}else Lr=r,r=s;else Lr=r,r=s;return r!==s?e.substring(t,Lr):r}())!==s?(_r=t,t=r=d(n)):(Lr=t,t=s),t===s){for(t=Lr,r=[],n=Zr();n!==s;)r.push(n),n=Zr();r!==s&&(n=function(){var t,r,n,i;if(t=Lr,91===e.charCodeAt(Lr)?(r=ht,Lr++):(r=s,0===Hr&&Wr(lt)),r!==s){for(n=[],i=Zr();i!==s;)n.push(i),i=Zr();n!==s?(93===e.charCodeAt(Lr)?(i=ct,Lr++):(i=s,0===Hr&&Wr(ut)),i!==s?(_r=t,t=r=cr()):(Lr=t,t=s)):(Lr=t,t=s)}else Lr=t,t=s;return t}())!==s?(_r=t,t=r=d(n)):(Lr=t,t=s)}return t}function hn(){var t,r,n,i;if(t=Lr,60===e.charCodeAt(Lr)?(r=Rt,Lr++):(r=s,0===Hr&&Wr(St)),r!==s){for(n=[],kt.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(jt)),i===s&&(i=dn());i!==s;)n.push(i),kt.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(jt)),i===s&&(i=dn());n!==s?(62===e.charCodeAt(Lr)?(i=It,Lr++):(i=s,0===Hr&&Wr(Ft)),i!==s?(_r=t,t=r=Dt(n)):(Lr=t,t=s)):(Lr=t,t=s)}else Lr=t,t=s;return t}function ln(){var t,r,n;return t=Lr,(r=gn())===s&&(r=null),r!==s?(58===e.charCodeAt(Lr)?(n=Mt,Lr++):(n=s,0===Hr&&Wr(Lt)),n!==s?(_r=t,t=r=_t(r)):(Lr=t,t=s)):(Lr=t,t=s),t}function cn(){var t,r,n;return t=Lr,(r=gn())===s&&(r=null),r!==s?(58===e.charCodeAt(Lr)?(n=Mt,Lr++):(n=s,0===Hr&&Wr(Lt)),n!==s?(_r=t,t=r=Ut(r)):(Lr=t,t=s)):(Lr=t,t=s),t}function un(){var t,r,n,i,a,o;if(t=Lr,r=Lr,ie.test(e.charAt(Lr))?(n=e.charAt(Lr),Lr++):(n=s,0===Hr&&Wr(ae)),n!==s)if(te.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=s,0===Hr&&Wr(ee)),i===s&&(i=null),i!==s){if(a=[],Xt.test(e.charAt(Lr))?(o=e.charAt(Lr),Lr++):(o=s,0===Hr&&Wr(Bt)),o!==s)for(;o!==s;)a.push(o),Xt.test(e.charAt(Lr))?(o=e.charAt(Lr),Lr++):(o=s,0===Hr&&Wr(Bt));else a=s;a!==s?r=n=[n,i,a]:(Lr=r,r=s)}else Lr=r,r=s;else Lr=r,r=s;return r!==s?e.substring(t,Lr):r}function dn(){var t,r,n,i,a,o,h,l,c,u,d;return t=Lr,e.substr(Lr,2)===Ie?(r=Ie,Lr+=2):(r=s,0===Hr&&Wr(Fe)),r!==s?(n=Lr,(i=bn())!==s&&(a=bn())!==s&&(o=bn())!==s&&(h=bn())!==s&&(l=bn())!==s&&(c=bn())!==s&&(u=bn())!==s&&(d=bn())!==s?n=i=[i,a,o,h,l,c,u,d]:(Lr=n,n=s),n!==s?(_r=t,t=r=De(n)):(Lr=t,t=s)):(Lr=t,t=s),t===s&&(t=Lr,e.substr(Lr,2)===Me?(r=Me,Lr+=2):(r=s,0===Hr&&Wr(Le)),r!==s?(n=Lr,(i=bn())!==s&&(a=bn())!==s&&(o=bn())!==s&&(h=bn())!==s?n=i=[i,a,o,h]:(Lr=n,n=s),n!==s?(_r=t,t=r=_e(n)):(Lr=t,t=s)):(Lr=t,t=s)),t}function fn(){var t,r;return t=Lr,e.substr(Lr,2)===Ue?(r=Ue,Lr+=2):(r=s,0===Hr&&Wr(Pe)),r!==s&&(_r=t,r=qe()),(t=r)===s&&(t=Lr,e.substr(Lr,2)===He?(r=He,Lr+=2):(r=s,0===Hr&&Wr(Xe)),r!==s&&(_r=t,r=Be()),(t=r)===s&&(t=Lr,e.substr(Lr,2)===Ve?(r=Ve,Lr+=2):(r=s,0===Hr&&Wr(ze)),r!==s&&(_r=t,r=$e()),(t=r)===s&&(t=Lr,e.substr(Lr,2)===We?(r=We,Lr+=2):(r=s,0===Hr&&Wr(Qe)),r!==s&&(_r=t,r=Ge()),(t=r)===s&&(t=Lr,e.substr(Lr,2)===Ye?(r=Ye,Lr+=2):(r=s,0===Hr&&Wr(Ze)),r!==s&&(_r=t,r=Je()),(t=r)===s&&(t=Lr,e.substr(Lr,2)===Ke?(r=Ke,Lr+=2):(r=s,0===Hr&&Wr(tr)),r!==s&&(_r=t,r=er()),(t=r)===s&&(t=Lr,e.substr(Lr,2)===rr?(r=rr,Lr+=2):(r=s,0===Hr&&Wr(nr)),r!==s&&(_r=t,r=sr()),(t=r)===s&&(t=Lr,e.substr(Lr,2)===ir?(r=ir,Lr+=2):(r=s,0===Hr&&Wr(ar)),r!==s&&(_r=t,r=or()),t=r))))))),t}function pn(){var t,r,n;return t=Lr,ur.test(e.charAt(Lr))?(r=e.charAt(Lr),Lr++):(r=s,0===Hr&&Wr(dr)),r!==s?(fr.test(e.charAt(Lr))?(n=e.charAt(Lr),Lr++):(n=s,0===Hr&&Wr(pr)),n!==s?(_r=t,t=r=mr(r,n)):(Lr=t,t=s)):(Lr=t,t=s),t===s&&(wr.test(e.charAt(Lr))?(t=e.charAt(Lr),Lr++):(t=s,0===Hr&&Wr(gr))),t}function mn(){var t;return(t=pn())===s&&(95===e.charCodeAt(Lr)?(t=vr,Lr++):(t=s,0===Hr&&Wr(br))),t}function wn(){var t;return(t=mn())===s&&(45===e.charCodeAt(Lr)?(t=Qt,Lr++):(t=s,0===Hr&&Wr(Gt)),t===s&&(Xt.test(e.charAt(Lr))?(t=e.charAt(Lr),Lr++):(t=s,0===Hr&&Wr(Bt)),t===s&&(183===e.charCodeAt(Lr)?(t=yr,Lr++):(t=s,0===Hr&&Wr(Tr)),t===s&&(xr.test(e.charAt(Lr))?(t=e.charAt(Lr),Lr++):(t=s,0===Hr&&Wr(Nr)),t===s&&(Ar.test(e.charAt(Lr))?(t=e.charAt(Lr),Lr++):(t=s,0===Hr&&Wr(Cr))))))),t}function gn(){var t,r,n,i,a,o,h,l,d;if(t=Lr,r=Lr,(n=pn())!==s){for(i=[],a=wn();a!==s;)i.push(a),a=wn();if(i!==s){if(a=[],o=Lr,h=[],46===e.charCodeAt(Lr)?(l=c,Lr++):(l=s,0===Hr&&Wr(u)),l!==s)for(;l!==s;)h.push(l),46===e.charCodeAt(Lr)?(l=c,Lr++):(l=s,0===Hr&&Wr(u));else h=s;if(h!==s){if(l=[],(d=wn())!==s)for(;d!==s;)l.push(d),d=wn();else l=s;l!==s?o=h=[h,l]:(Lr=o,o=s)}else Lr=o,o=s;for(;o!==s;){if(a.push(o),o=Lr,h=[],46===e.charCodeAt(Lr)?(l=c,Lr++):(l=s,0===Hr&&Wr(u)),l!==s)for(;l!==s;)h.push(l),46===e.charCodeAt(Lr)?(l=c,Lr++):(l=s,0===Hr&&Wr(u));else h=s;if(h!==s){if(l=[],(d=wn())!==s)for(;d!==s;)l.push(d),d=wn();else l=s;l!==s?o=h=[h,l]:(Lr=o,o=s)}else Lr=o,o=s}a!==s?r=n=[n,i,a]:(Lr=r,r=s)}else Lr=r,r=s}else Lr=r,r=s;return r!==s?e.substring(t,Lr):r}function vn(){var t;return(t=function(){var t,r,n,i,a;return t=Lr,r=Lr,37===e.charCodeAt(Lr)?(n=Rr,Lr++):(n=s,0===Hr&&Wr(Sr)),n!==s&&(i=bn())!==s&&(a=bn())!==s?r=n=[n,i,a]:(Lr=r,r=s),r!==s?e.substring(t,Lr):r}())===s&&(t=function(){var t,r,n;return t=Lr,92===e.charCodeAt(Lr)?(r=Ir,Lr++):(r=s,0===Hr&&Wr(Fr)),r!==s?(Dr.test(e.charAt(Lr))?(n=e.charAt(Lr),Lr++):(n=s,0===Hr&&Wr(Mr)),n!==s?(_r=t,t=r=d(n)):(Lr=t,t=s)):(Lr=t,t=s),t}()),t}function bn(){var t;return kr.test(e.charAt(Lr))?(t=e.charAt(Lr),Lr++):(t=s,0===Hr&&Wr(jr)),t}var yn,Tn,xn,Nn=function(t){return t.match(/^[a-z](.*?):(.+?)/g)},An={base:[],data:{},addBase:function(t){if(0===An.base.length)return void An.base.push(t);const e=An.base[An.base.length-1];e!==t&&An.base.push(new URL(t,e).toString())},addPrefix:function(t,e){const r=An.data[t];void 0===r?An.data[t]=[{uri:e,count:0}]:r[r.length-1].uri!==e&&r.push({uri:e,count:0})},hasPrefix:function(t){return void 0!==this.data[t]},resolve:function(t,e){const n=Object.keys(An.data).find(e=>0===t.indexOf(e+":"));if(void 0!==n){const r=An.data[n];if(1===r.length&&!0!==e&&Nn(r[0].uri))return t;const s=r[r.length-1].uri;return t.replace(n+":",s)}var s=0===An.base.length?r.baseIRI:An.base[An.base.length-1];return!s||t.match(/^(http:|https:|urn:|file:)/)?t:0===t.indexOf("//")&&s?s.split("//")[0]+t:new URL(t,s).toString()},increment:function(t){const e=An.data[t];void 0!==e&&e[e.length-1].count++},decrement:function(t){const e=An.data[t];void 0!==e&&e[e.length-1].count--},toJSON:function(){const t={};return An.base.length>0&&(void 0===t["@context"]&&(t["@context"]={}),t["@context"]["@base"]=An.base[0]),Object.keys(An.data).forEach(e=>{const r=An.data[e][0];"http://www.w3.org/2001/XMLSchema#"===r.uri&&r.count<1||Nn(r.uri)&&(void 0===t["@context"]&&(t["@context"]={}),t["@context"][e]=r.uri)}),t}};function Cn(t,e){if(void 0===t["@list"])return t;if(!e&&!t["@list"].find(t=>void 0!==t["@list"]))return t;if(0===t["@list"].length)return{"@id":"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"};var r={},n=null;return t["@list"].forEach(t=>{null===n?n=r:(n["http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"]={},n=n["http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"]),n["http://www.w3.org/1999/02/22-rdf-syntax-ns#first"]=Cn(t,!0),n["http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"]={"@id":"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"}}),r}if((n=a())!==s&&Lr===e.length)return n;throw n!==s&&Lr<e.length&&Wr({type:"end"}),yn=qr,Tn=Pr<e.length?e.charAt(Pr):null,xn=Pr<e.length?$r(Pr,Pr+1):$r(Pr,Pr),new t(t.buildMessage(yn,Tn),yn,Tn,xn)}}})?r.apply(e,[]):r)||(t.exports=n)},392(e){"use strict";if(void 0===t){var r=new Error("Cannot find module 'window'");throw r.code="MODULE_NOT_FOUND",r}e.exports=t},540(t){const e={acl:"http://www.w3.org/ns/auth/acl#",arg:"http://www.w3.org/ns/pim/arg#",as:"https://www.w3.org/ns/activitystreams#",bookmark:"http://www.w3.org/2002/01/bookmark#",cal:"http://www.w3.org/2002/12/cal/ical#",cco:"http://www.ontologyrepository.com/CommonCoreOntologies/",cert:"http://www.w3.org/ns/auth/cert#",contact:"http://www.w3.org/2000/10/swap/pim/contact#",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",doap:"http://usefulinc.com/ns/doap#",foaf:"http://xmlns.com/foaf/0.1/",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",gpx:"http://www.w3.org/ns/pim/gpx#",gr:"http://purl.org/goodrelations/v1#",http:"http://www.w3.org/2007/ont/http#",httph:"http://www.w3.org/2007/ont/httph#",icalTZ:"http://www.w3.org/2002/12/cal/icaltzd#",ldp:"http://www.w3.org/ns/ldp#",link:"http://www.w3.org/2007/ont/link#",log:"http://www.w3.org/2000/10/swap/log#",meeting:"http://www.w3.org/ns/pim/meeting#",mo:"http://purl.org/ontology/mo/",org:"http://www.w3.org/ns/org#",owl:"http://www.w3.org/2002/07/owl#",pad:"http://www.w3.org/ns/pim/pad#",patch:"http://www.w3.org/ns/pim/patch#",prov:"http://www.w3.org/ns/prov#",pto:"http://www.productontology.org/id/",qu:"http://www.w3.org/2000/10/swap/pim/qif#",trip:"http://www.w3.org/ns/pim/trip#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",rss:"http://purl.org/rss/1.0/",sched:"http://www.w3.org/ns/pim/schedule#",schema:"http://schema.org/",sioc:"http://rdfs.org/sioc/ns#",skos:"http://www.w3.org/2004/02/skos/core#",solid:"http://www.w3.org/ns/solid/terms#",space:"http://www.w3.org/ns/pim/space#",stat:"http://www.w3.org/ns/posix/stat#",tab:"http://www.w3.org/2007/ont/link#",tabont:"http://www.w3.org/2007/ont/link#",ui:"http://www.w3.org/ns/ui#",vann:"http://purl.org/vocab/vann/",vcard:"http://www.w3.org/2006/vcard/ns#",wf:"http://www.w3.org/2005/01/wf/flow#",xsd:"http://www.w3.org/2001/XMLSchema#"};t.exports=function(t={namedNode:t=>t}){const r={};for(const n in e){const s=e[n];r[n]=function(e=""){return t.namedNode(s+e)}}return r}}},a={};function o(t){var e=a[t];if(void 0!==e)return e.exports;var r=a[t]={exports:{}};return i[t].call(r.exports,r,r.exports,o),r.exports}o.m=i,o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},r=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,o.t=function(t,n){if(1&n&&(t=this(t)),8&n)return t;if("object"==typeof t&&t){if(4&n&&t.__esModule)return t;if(16&n&&"function"==typeof t.then)return t}var s=Object.create(null);o.r(s);var i={};e=e||[null,r({}),r([]),r(r)];for(var a=2&n&&t;("object"==typeof a||"function"==typeof a)&&!~e.indexOf(a);a=r(a))Object.getOwnPropertyNames(a).forEach(e=>i[e]=()=>t[e]);return i.default=()=>t,o.d(s,i),s},o.d=(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce((e,r)=>(o.f[r](t,e),e),[])),o.u=t=>t+".rdflib.min.js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n={},s="$rdf:",o.l=(t,e,r,i)=>{if(n[t])n[t].push(e);else{var a,h;if(void 0!==r)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var u=l[c];if(u.getAttribute("src")==t||u.getAttribute("data-webpack")==s+r){a=u;break}}a||(h=!0,(a=document.createElement("script")).charset="utf-8",o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",s+r),a.src=t),n[t]=[e];var d=(e,r)=>{a.onerror=a.onload=null,clearTimeout(f);var s=n[t];if(delete n[t],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach(t=>t(r)),e)return e(r)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),h&&document.head.appendChild(a)}},o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=r[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),(()=>{var t={792:0};o.f.j=(e,r)=>{var n=o.o(t,e)?t[e]:void 0;if(0!==n)if(n)r.push(n[2]);else{var s=new Promise((r,s)=>n=t[e]=[r,s]);r.push(n[2]=s);var i=o.p+o.u(e),a=new Error;o.l(i,r=>{if(o.o(t,e)&&(0!==(n=t[e])&&(t[e]=void 0),n)){var s=r&&("load"===r.type?"missing":r.type),i=r&&r.target&&r.target.src;a.message="Loading chunk "+e+" failed.\n("+s+": "+i+")",a.name="ChunkLoadError",a.type=s,a.request=i,n[1](a)}},"chunk-"+e,e)}};var e=(e,r)=>{var n,s,[i,a,h]=r,l=0;if(i.some(e=>0!==t[e])){for(n in a)o.o(a,n)&&(o.m[n]=a[n]);h&&h(o)}for(e&&e(r);l<i.length;l++)s=i[l],o.o(t,s)&&t[s]&&t[s][0](),t[s]=0},r=self.webpackChunk$rdf=self.webpackChunk$rdf||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))})();var h={};return(()=>{"use strict";o.r(h),o.d(h,{BlankNode:()=>S,Collection:()=>Z,ConnectedStore:()=>Er,DataFactory:()=>hr,Empty:()=>J,Fetcher:()=>rr,Formula:()=>zt,IndexedFormula:()=>te,Literal:()=>G,LiveStore:()=>Rr,N3Parser:()=>Ae,NamedNode:()=>W,Namespace:()=>gt,NextId:()=>Or,Node:()=>$t,Query:()=>Qt,RDFParser:()=>Pe,RDFaProcessor:()=>_e,SPARQLToQuery:()=>ir,Serializer:()=>Ut,Statement:()=>nt,Store:()=>te,UpdateManager:()=>ar,UpdatesSocket:()=>lr,UpdatesVia:()=>cr,Util:()=>e,Variable:()=>ut,blankNode:()=>vr,defaultGraph:()=>br,fetcher:()=>dr,fromNT:()=>Ar,graph:()=>fr,isBlankNode:()=>X,isCollection:()=>F,isGraph:()=>$,isLiteral:()=>P,isNamedNode:()=>H,isPredicate:()=>V,isQuad:()=>q,isRDFObject:()=>z,isRDFlibObject:()=>D,isRDFlibPredicate:()=>L,isRDFlibSubject:()=>M,isStatement:()=>j,isStore:()=>I,isSubject:()=>B,isTerm:()=>U,isVariable:()=>_,jsonParser:()=>nr,lit:()=>pr,literal:()=>yr,log:()=>wt,namedNode:()=>wr,parse:()=>He,quad:()=>Tr,queryToSPARQL:()=>sr,serialize:()=>qt,sparqlUpdateParser:()=>qe,st:()=>mr,sym:()=>wr,term:()=>Cr,termValue:()=>k,triple:()=>xr,uri:()=>t,variable:()=>gr});var t={};o.r(t),o.d(t,{docpart:()=>it,document:()=>at,hostpart:()=>ot,join:()=>ht,protocol:()=>lt,refTo:()=>ct});var e={};function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function n(t,e,n){return(e=function(t){var e=function(t){if("object"!=r(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}o.r(e),o.d(e,{DOMParserFactory:()=>At,RDFArrayRemove:()=>Ft,callbackify:()=>Nt,domToString:()=>Ct,dtstamp:()=>Et,dumpNode:()=>Ot,heavyCompare:()=>Rt,heavyCompareSPO:()=>St,linkRelationProperty:()=>xt,log:()=>wt,mediaTypeClass:()=>Tt,output:()=>kt,parseXML:()=>It,stackString:()=>Mt,string:()=>yt,string_startswith:()=>Dt,uri:()=>t});const s={Literal:1,Collection:3,Graph:4,NamedNode:5,BlankNode:6,Variable:7};class i{constructor(t){n(this,"termType",void 0),n(this,"classOrder",void 0),n(this,"value",void 0),this.value=t}substitute(t){return this}compareTerm(t){return this.classOrder<t.classOrder?-1:this.classOrder>t.classOrder?1:this.value<t.value?-1:this.value>t.value?1:0}equals(t){return!!t&&this.termType===t.termType&&this.value===t.value}hashString(){return this.toCanonical()}sameTerm(t){return this.equals(t)}toCanonical(){return this.toNT()}toNT(){return this.toString()}toNQ(){return this.toNT()}toString(){throw new Error("Node.toString() is abstract - see the subclasses instead")}}n(i,"fromValue",void 0),n(i,"toJS",void 0);const a="NamedNode",l="BlankNode",c="Literal",u="Variable",d="DefaultGraph",f="Collection",p="Empty",m="Graph",w="text/html",g="application/ld+json",v="text/n3",b="application/n3",y="application/nquads",T="application/n-quads",x="application/n-triples",N="application/rdf+xml",A="application/sparql-update",C="application/sparql-update-single-match",O="text/turtle",E="application/x-turtle",R="application/xhtml+xml";class S extends i{static getId(t){if(t){if("string"!=typeof t)throw new Error("Bad id argument to new blank node: "+t);if(t.includes("#")){let e=t.split("#");return e[e.length-1]}return t}return"n"+S.nextId++}constructor(t){super(S.getId(t)),n(this,"termType",l),n(this,"classOrder",s.BlankNode),n(this,"isBlank",1),n(this,"isVar",1)}get id(){return this.value}set id(t){this.value=t}compareTerm(t){return this.classOrder<t.classOrder?-1:this.classOrder>t.classOrder?1:this.id<t.id?-1:this.id>t.id?1:0}copy(t){var e=new S;return t.copyTo(this,e),e}toCanonical(){return S.NTAnonymousNodePrefix+this.value}toString(){return S.NTAnonymousNodePrefix+this.id}}function k(t){return"string"==typeof t?t:t.value}function j(t){return"object"==typeof t&&null!==t&&"subject"in t}function I(t){return"object"==typeof t&&null!==t&&"statements"in t}function F(t){return U(t)&&t.termType===f}function D(t){return t&&Object.prototype.hasOwnProperty.call(t,"termType")&&(t.termType===a||t.termType===u||t.termType===l||t.termType===f||t.termType===c||t.termType===m)}function M(t){return t&&Object.prototype.hasOwnProperty.call(t,"termType")&&(t.termType===a||t.termType===u||t.termType===l||t.termType===f||t.termType===c||t.termType===m)}function L(t){return U(t)&&(t.termType===a||t.termType===l||t.termType===u)}function _(t){return U(t)&&t.termType===u}function U(t){return"object"==typeof t&&null!==t&&"termType"in t}function P(t){return t.termType===c}function q(t){return"object"==typeof t&&null!==t&&"subject"in t&&"predicate"in t&&"object"in t}function H(t){return U(t)&&"NamedNode"===t.termType}function X(t){return U(t)&&"termType"in t&&"BlankNode"===t.termType}function B(t){return U(t)&&(t.termType===a||t.termType===u||t.termType===l)}function V(t){return U(t)&&(t.termType===a||t.termType===u)}function z(t){return U(t)&&(t.termType===a||t.termType===u||t.termType===l||t.termType===c)}function $(t){return U(t)&&(t.termType===a||t.termType===u||t.termType===l||t.termType===d)}n(S,"nextId",0),n(S,"NTAnonymousNodePrefix","_:");class W extends i{constructor(t){if(super(k(t)),n(this,"termType",a),n(this,"classOrder",s.NamedNode),!this.value)throw new Error("Missing IRI for NamedNode");if(!this.value.includes(":"))throw new Error('NamedNode IRI "'+t+'" must be absolute.');if(this.value.includes(" "))throw new Error('Error: NamedNode IRI "'+t+'" must not contain unencoded spaces.')}dir(){var t=this.value.split("#")[0],e=t.slice(0,-1).lastIndexOf("/"),r=t.indexOf("//");return r>=0&&e<r+2||e<0?null:new W(t.slice(0,e+1))}site(){var t=this.value.split("#")[0],e=t.indexOf("//");if(e<0)throw new Error("This URI does not have a web site part (origin)");var r=t.indexOf("/",e+2);return new W(r<0?t.slice(0)+"/":t.slice(0,r+1))}doc(){return this.value.indexOf("#")<0?this:new W(this.value.split("#")[0])}toString(){return"<"+this.value+">"}id(){return this.value.split("#")[1]}get uri(){return this.value}set uri(t){this.value=t}static fromValue(t){return null==t||U(t)?t:new W(t)}}const Q={boolean:new W("http://www.w3.org/2001/XMLSchema#boolean"),dateTime:new W("http://www.w3.org/2001/XMLSchema#dateTime"),decimal:new W("http://www.w3.org/2001/XMLSchema#decimal"),double:new W("http://www.w3.org/2001/XMLSchema#double"),integer:new W("http://www.w3.org/2001/XMLSchema#integer"),langString:new W("http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"),string:new W("http://www.w3.org/2001/XMLSchema#string")};class G extends i{constructor(t,e,r){super(t),n(this,"termType",c),n(this,"classOrder",s.Literal),n(this,"datatype",Q.string),n(this,"isVar",0),n(this,"language",""),e?(this.language=e,this.datatype=Q.langString):this.datatype=r?W.fromValue(r):Q.string}copy(){return new G(this.value,this.lang,this.datatype)}equals(t){return!!t&&this.termType===t.termType&&this.value===t.value&&this.language===t.language&&(!this.datatype&&!t.datatype||this.datatype&&this.datatype.equals(t.datatype))}get lang(){return this.language}set lang(t){this.language=t||""}toNT(){return G.toNT(this)}static toNT(t){if("number"==typeof t.value)return""+t.value;if("string"!=typeof t.value)throw new Error("Value of RDF literal is not string or number: "+t.value);var e=t.value;return e='"'+(e=(e=(e=(e=e.replace(/\\/g,"\\\\")).replace(/\"/g,'\\"')).replace(/\n/g,"\\n")).replace(/\r/g,"\\r"))+'"',t.language?e+="@"+t.language:t.datatype.equals(Q.string)||(e+="^^"+t.datatype.toCanonical()),e}toString(){return""+this.value}static fromBoolean(t){return new G(t?"1":"0",null,Q.boolean)}static fromDate(t){if(!(t instanceof Date))throw new TypeError("Invalid argument to Literal.fromDate()");let e=function(t){return(""+(100+t)).slice(1,3)},r=t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"Z";return new G(r,null,Q.dateTime)}static fromNumber(t){if("number"!=typeof t)throw new TypeError("Invalid argument to Literal.fromNumber()");let e;const r=t.toString();return e=r.indexOf("e")<0&&Math.abs(t)<=Number.MAX_SAFE_INTEGER?Number.isInteger(t)?Q.integer:Q.decimal:Q.double,new G(r,null,e)}static fromValue(t){if(P(t))return t;switch(typeof t){case"object":if(t instanceof Date)return G.fromDate(t);case"boolean":return G.fromBoolean(t);case"number":return G.fromNumber(t);case"string":return new G(t)}throw new Error("Can't make literal from "+t+" of type "+typeof t)}}function Y(t){return null==t||U(t)?t:Array.isArray(t)?new Z(t):G.fromValue(t)}class Z extends i{constructor(t){super((S.nextId++).toString()),n(this,"termType",f),n(this,"classOrder",s.Collection),n(this,"closed",!1),n(this,"compareTerm",S.prototype.compareTerm),n(this,"elements",[]),n(this,"isVar",0),t&&t.length>0&&t.forEach(t=>{this.elements.push(Y(t))})}get id(){return this.value}set id(t){this.value=t}append(t){return this.elements.push(t)}close(){return this.closed=!0,this.closed}shift(){return this.elements.shift()}substitute(t){const e=this.elements.map(e=>e.substitute(t));return new Z(e)}toNT(){return Z.toNT(this)}static toNT(t){return S.NTAnonymousNodePrefix+t.id}toString(){return"("+this.elements.join(" ")+")"}unshift(t){return this.elements.unshift(t)}}n(Z,"termType",f);class J extends i{constructor(){super(""),n(this,"termType",p)}toString(){return"()"}}const K="chrome:theSession";new W(K);class tt extends i{constructor(){super(""),n(this,"value",""),n(this,"termType",d),n(this,"uri",K)}toCanonical(){return this.value}toString(){return"DefaultGraph"}}function et(t){return!!t&&t.termType===d}const rt=new tt;class nt{constructor(t,e,r,s){n(this,"subject",void 0),n(this,"predicate",void 0),n(this,"object",void 0),n(this,"graph",void 0),this.subject=i.fromValue(t),this.predicate=i.fromValue(e),this.object=i.fromValue(r),this.graph=null==s?rt:i.fromValue(s)}get why(){return this.graph}set why(t){this.graph=t}equals(t){return t.subject.equals(this.subject)&&t.predicate.equals(this.predicate)&&t.object.equals(this.object)&&t.graph.equals(this.graph)}substitute(t){return new nt(this.subject.substitute(t),this.predicate.substitute(t),this.object.substitute(t),et(this.graph)?this.graph:this.graph.substitute(t))}toCanonical(){let t=[this.subject.toCanonical(),this.predicate.toCanonical(),this.object.toCanonical()];return this.graph&&this.graph.termType!==d&&t.push(this.graph.toCanonical()),t.join(" ")+" ."}toNT(){return[this.subject.toNT(),this.predicate.toNT(),this.object.toNT()].join(" ")+" ."}toNQ(){return[this.subject.toNT(),this.predicate.toNT(),this.object.toNT(),et(this.graph)?"":this.graph.toNT()].join(" ")+" ."}toString(){return this.toNT()}}var st=st||console.log;function it(t){var e;return(e=t.indexOf("#"))<0?t:t.slice(0,e)}function at(t){return new W(it(t))}function ot(t){var e=/[^\/]*\/\/([^\/]*)\//.exec(t);return e?e[1]:""}function ht(t,e){var r,n,s,i,a,o=e.indexOf("#");if(o>0&&(e=e.slice(0,o)),0===t.length)return e;if(0===t.indexOf("#"))return e+t;if(t.indexOf(":")>=0)return t;if(r=e.indexOf(":"),0===e.length)return t;if(r<0)return st("Invalid base: "+e+" in join with given: "+t),t;if(n=e.slice(0,+r+1||9e9),0===t.indexOf("//"))return n+t;if(e.indexOf("//",r)===r+1){if((s=e.indexOf("/",r+3))<0)return e.length-r-3>0?e+"/"+t:n+t}else if((s=e.indexOf("/",r+1))<0)return e.length-r-1>0?e+"/"+t:n+t;if(0===t.indexOf("/"))return e.slice(0,s)+t;if((i=(a=e.slice(s)).lastIndexOf("/"))<0)return n+t;for(i>=0&&i<a.length-1&&(a=a.slice(0,+i+1||9e9)),a+=t;a.match(/[^\/]*\/\.\.\//);)a=a.replace(/[^\/]*\/\.\.\//,"");return a=(a=a.replace(/\.\//g,"")).replace(/\/\.$/,"/"),e.slice(0,s)+a}function lt(t){const e=t.indexOf(":");return e<0?null:t.slice(0,e)}function ct(t,e){var r,n,s,i,a,o,h,l,c,u,d,f,p=new RegExp("^[-_a-zA-Z0-9.]+:(//[^/]*)?/[^/]*$");if(!t)return e;if(t===e)return"";for(r=h=0,i=e.length;h<i&&e[r]===t[r];r=++h);if(t.slice(0,r).match(p)&&((n=e.indexOf("//"))<0&&(n=-2),s=e.indexOf("/",n+2),"/"!==e[s+1]&&"/"!==t[s+1]&&e.slice(0,s)===t.slice(0,s)))return e.slice(s);if("#"===e[r]&&t.length===r)return e.slice(r);for(;r>0&&"/"!==e[r-1];)r--;if(r<3)return e;if(t.indexOf("//",r-2)>0||e.indexOf("//",r-2)>0)return e;if(t.indexOf(":",r)>0)return e;for(o=0,l=0,a=(u=t.slice(r)).length;l<a;l++)"/"===u[l]&&o++;if(0===o&&r<e.length&&"#"===e[r])return"./"+e.slice(r);if(0===o&&r===e.length)return"./";if(f="",o>0)for(c=1,d=o;d>=1?c<=d:c>=d;d>=1?++c:--c)f+="../";return f+e.slice(r)}class ut extends i{constructor(t=""){super(t),n(this,"termType",u),n(this,"base","varid:"),n(this,"classOrder",s.Variable),n(this,"isVar",1),n(this,"uri",void 0),this.base="varid:",this.uri=ht(t,this.base)}equals(t){return!!t&&this.termType===t.termType&&this.value===t.value}hashString(){return this.toString()}substitute(t){var e;return null!=(e=t[this.toNT()])?e:this}toString(){return ut.toString(this)}static toString(t){return t.uri.slice(0,t.base.length)===t.base?`?${t.uri.slice(t.base.length)}`:`?${t.uri}`}}let dt=function(t){return t.collections="COLLECTIONS",t.defaultGraphType="DEFAULT_GRAPH_TYPE",t.equalsMethod="EQUALS_METHOD",t.id="ID",t.identity="IDENTITY",t.reversibleId="REVERSIBLE_ID",t.variableType="VARIABLE_TYPE",t}({});const ft=new tt,pt={supports:{[dt.collections]:!1,[dt.defaultGraphType]:!1,[dt.equalsMethod]:!0,[dt.identity]:!1,[dt.id]:!0,[dt.reversibleId]:!1,[dt.variableType]:!0},blankNode:t=>new S(t),defaultGraph:()=>ft,equals(t,e){return t===e||!t||!e||(q(t)||q(e)?!(!q(t)||!q(e))&&this.equals(t.subject,e.subject)&&this.equals(t.predicate,e.predicate)&&this.equals(t.object,e.object)&&this.equals(t.graph,e.graph):!(!U(t)||!U(e))&&this.id(t)===this.id(e))},id(t){if(!t)return"undefined";if(q(t))return this.quadToNQ(t);switch(t.termType){case d:return"defaultGraph";case u:return ut.toString(t);default:const e=this.termToNQ(t);if(e)return e;throw new Error(`Can't id term with type '${t.termType}'`)}},isQuad:t=>t instanceof nt,literal(t,e){if("string"!=typeof t&&!e)return G.fromValue(t);const r="string"==typeof t?t:""+t;return"string"==typeof e?-1===e.indexOf(":")?new G(r,e):new G(r,null,this.namedNode(e)):new G(r,null,e)},namedNode:t=>new W(t),quad:(t,e,r,n)=>new nt(t,e,r,n||ft),triple(t,e,r,n){return this.quad(t,e,r,n)},quadToNQ(t){return`${this.termToNQ(t.subject)} ${this.termToNQ(t.predicate)} ${this.termToNQ(t.object)} ${this.termToNQ(t.graph)} .`},termToNQ(t){switch(t.termType){case l:return"_:"+t.value;case d:return"";case p:return"<http://www.w3.org/1999/02/22-rdf-syntax-ns#nil>";case c:return G.toNT(t);case m:case a:return"<"+t.value+">";case f:return"("+t.elements.map(t=>this.termToNQ(t)).join(" ")+")";default:throw new Error(`Can't serialize nonstandard term type (was '${t.termType}')`)}},toNQ(t){return this.isQuad(t)?this.quadToNQ(t):this.termToNQ(t)},variable:t=>new ut(t)},mt=pt,wt={debug(t){},warn(t){},info(t){},error(t){},success(t){},msg(t){}};function gt(t,e){const r=e||{namedNode:t=>new W(t)};return function(e){return r.namedNode(t+(e||""))}}var vt=o(540),bt=o.n(vt);const yt={template:function(t,e){for(var r=t.split("%s"),n="",s=0;s<e.length;s++)e[s]+="",n+=r[s]+e[s];return n+r.slice(e.length).join()}};function Tt(t){return t=t.split(";")[0].trim(),new W("http://www.w3.org/ns/iana/media-types/"+t+"#Resource")}function xt(t){return new W("http://www.w3.org/ns/iana/link-relations/relation#"+t.trim())}function Nt(t,e){t.callbacks={};for(var r=e.length-1;r>=0;r--)t.callbacks[e[r]]=[];t.addHook=function(e){t.callbacks[e]||(t.callbacks[e]=[])},t.addCallback=function(e,r){t.callbacks[e].push(r)},t.removeCallback=function(e,r){for(var n=0;n<t.callbacks[e].length;n++)if(t.callbacks[e][n].name===r)return t.callbacks[e].splice(n,1),!0;return!1},t.insertCallback=function(e,r){t.callbacks[e].unshift(r)},t.fireCallbacks=function(e,r){var n,s=[],i=[],a=t.callbacks[e].length;let o;for(n=a-1;n>=0;n--)o=t.callbacks[e][n],o&&o.apply(t,r)&&s.push(o);for(n=s.length-1;n>=0;n--)i.push(s[n]);for(n=a;n<t.callbacks[e].length;n++)i.push(t.callbacks[e][n]);t.callbacks[e]=i}}function At(){return window.DOMParser?new DOMParser:!!window.ActiveXObject&&new ActiveXObject("Microsoft.XMLDOM")}function Ct(t,e){var r=[];(e=e||{})&&e.selfClosing&&e.selfClosing.split(" ").forEach(function(t){r[t]=!0});var n=[];return e&&e.skipAttributes&&e.skipAttributes.split(" ").forEach(function(t){n[t]=!0}),Ot(t,e,r,n)}function Ot(t,e,r,n){var s,i="",a=[!1];if(void 0===t.nodeType)return i;if(1===t.nodeType){if(t.hasAttribute("class")&&e&&e.classWithChildText&&t.matches(e.classWithChildText.class))i+=t.querySelector(e.classWithChildText.element).textContent;else if(!(e&&e.skipNodeWithClass&&t.matches("."+e.skipNodeWithClass))){var o=t.nodeName.toLowerCase();i+="<"+o;var h=[];for(s=t.attributes.length-1;s>=0;s--){var l=t.attributes[s];if(!(n&&n.length>0&&n[l.name]||/^\d+$/.test(l.name))){if("class"===l.name&&e&&e.replaceClassItemWith&&l.value.split(" ").indexOf(e.replaceClassItemWith.source)>-1){var c=new RegExp(e.replaceClassItemWith.source,"g");l.value=l.value.replace(c,e.replaceClassItemWith.target).trim()}"class"===l.name&&e&&e.skipClassWithValue&&e.skipClassWithValue===l.value||h.push(l.name+"='"+l.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&quot;")+"'")}}if(h.length>0&&(e&&e.sortAttributes&&h.sort(function(t,e){return t.toLowerCase().localeCompare(e.toLowerCase())}),i+=" "+h.join(" ")),r&&r.ename)i+=" />";else{for(i+=">",i+="html"===o?"\n  ":"",a.push("style"===o||"script"===o),s=0;s<t.childNodes.length;s++)i+=Ot(t.childNodes[s]);a.pop(),i+="body"===o?"</"+o+">\n":"</"+o+">"}}}else if(8===t.nodeType)i+="\x3c!--"+t.nodeValue+"--\x3e";else if(3===t.nodeType||4===t.nodeType){var u=t.nodeValue.replace(/\n+$/,"");i+=a[a.length-1]?u:u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}else console.log("Warning; Cannot handle serialising nodes of type: "+t.nodeType),console.log(t);return i}function Et(){var t=new Date,e=t.getYear()+1900,r=t.getMonth()+1,n=t.getDate(),s=t.getUTCHours(),i=t.getUTCMinutes(),a=t.getSeconds();return r<10&&(r="0"+r),n<10&&(n="0"+n),s<10&&(s="0"+s),i<10&&(i="0"+i),a<10&&(a="0"+a),e+"-"+r+"-"+n+"T"+s+":"+i+":"+a+"Z"}function Rt(t,e,r,n){var s=function(t){return"BlankNode"===t.termType?null:t},i=function(t){var e=r.statementsMatching(t).map(function(t){return s(t.subject)+" "+s(t.predicate)+" "+s(t.object)}).concat(r.statementsMatching(void 0,void 0,t).map(function(t){return s(t.subject)+" "+s(t.predicate)+" "+s(t.object)}));return e.sort(),e.join("\n")};const a=Object.prototype.hasOwnProperty.call(r,"compareTerms")?r.compareTerms(t,e):t.compareTerm(e);return"BlankNode"===t.termType&&"BlankNode"===e.termType?0===a?0:i(t)>i(e)?1:i(t)<i(e)?-1:a:n&&t.uri&&e.uri?(n[t.uri]||t.uri).localeCompare(n[e.uri]||e.uri):a}function St(t,e,r,n){return Rt(t.subject,e.subject,r,n)||Rt(t.predicate,e.predicate,r,n)||Rt(t.object,e.object,r,n)}function kt(t){var e=document.createElement("div");e.textContent=t,document.body.appendChild(e)}let jt=null;function It(t,e){const r=(e=e||{}).contentType||"application/xml";if("undefined"!=typeof window&&window.DOMParser)return(new window.DOMParser).parseFromString(t,r);if("undefined"!=typeof process&&process.versions&&process.versions.node){const r=function(){if(jt)return jt;try{const t=o(392);return jt=new t.DOMParser,jt}catch(t){return null}}();if(r)return r.parseFromString(t,e.contentType||"application/xhtml+xml")}if("undefined"!=typeof DOMParser)return(new DOMParser).parseFromString(t,r);throw new Error("No DOMParser available")}function Ft(t,e){for(var r=0;r<t.length;r++)if(t[r].subject.equals(e.subject)&&t[r].predicate.equals(e.predicate)&&t[r].object.equals(e.object)&&t[r].why.equals(e.why))return void t.splice(r,1);throw new Error("RDFArrayRemove: Array did not contain "+e+" "+e.why)}function Dt(t,e){return t.slice(0,e.length)===e}function Mt(t){var e=t+"\n";if(!t.stack)return e+"No stack available.\n";for(var r=t.stack.toString().split("\n"),n=[],s=0;s<r.length;s++){var i=r[s];if(i.indexOf("ecmaunit.js")>-1)break;"("==i.charAt(0)&&(i="function"+i);var a=i.split("@");n.push(a)}for(s=0;s<n.length;s++)e+="  "+n[s][1]+"\n    "+n[s][0];return e}function Lt(t=mt){return{boolean:t.namedNode("http://www.w3.org/2001/XMLSchema#boolean"),dateTime:t.namedNode("http://www.w3.org/2001/XMLSchema#dateTime"),decimal:t.namedNode("http://www.w3.org/2001/XMLSchema#decimal"),double:t.namedNode("http://www.w3.org/2001/XMLSchema#double"),integer:t.namedNode("http://www.w3.org/2001/XMLSchema#integer"),langString:t.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"),string:t.namedNode("http://www.w3.org/2001/XMLSchema#string")}}Lt(mt);let _t=null;function Ut(t){return new Pt(t)}class Pt{constructor(t){n(this,"_notQNameChars","\t\r\n !\"#$%&'()*,+/;<=>?@[\\]^`{|}~"),n(this,"_notNameChars",this._notQNameChars+":"),n(this,"validPrefix",new RegExp(/^[a-zA-Z][a-zA-Z0-9]*$/)),n(this,"forbidden1",new RegExp(/[\\"\b\f\r\v\t\n\u0080-\uffff]/gm)),n(this,"forbidden3",new RegExp(/[\\"\b\f\r\v\u0080-\uffff]/gm)),this.flags="",this.base=null,this.prefixes=[],this.namespaces=[];const e=Object.keys(bt()());for(const t in e){const r=bt()()[e[t]](""),n=e[t];this.prefixes[r]=n,this.namespaces[n]=r}this.suggestPrefix("rdf","http://www.w3.org/1999/02/22-rdf-syntax-ns#"),this.suggestPrefix("xml","reserved:reservedForFutureUse"),this.namespacesUsed=[],this.keywords=["a"],this.prefixchars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",this.incoming=null,this.formulas=[],this.store=t,this.rdfFactory=t.rdfFactory||mt,this.xsd=Lt(this.rdfFactory)}setBase(t){return this.base=t,this}setFlags(t){return this.flags=t||"",this}toStr(t){var e=t.toNT();return"Graph"===t.termType&&(this.formulas[e]=t),e}fromStr(t){if("{"===t[0]){var e=this.formulas[t];return e||console.log("No formula object for "+t),e}return this.store.fromNT(t)}setNamespaces(t){for(var e in t)this.setPrefix(e,t[e]);return this}setPrefix(t,e){if("default"!==t.slice(0,7)&&"ns"!==t.slice(0,2)&&t&&e){for(let e in this.prefixes)this.prefixes[e]==t&&delete this.prefixes[e];this.prefixes[e]=t,this.namespaces[t]=e}}suggestPrefix(t,e){"default"!==t.slice(0,7)&&"ns"!==t.slice(0,2)&&t&&e&&(t in this.namespaces||e in this.prefixes||(this.prefixes[e]=t,this.namespaces[t]=e))}suggestNamespaces(t){for(var e in t)this.suggestPrefix(e,t[e]);return this}checkIntegrity(){var t,e;for(t in this.namespaces)if(this.prefixes[this.namespaces[t]]!==t)throw new Error("Serializer integity error 1: "+t+", "+this.namespaces[t]+", "+this.prefixes[this.namespaces[t]]+"!");for(e in this.prefixes)if(this.namespaces[this.prefixes[e]]!==e)throw new Error("Serializer integity error 2: "+e+", "+this.prefixs[e]+", "+this.namespaces[this.prefixes[e]]+"!")}makeUpPrefix(t){var e=t,r=function(e){return!!this.validPrefix.test(e)&&"ns"!==e&&!(e in this.namespaces)&&(this.prefixes[t]=e,this.namespaces[e]=t,e)}.bind(this);"#/".indexOf(e[e.length-1])>=0&&(e=e.slice(0,-1));var n=e.lastIndexOf("/");n>=0&&(e=e.slice(n+1));for(var s=0;s<e.length&&this.prefixchars.indexOf(e[s])>=0;)s++;if((e=e.slice(0,s)).length<6&&r(e))return e;if(r(e.slice(0,3)))return e.slice(0,3);if(r(e.slice(0,2)))return e.slice(0,2);if(r(e.slice(0,4)))return e.slice(0,4);if(r(e.slice(0,1)))return e.slice(0,1);if(r(e.slice(0,5)))return e.slice(0,5);this.validPrefix.test(e)||(e="n");for(var i=0;;i++)if(r(e.slice(0,3)+i))return e.slice(0,3)+i}rootSubjects(t){for(var e={},r={},n={},s=0;s<t.length;s++){var i=t[s],a=function(t){e.hasOwnProperty(t)||(e[t]=[]),e[t].push(i.subject)};[i.subject,i.predicate,i.object].map(function(t){"BlankNode"===t.termType?n[t.toNT()]=!0:"Collection"===t.termType&&t.elements.forEach(function(t){a(t)})}),a(t[s].object);var o=r[this.toStr(i.subject)];o||(o=[]),o.push(i),r[this.toStr(i.subject)]=o}var h=[];for(var l in r)if(r.hasOwnProperty(l)){var c=this.fromStr(l);"BlankNode"===c.termType&&e[c]&&1===e[c].length||h.push(c)}this.incoming=e;for(var u={},d=0;d<h.length;d++)u[h[d].toNT()]=!0;return{roots:h,subjects:r,rootsHash:u,incoming:e}}toN3(t){return this.statementsToN3(t.statements)}isValidPNLocal(t){if(0===t.length)return!0;if("."===t[t.length-1])return!1;for(var e=0;e<t.length;e++){var r=t[e];if("."!==r&&this._notNameChars.indexOf(r)>=0)return!1}return!0}explicitURI(t){var e;return this.flags.indexOf("r")<0&&this.base?t=ct(this.base,t):this.flags.indexOf("u")>=0?t=function(t){for(var e,r="",n=0;n<t.length;n++)r+=(e=t.charCodeAt(n))>65535?"\\U"+("00000000"+e.toString(16)).slice(-8):e>126?"\\u"+("0000"+e.toString(16)).slice(-4):t[n];return r}(t):(e=decodeURI(t),t=encodeURI(e)),"<"+t+">"}statementsToNTriples(t){var e=t.slice();e.sort();for(var r="",n="http://www.w3.org/1999/02/22-rdf-syntax-ns#",s=this,i=this.store,a=this.rdfFactory,o=function(t){if("Collection"!==t.termType)return s.atomicTermToN3(t);for(var e=t.elements,h=i.sym(n+"nill"),l=e.length-1;l>=0;l--){var c=a.blankNode();r+=o(c)+" "+o(i.sym(n+"first"))+" "+o(e[l])+".\n",r+=o(c)+" "+o(i.sym(n+"rest"))+" "+o(h)+".\n",h=c}return s.atomicTermToN3(h)},h=0;h<e.length;h++){var l=e[h],c="";c+=o(l.subject)+" ",c+=o(l.predicate)+" ",c+=o(l.object)+" ",this.flags.indexOf("q")>=0&&(c+=o(l.why)+" "),r+=c+=".\n"}return r}statementsToN3(t){var e=this.store,r={"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":"aaa:00"};t.sort(function(t,n){return St(t,n,e,r)}),this.base&&!this.defaultNamespace&&(this.defaultNamespace=this.base+"#");var n={};this.flags.indexOf("s")<0&&(n["http://www.w3.org/2002/07/owl#sameAs"]="="),this.flags.indexOf("t")<0&&(n["http://www.w3.org/1999/02/22-rdf-syntax-ns#type"]="a"),this.flags.indexOf("i")<0&&(n["http://www.w3.org/2000/10/swap/log#implies"]="=>");var s=function(t){for(var e="",r=0;r<t;r++)e+=" ";return e},i=function(t){for(var e="",r=0;r<t.length;r++){var n=t[r],s="string"==typeof n?n:i(n);if(0!==r){var a=e.slice(-1)||" ";","===s||";"===s||("."!==s||"0123456789.:".includes(a))&&(e+=" ")}e+=s}return e},a=function(t,e){var r="",n=1e5;void 0===e&&(e=-1);for(var o=0;o<t.length;o++){var h=t[o];if("string"!=typeof h){var l=a(h,e+1);if(l.length<10*(80-4*e)&&l.indexOf('"""')<0){var c=i(h);c.length<80-4*e&&(h=c,l="")}l&&(n=1e4),r+=l}if("string"==typeof h){if(1===h.length&&"\n"===r.slice(-1)&&",.;".indexOf(h)>=0){r=r.slice(0,-1),"."==h&&"0123456789.:".includes(r.charAt(r.length-1))&&(r+=" ",n+=1),r+=h+"\n",n+=1;continue}if(n<4*e+4||n+h.length+1<80&&";.".indexOf(r[r.length-2])<0)r=r.slice(0,-1)+" "+h+"\n",n+=h.length+1;else{let t=s(4*e)+h;r+=t+"\n",n=t.length,e<0&&(r+="\n",n=1e5)}}}return r},o=function(t){for(var e=this.rootSubjects(t),r=e.roots,n=[],s=0;s<r.length;s++){var i=r[s];n.push(h(i,e))}return n}.bind(this);function h(t,e){return"BlankNode"!==t.termType||e.incoming[t]?[u(t,e)].concat([l(t,e)]).concat(["."]):c(t,e,!0).concat(["."])}var l=function(t,e){var r=[],s=null,i=e.subjects[this.toStr(t)]||[];if(void 0===i)throw new Error("Cant find statements for "+t);for(var a=[],o=0;o<i.length;o++){var h=i[o];h.predicate.uri===s?a.push(","):(s&&(r=r.concat([a]).concat([";"]),a=[]),r.push(n[h.predicate.uri]?n[h.predicate.uri]:u(h.predicate,e))),s=h.predicate.uri,a.push(c(h.object,e))}return r.concat([a])}.bind(this),c=function(t,e,r){return"BlankNode"!==t.termType||!r&&void 0!==e.rootsHash[t.toNT()]?u(t,e):e.subjects[this.toStr(t)]?["[",l(t,e),"]"]:"[]"}.bind(this);Pt.prototype.termToN3=u;var u=function(t,e){var r,n;switch(t.termType){case"Graph":return(n=(n=["{"]).concat(o(t.statements))).concat(["}"]);case"Collection":for(n=["("],r=0;r<t.elements.length;r++)n.push([c(t.elements[r],e)]);return n.push(")"),n;default:return this.atomicTermToN3(t)}}.bind(this),d=function(){var t="";for(var e in this.flags.indexOf("d")<0&&this.defaultNamespace&&(t+="@prefix : "+this.explicitURI(this.defaultNamespace)+".\n"),this.prefixes)this.prefixes.hasOwnProperty(e)&&this.namespacesUsed[e]&&(t+="@prefix "+this.prefixes[e]+": "+this.explicitURI(e)+".\n");return t+"\n"}.bind(this),f=o(t);return d()+a(f)}atomicTermToN3(t,e){switch(t.termType){case"BlankNode":case"Variable":return t.toNT();case"Literal":var r=t.value;if("string"!=typeof r)throw new TypeError("Value of RDF literal node must be a string");if(t.datatype&&this.flags.indexOf("x")<0)switch(t.datatype.uri){case"http://www.w3.org/2001/XMLSchema#integer":return r;case"http://www.w3.org/2001/XMLSchema#decimal":return r.indexOf(".")<0&&(r+=".0"),r;case"http://www.w3.org/2001/XMLSchema#double":{const t=r.toLowerCase().indexOf("e")>0;return r.indexOf(".")<0&&!t&&(r+=".0"),t||(r+="e0"),r}case"http://www.w3.org/2001/XMLSchema#boolean":return"1"===t.value?"true":"false"}var n=this.stringToN3(t.value,this.flags);return t.language?n+="@"+t.language:t.datatype.equals(this.xsd.string)||(n+="^^"+this.atomicTermToN3(t.datatype,e)),n;case"NamedNode":return this.symbolToN3(t);case"DefaultGraph":return"";default:throw new Error("Internal: atomicTermToN3 cannot handle "+t+" of termType: "+t.termType)}}stringToN3(t,e){e||(e="e");var r,n,s,i,a,o="";for(t.length>20&&'"'!==t.slice(-1)&&e.indexOf("n")<0&&(t.indexOf("\n")>0||t.indexOf('"')>0)?(i='"""',a=this.forbidden3):(i='"',a=this.forbidden1),r=0;r<t.length&&(a.lastIndex=0,null!=a.exec(t.slice(r)));){n=r+a.lastIndex-1,o+=t.slice(r,n);var h=t[n];'"'===h&&'"""'===i&&'"""'!==t.slice(n,n+3)?o+=h:(s='\b\f\r\t\v\n\\"'.indexOf(h))>=0?o+="\\"+'bfrtvn\\"'[s]:e.indexOf("e")>=0?o+="\\u"+("000"+h.charCodeAt(0).toString(16).toLowerCase()).slice(-4):o+=h,r=n+1}return i+o+t.slice(r)+i}symbolToN3(t){var e=t.uri,r=e.indexOf("#");if(r<0&&this.flags.indexOf("/")<0&&(r=e.lastIndexOf("/")),r>=0&&this.flags.indexOf("p")<0&&(0===e.indexOf("http")||0===e.indexOf("ws")||0===e.indexOf("file"))){var n=e.slice(r+1),s=e.slice(0,r+1),i=e.indexOf("://")+4,a=this.base?this.base.slice(0,Math.max(this.base.lastIndexOf("/"),this.base.lastIndexOf("#"))+1):null,o=a&&s===a,h=this.flags.indexOf("o")>=0&&n.indexOf(".")>=0;if(!o&&!h&&s.length>i&&this.isValidPNLocal(n)){if(this.defaultNamespace&&this.defaultNamespace===s&&this.flags.indexOf("d")<0)return this.flags.indexOf("k")>=0&&this.keyords.indexOf(n)<0?n:":"+n;var l=this.prefixes[s];if(l||(l=this.makeUpPrefix(s)),l)return this.namespacesUsed[s]=!0,l+":"+n}}return this.explicitURI(e)}writeStore(t){var e=this.store,r=e.fetcher,n=r&&r.appNode,s=this.store.index[3];for(var i in s){var a=e.fromNT(i);n&&a.equals(n)||t("\n"+this.atomicTermToN3(a)+" "+this.atomicTermToN3(e.sym("http://www.w3.org/2000/10/swap/log#semantics"))+" { "+this.statementsToN3(e.statementsMatching(void 0,void 0,void 0,a))+" }.\n")}e.statementsMatching(void 0,e.sym("http://www.w3.org/2007/ont/link#requestedURI")).map(function(r){t("\n<"+r.object.value+"> log:metadata {\n");var n=e.statementsMatching(void 0,void 0,void 0,r.subject);t(this.statementsToN3(this.statementsToN3(n))),t("}.\n")});var o=[];n&&o.push(n);var h=[];o.map(function(t){h=h.concat(e.statementsMatching(void 0,void 0,void 0,t))}),t(this.statementsToN3(h))}statementsToXML(t){var e=[];e["http://www.w3.org/1999/02/22-rdf-syntax-ns#"]=!0;var r="http://www.w3.org/1999/02/22-rdf-syntax-ns#_",n=function(t){for(var e="",r=0;r<t;r++)e+=" ";return e},s=function(t){for(var e="",r=0;r<t.length;r++){var n=t[r];e+="string"==typeof n?n:s(n)}return e},i=function(t,e){var r,a="",o=1e5;e||(e=0);for(var h=0;h<t.length;h++){var l=t[h];if("string"!=typeof l){var c=i(l,e+1);c.length<10*(80-4*e)&&c.indexOf('"""')<0&&(r=s(l)).length<80-4*e&&(l="   "+r,c=""),c&&(o=1e4),a+=c}"string"==typeof l&&(o<4*e+4?(a=a.slice(0,-1)+" "+l+"\n",o+=l.length+1):(a+=(r=n(4*e)+l)+"\n",o=r.length))}return a},a=function(t){this.suggestPrefix("rdf","http://www.w3.org/1999/02/22-rdf-syntax-ns#");for(var e=this.rootSubjects(t),r=e.roots,n=[],s=0;s<r.length;s++){var i=r[s];n.push(l(i,e))}return n}.bind(this);function o(t){return void 0===t?"@@@undefined@@@@":t.replace(/[&<"]/g,function(t){switch(t[0]){case"&":return"&amp;";case"<":return"&lt;";case'"':return"&quot;"}})}var h=function(t){return o(this.base?ct(this.base,t.uri):t.uri)}.bind(this),l=function(t,e){var n,s,i,a,f=[],p=e.subjects[this.toStr(t)];if(void 0===p)return u(t,e);p.sort(function(t,e){var n=t.predicate.uri,s=e.predicate.uri;if(n.substring(0,44)===r||s.substring(0,44)===r)return n.localeCompare(s);var i=n.substring(44),a=s.substring(44),o=parseInt(i,10),h=parseInt(a,10);return isNaN(o)||isNaN(h)||o!==i||h!==a?n.localeCompare(s):o-h});for(var m=0;m<p.length;m++)if("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"!==(i=p[m]).predicate.uri||n||"NamedNode"!==i.object.termType){if((a=i.predicate).uri.substr(0,44)===r){var w=a.uri.substr(44);w===parseInt(w,10).toString()&&(a=this.rdfFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#li"))}switch(s=d(a),i.object.termType){case"BlankNode":f=1===e.incoming[i.object].length?f.concat(["<"+s+' rdf:parseType="Resource">',l(i.object,e),"</"+s+">"]):f.concat(["<"+s+' rdf:nodeID="'+i.object.toNT().slice(2)+'"/>']);break;case"NamedNode":f=f.concat(["<"+s+' rdf:resource="'+h(i.object)+'"/>']);break;case"Literal":f=f.concat(["<"+s+(i.object.language?' xml:lang="'+i.object.language+'"':i.object.datatype.equals(this.xsd.string)?"":' rdf:datatype="'+o(i.object.datatype.uri)+'"')+">"+o(i.object.value)+"</"+s+">"]);break;case"Collection":f=f.concat(["<"+s+' rdf:parseType="Collection">',c(i.object,e),"</"+s+">"]);break;default:throw new Error("Can't serialize object of type "+i.object.termType+" into XML")}}else n=i.object;var g=n?d(n):"rdf:Description",v="";return"BlankNode"===t.termType?e.incoming[t]&&1===e.incoming[t].length||(v=' rdf:nodeID="'+t.toNT().slice(2)+'"'):v=' rdf:about="'+h(t)+'"',["<"+g+v+">"].concat([f]).concat(["</"+g+">"])}.bind(this);function c(t,e){for(var r=[],n=0;n<t.elements.length;n++)r.push(l(t.elements[n],e));return r}var u=function(t,e){var r=[],n=e.subjects[this.toStr(t)];if(!n)return r;n.sort();for(var s=0;s<n.length;s++){var i=n[s];switch(i.object.termType){case"BlankNode":r=e.rootsHash[i.object.toNT()]?r.concat(["<"+d(i.predicate)+' rdf:nodeID="'+i.object.toNT().slice(2)+'">',"</"+d(i.predicate)+">"]):r.concat(["<"+d(i.predicate)+' rdf:parseType="Resource">',u(i.object,e),"</"+d(i.predicate)+">"]);break;case"NamedNode":r=r.concat(["<"+d(i.predicate)+' rdf:resource="'+h(i.object)+'"/>']);break;case"Literal":r=r.concat(["<"+d(i.predicate)+(i.object.language?' xml:lang="'+i.object.language+'"':i.object.datatype.equals(this.xsd.string)?"":' rdf:datatype="'+o(i.object.datatype.value)+'"')+">"+o(i.object.value)+"</"+d(i.predicate)+">"]);break;case"Collection":r=r.concat(["<"+d(i.predicate)+' rdf:parseType="Collection">',c(i.object,e),"</"+d(i.predicate)+">"]);break;default:throw new Error("Can't serialize object of type "+i.object.termType+" into XML")}}return r}.bind(this),d=function(t){var r=t.uri,n=r.indexOf("#");if(n<0&&this.flags.indexOf("/")<0&&(n=r.lastIndexOf("/")),n<0)throw new Error("Cannot make qname out of <"+r+">");for(var s=n+1;s<r.length;s++)if(this._notNameChars.indexOf(r[s])>=0)throw new Error('Invalid character "'+r[s]+'" cannot be in XML qname for URI: '+r);var i=r.slice(n+1),a=r.slice(0,n+1);if(this.defaultNamespace&&this.defaultNamespace===a&&this.flags.indexOf("d")<0)return i;var o=this.prefixes[a];return o||(o=this.makeUpPrefix(a)),e[a]=!0,o+":"+i}.bind(this),f=a(t),p="<rdf:RDF";for(var m in this.defaultNamespace&&(p+=' xmlns="'+o(this.defaultNamespace)+'"'),e)if(e.hasOwnProperty(m)){var w=this.base&&this.flags.includes("z")?ct(this.base,m):m;p+="\n xmlns:"+this.prefixes[m]+'="'+o(w)+'"'}return i([p+=">",f,"</rdf:RDF>"],-1)}statementsToJsonld(t){const e=function(){if(_t)return _t;try{_t=o(312)}catch(t){throw new Error("JSON-LD serialization requires @frogcat/ttl2jsonld. Install it with: npm install @frogcat/ttl2jsonld")}return _t}(),r=this.statementsToN3(t),n=e.parse(r);return JSON.stringify(n,null,2)}}function qt(t,e,r,n,s,i){r=r||t?.value;const a=i||{};n=n||O;try{var o=Ut(e);a.flags&&o.setFlags(a.flags);var h=e.statementsMatching(void 0,void 0,void 0,t);switch("namespaces"in e&&o.suggestNamespaces(e.namespaces),a.namespaces&&o.setNamespaces(a.namespaces),o.setBase(r),n){case N:return l(null,o.statementsToXML(h));case v:case b:return l(null,o.statementsToN3(h));case O:case E:return o.setFlags("si"+(a.flags?" "+a.flags:"")),l(null,o.statementsToN3(h));case x:return o.setFlags("deinprstux"),l(null,o.statementsToNTriples(h));case g:return o.setFlags("si dr"+(a.flags?" "+a.flags:"")),l(null,o.statementsToJsonld(h));case T:case y:return o.setFlags("deinprstux q"),l(null,o.statementsToNTriples(h));default:throw new Error("Serialize: Content-type "+n+" not supported for data write.")}}catch(t){if(s)return s(t,void 0);throw t}function l(t,e){return s?void s(t,e):e}}const Ht=["blankNode","defaultGraph","literal","namedNode","quad","variable","supports"],Xt={first:"http://www.w3.org/1999/02/22-rdf-syntax-ns#first",rest:"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest",nil:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"};function Bt(t,e,r){const n=[];return r.reduce((e,r,s,i)=>{let a;return n.push(t.quad(e,t.namedNode(Xt.first),i[s])),s<i.length-1?(a=t.blankNode(),n.push(t.quad(e,t.namedNode(Xt.rest),a))):n.push(t.quad(e,t.namedNode(Xt.rest),t.namedNode(Xt.nil))),a},e),n}function Vt(t,e,r=0){var n=t.length;for(r<0&&(r=n+r);r<n;r++)if(t[r]===e)return r;return-1}class zt extends i{constructor(t=[],e=[],r=[],i=[],a={}){super(""),this.statements=t,this.constraints=e,this.initBindings=r,this.optional=i,n(this,"termType",m),n(this,"classOrder",s.Graph),n(this,"fetcher",void 0),n(this,"isVar",0),n(this,"ns",gt),n(this,"rdfFactory",void 0),this.rdfFactory=a&&a.rdfFactory||mt;for(const t of Ht)this[t]=(...e)=>this.rdfFactory[t](...e)}add(t,e,r,n){return 1===arguments.length&&t.forEach(t=>this.add(t.subject,t.predicate,t.object,t.graph)),this.statements.push(this.rdfFactory.quad(t,e,r,n))}addStatement(t){return this.add(t)}bnode(t){return this.rdfFactory.blankNode(t)}addAll(t){t.forEach(t=>{this.add(t.subject,t.predicate,t.object,t.graph)})}any(t,e,r,n){const s=this.anyStatementMatching(t,e,r,n);return null==s?null:null==t?s.subject:null==e?s.predicate:null==r?s.object:null}anyValue(t,e,r,n){const s=this.any(t,e,r,n);return s?s.value:void 0}anyJS(t,e,r,n){const s=this.any(t,e,r,n);return s?i.toJS(s):void 0}anyStatementMatching(t,e,r,n){let s=this.statementsMatching(t,e,r,n,!0);if(s&&0!==s.length)return s[0]}id(t){return this.rdfFactory.id(t)}statementsMatching(t,e,r,n,s){const i=this.statements.filter(s=>(!t||t.equals(s.subject))&&(!e||e.equals(s.predicate))&&(!r||r.equals(s.object))&&(!n||n.equals(s.graph)));return s?0===i.length?[]:[i[0]]:i}bottomTypeURIs(t){let e,r,n,s,i,a,o,h;e=[];for(let l in t)if(t.hasOwnProperty(l)){for(h=t[l],o=this.each(void 0,this.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#subClassOf"),this.rdfFactory.namedNode(l)),r=!0,s=0,i=o.length;s<i;s++)if(n=o[s],a=n.uri,a in t){r=!1;break}r&&(e[l]=h)}return e}collection(){return new Z}each(t,e,r,n){const s=[];let i=this.statementsMatching(t,e,r,n,!1);if(null==t)for(let t=0,e=i.length;t<e;t++)s.push(i[t].subject);else if(null==e)for(let t=0,e=i.length;t<e;t++)s.push(i[t].predicate);else if(null==r)for(let t=0,e=i.length;t<e;t++)s.push(i[t].object);else if(null==n)for(let t=0,e=i.length;t<e;t++)s.push(new W(i[t].graph.value));return s}equals(t){return!!t&&this.hashString()===t.hashString()}findMembersNT(t){let e,r,n,s,i,a,o,h,l,c,u,d,f,p;d={},d[t.toNT()]=!0,s={},a=this.transitiveClosure(d,this.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!0);for(let t in a)if(a.hasOwnProperty(t)){o=this.statementsMatching(void 0,this.rdfFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),this.fromNT(t));for(let t=0,e=o.length;t<e;t++)f=o[t],s[f.subject.toNT()]=f;h=this.each(void 0,this.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#domain"),this.fromNT(t));for(let t=0,r=h.length;t<r;t++)for(i=h[t],l=this.statementsMatching(void 0,i),n=0,e=l.length;n<e;n++)f=l[n],s[f.subject.toNT()]=f;c=this.each(void 0,this.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#range"),this.fromNT(t));for(let t=0,e=c.length;t<e;t++)for(i=c[t],u=this.statementsMatching(void 0,i),p=0,r=u.length;p<r;p++)f=u[p],s[f.object.toNT()]=f}return s}findMemberURIs(t){return this.NTtoURI(this.findMembersNT(t))}findSubClassesNT(t){let e={};return e[t.toNT()]=!0,this.transitiveClosure(e,this.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!0)}findSuperClassesNT(t){let e={};return e[t.toNT()]=!0,this.transitiveClosure(e,this.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!1)}findTypesNT(t){let e,r,n,s,i,a,o,h,l;n="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",l=[],s=this.statementsMatching(t,void 0,void 0);for(let t=0,e=s.length;t<e;t++)if(h=s[t],"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===h.predicate.uri)l[h.object.toNT()]=h;else{i=this.each(h.predicate,this.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#domain"));for(let t=0,e=i.length;t<e;t++)r=i[t],l[r.toNT()]=h}a=this.statementsMatching(void 0,void 0,t);for(let t=0,r=a.length;t<r;t++){h=a[t],o=this.each(h.predicate,this.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#range"));for(let t=0,r=o.length;t<r;t++)e=o[t],l[e.toNT()]=h}return this.transitiveClosure(l,this.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!1)}findTypeURIs(t){return this.NTtoURI(this.findTypesNT(t))}connectedStatements(t,e,r){r=r||[];let n=[t],s={},i={},a=[],o=this,h=function(t){let h=function(t){"BlankNode"!==t.termType||s[t.value]||(s[t.value]=!0,n.push(t))},l=o.statementsMatching(null,null,t,e).concat(o.statementsMatching(t,null,null,e));l=l.filter(function(t){if(r[t.predicate.value])return!1;let e=t.toNT();return!i[e]&&(i[e]=!0,!0)}),l.forEach(function(t){h(t.subject),h(t.object)}),a=a.concat(l)};for(;n.length;)h(n.shift());return a}formula(t){return new zt}fromNT(t){let e,r,n;switch(t[0]){case"<":return this.sym(t.slice(1,-1));case'"':if(n=void 0,e=void 0,r=t.lastIndexOf('"'),r<t.length-1)if("@"===t[r+1])n=t.slice(r+2);else{if("^^"!==t.slice(r+1,r+3))throw new Error("Can't convert string from NT: "+t);e=this.fromNT(t.slice(r+3))}return t=(t=(t=(t=t.slice(1,r)).replace(/\\"/g,'"')).replace(/\\n/g,"\n")).replace(/\\\\/g,"\\"),this.rdfFactory.literal(t,n||e);case"_":return this.rdfFactory.blankNode(t.slice(2));case"?":return new ut(t.slice(1))}throw new Error("Can't convert from NT: "+t)}holds(t,e,r,n){let s;if(1===arguments.length){if(!t)return!0;if(t instanceof Array){for(s=0;s<t.length;s++)if(!this.holds(t[s]))return!1;return!0}if(j(t))return this.holds(t.subject,t.predicate,t.object,t.graph);if(t.statements)return this.holds(t.statements)}return null!=this.anyStatementMatching(t,e,r,n)}holdsStatement(t){return this.holds(t.subject,t.predicate,t.object,t.graph)}list(t,e){if(e.rdfFactory.supports.COLLECTIONS){const r=e.rdfFactory.collection();return t.forEach(function(t){r.append(t)}),r}{const r=e.rdfFactory.blankNode(),n=Bt(e.rdfFactory,r,t);return e.addAll(n),r}}NTtoURI(t){let e,r,n={};for(e in t)t.hasOwnProperty(e)&&(r=t[e],"<"===e[0]&&(n[e.slice(1,-1)]=r));return n}serialize(t,e,r,n){return qt(r,this,t,e,void 0,n)}substitute(t){let e=this.statements.map(function(e){return e.substitute(t)});const r=new zt;return r.addAll(e),r}sym(t,e){if(e)throw new Error("This feature (kb.sym with 2 args) is removed. Do not assume prefix mappings.");return this.rdfFactory.namedNode(t)}the(t,e,r,n){let s=this.any(t,e,r,n);return null==s&&wt.error("No value found for the() {"+t+" "+e+" "+r+"}."),s}transitiveClosure(t,e,r){let n,s,i,a,o,h,l={};Object.assign(l,t);let c={};for(;;){if(h=function(){for(let t in l)if(l.hasOwnProperty(t))return t}(),null==h)return c;for(o=r?this.each(void 0,e,this.fromNT(h)):this.each(this.fromNT(h),e),s=0,i=o.length;s<i;s++)n=o[s],a=n.toNT(),a in c||a in l||(l[a]=l[h]);c[h]=l[h],delete l[h]}}topTypeURIs(t){let e,r,n,s,i,a,o,h;for(n in o=[],t)if(t.hasOwnProperty(n)){for(h=t[n],i=0,a=this.each(this.rdfFactory.namedNode(n),this.rdfFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#subClassOf")),e=0,s=a.length;e<s;e++)if(r=a[e],"http://www.w3.org/2000/01/rdf-schema#Resource"!==r.uri){i++;break}i||(o[n]=h)}return o["http://www.w3.org/2000/01/rdf-schema#Resource"]&&delete o["http://www.w3.org/2000/01/rdf-schema#Resource"],o["http://www.w3.org/2002/07/owl#Thing"]&&delete o["http://www.w3.org/2002/07/owl#Thing"],o}toString(){return"{"+this.statements.join("\n")+"}"}variable(t){return new ut(t)}whether(t,e,r,n){return this.statementsMatching(t,e,r,n,!1).length}}i.fromValue=Y;const $t=i,Wt={xsd:gt("http://www.w3.org/2001/XMLSchema#")};i.toJS=function(t){return F(t)?t.elements.map(i.toJS):P(t)?t.datatype.equals(Wt.xsd("boolean"))?"1"===t.value||"true"===t.value:t.datatype.equals(Wt.xsd("dateTime"))||t.datatype.equals(Wt.xsd("date"))?new Date(t.value):t.datatype.equals(Wt.xsd("integer"))||t.datatype.equals(Wt.xsd("float"))||t.datatype.equals(Wt.xsd("decimal"))?Number(t.value):t.value:t};class Qt{constructor(t,e){this.pat=new te,this.vars=[],this.name=t,this.id=e}}function Gt(t,e,r,n){function s(t){var e,r="";for(e in t)t.hasOwnProperty(e)&&(r+="    "+e+" -> "+t[e]);return r}function i(t){var e,r="Bindings: ",n=t.length;for(e=0;e<n;e++)r+=s(t[e][0])+";\n\t";return r}function a(t,e,r,n){var s;if(t.length!==e.length)return[];if(!t.length)return[[[],null]];var i=function(t,e,r,n){var s=r[t];if(void 0===s){if(t.isVar){var i=[];return i[t]=e,[[i,null]]}s=t}if(!s.complexType)return n.redirections[s]&&(s=n.redirections[s]),n.redirections[e]&&(e=n.redirections[e]),s.equals(e)||s.uri&&s.uri===K?[[[],null]]:[];if(t instanceof Array)return e instanceof Array?a(t,e,r):[];throw new Error("query.js: oops - code not written yet")}(t[0],e[0],r,n);if(0===i.length)return i;var o,h,l,c,u,d,f,p=[],m=i.length;for(o=0;o<m;o++){for(u in f=[],h=i[o][0])h.hasOwnProperty(u)&&(f[u]=h[u]);for(u in r)r.hasOwnProperty(u)&&(f[u]=r[u]);for(c=(s=a(t.slice(1),e.slice(1),f,n)).length,l=0;l<c;l++){for(u in d=s[l][0],h)h.hasOwnProperty(u)&&(d[u]=h[u]);p.push([d,null])}}return p}function o(t,e){var r=e[t];return void 0===r?t:r}function h(t,e){var r,n={};for(r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);for(r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return n}function l(t,e){return this.trunkBindings=e,this.originalCallback=t,this.branches=[],this}function c(t,e){return this.count=0,this.success=!1,this.done=!1,this.callback=t,this.onDone=e,this}l.prototype.checkAllDone=function(){var t;for(t=0;t<this.branches.length;t++)if(!this.branches[t].done)return;wt.debug("OPTIONAL BIDNINGS ALL DONE:"),this.doCallBacks(this.branches.length-1,this.trunkBindings)},l.prototype.doCallBacks=function(t,e){var r;if(t<0)return this.originalCallback(e);for(r=0;r<this.branches[t].results.length;r++)this.doCallBacks(t-1,h(e,this.branches[t].results[r]))},c.prototype.reportMatch=function(t){this.callback(t),this.success=!0},c.prototype.reportDone=function(){this.done=!0,wt.info("Mandatory query branch finished.***"),void 0!==this.onDone&&this.onDone()};var u=function(t){return this.count=0,this.done=!1,this.results=[],this.junction=t,t.branches.push(this),this};function d(t,e,r){var n,s,i,a;for(e.nvars=0,e.index=null,n=[e.subject,e.predicate,e.object,e.why],a=[t.subjectIndex,t.predicateIndex,t.objectIndex,t.whyIndex],i=0;i<4;i++){let h=n[i];if(h.uri&&h.uri===K);else if(h.isVar&&void 0===r[h])e.nvars++;else{if(h=o(n[i],r),t.redirections[t.id(h)]&&(h=t.redirections[t.id(h)]),!(s=a[i][t.id(h)]))return e.index=[],!1;(null===e.index||e.index.length>s.length)&&(e.index=s)}}return null===e.index&&(e.index=t.statements),!0}function f(t,e){return t.nvars!==e.nvars?t.nvars-e.nvars:t.index.length-e.index.length}u.prototype.reportMatch=function(t){this.results.push(t)},u.prototype.reportDone=function(){wt.debug("Optional branch finished - results.length = "+this.results.length),0===this.results.length&&(this.results.push({}),wt.debug("Optional branch FAILED - that's OK.")),this.done=!0,this.junction.checkAllDone()};var p=function(t,r,n,i,a,o,h){wt.debug("Match begins, Branch count now: "+h.count+" for "+h.pattern_debug);var c,d,f=r.statements;if(0===f.length){if(wt.debug("FOUND MATCH WITH BINDINGS:"+s(n)),0===r.optional.length)h.reportMatch(n);else{wt.debug("OPTIONAL: "+r.optional);var m,g=new l(e,n),v=[];for(m=0;m<r.optional.length;m++)v[m]=new u(g),v[m].pattern_debug=r.optional[m];for(m=0;m<r.optional.length;m++)v[m].count=v[m].count+1,p(t,r.optional[m],n,"",a,e,v[m])}return h.count--,void wt.debug("Match ends -- success , Branch count now: "+h.count+" for "+h.pattern_debug)}var b=f.length;if(a){var y=function(e,s){var l=e.uri.split("#")[0];a.nowOrWhenFetched(l,void 0,function(s,l,c){s||console.log("Error following link to <"+e.uri+"> in query: "+l),p(t,r,n,i,a,o,h)})};for(d=0;d<b;d++){if(c=f[d],void 0!==n[c.subject]&&n[c.subject].uri&&a&&"unrequested"===a.getState(it(n[c.subject].uri)))return void y(n[c.subject]);if(void 0!==n[c.object]&&n[c.object].uri&&a&&"unrequested"===a.getState(it(n[c.object].uri)))return void y(n[c.object])}}w(t,r,n,i,a,o,h)},m=function(t,e){var r,n,s=!0;for(r in t)t.hasOwnProperty(r)&&e[r]&&(n=e[r].test)&&!n(t[r])&&(s=!1);return s},w=function(t,e,r,n,o,h,l){var c,u,w,g,v,b,y,T=e.statements,x=T.length;for(c=0;c<x;c++)d(t,y=T[c],r);T.sort(f),y=T[0];var N,A=t.formula();A.optional=e.optional,A.constraints=e.constraints,A.statements=T.slice(1),wt.debug(n+"match2 searching "+y.index.length+" for "+y+"; bindings so far="+s(r));var C,O,E=y.index.length,R=0;for(N=0;N<E;N++)for(O=y.index[N],C=a([y.subject,y.predicate,y.object,y.why],[O.subject,O.predicate,O.object,O.why],r,t),wt.info(n+" From first: "+C.length+": "+i(C)),w=C.length,u=0;u<w;u++)if(v=[],b=C[u][0],m(b,e.constraints)){for(g in b)b.hasOwnProperty(g)&&(v[g]=b[g]);for(g in r)r.hasOwnProperty(g)&&(v[g]=r[g]);l.count++,R++,p(t,A,v,n+"  ",o,h,l)}else wt.debug("Branch count CS: "+l.count);l.count--,0===R&&wt.debug("Match2 fails completely on "+y),wt.debug("Match2 ends, Branch count: "+l.count+" for "+l.pattern_debug),0===l.count&&(wt.debug("Branch finished."),l.reportDone())},g=this;wt.debug("Query on "+this.statements.length);var v=new c(e,n);v.count++,t.sync?p(g,t.pat,t.pat.initBindings,"",r,e,v):setTimeout(function(){p(g,t.pat,t.pat.initBindings,"",r,e,v)},0)}const Yt="http://www.w3.org/2002/07/owl#";function Zt(t,e,r,n){var s=t.any(e,r,void 0);return!!s&&(t.equate(s,n),!0)}function Jt(t,e,r,n){var s=t.any(void 0,r,n);return!!s&&(t.equate(s,e),!0)}function Kt(t,e,r,n,s){t.typeCallback&&t.typeCallback(t,n,s);var i=t.classActions[t.id(n)],a=!1;if(i)for(var o=0;o<i.length;o++)a=a||i[o](t,e,r,n,s);return a}class te extends zt{constructor(t,e={}){super(void 0,void 0,void 0,void 0,e),n(this,"updater",void 0),n(this,"namespaces",void 0),n(this,"classActions",void 0),n(this,"propertyActions",void 0),n(this,"redirections",void 0),n(this,"aliases",void 0),n(this,"HTTPRedirects",void 0),n(this,"subjectIndex",void 0),n(this,"predicateIndex",void 0),n(this,"objectIndex",void 0),n(this,"whyIndex",void 0),n(this,"index",void 0),n(this,"features",void 0),n(this,"_universalVariables",void 0),n(this,"_existentialVariables",void 0),n(this,"rdfArrayRemove",void 0),n(this,"dataCallbacks",[]),n(this,"dataRemovalCallbacks",[]),this.propertyActions={},this.classActions={},this.redirections=[],this.aliases=[],this.HTTPRedirects=[],this.subjectIndex=[],this.predicateIndex=[],this.objectIndex=[],this.whyIndex=[],this.index=[this.subjectIndex,this.predicateIndex,this.objectIndex,this.whyIndex],this.namespaces={},this.features=t||[],this.rdfArrayRemove=e.rdfArrayRemove||Ft,e.dataCallback&&(this.dataCallbacks=[e.dataCallback]),e.dataRemovalCallback&&(this.dataRemovalCallbacks=[e.dataRemovalCallback]),this.initPropertyActions(this.features)}static get defaultGraphURI(){return K}substitute(t){var e=this.statements.map(function(e){return e.substitute(t)}),r=new te;return r.add(e),r}addDataCallback(t){this.dataCallbacks.push(t)}addDataRemovalCallback(t){this.dataRemovalCallbacks.push(t)}applyPatch(t,e,r){var n,s=this,i=null;function a(a){if(t.delete){n=t.delete,i&&(n=n.substitute(i)),n=n.statements;var o=[],h=n.map(function(t){var r=s.statementsMatching(t.subject,t.predicate,t.object,e);return 0===r.length?(o.push(t),null):r[0]});if(o.length)return r("Could not find to delete: "+o.join("\n or "));h.map(function(t){s.remove(t)})}t.insert&&(n=t.insert,i&&(n=n.substitute(i)),(n=n.statements).map(function(t){t.graph=e,s.add(t.subject,t.predicate,t.object,t.graph)})),a()}if(t.where){var o=new Qt("patch");o.pat=t.where,o.pat.statements.map(function(t){t.graph=new W(e.value)}),o.sync=!0;var h=[];s.query(o,function(t){h.push(t)},s.fetcher,function(){return 0===h.length?r("No match found to be patched:"+t.where):h.length>1?r("Patch ambiguous. No patch done."):(i=h[0],void a(r))})}else a(r)}declareExistential(t){return this._existentialVariables||(this._existentialVariables=[]),this._existentialVariables.push(t),t}initPropertyActions(t){this.propertyActions[this.rdfFactory.id(this.rdfFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"))]=[Kt],Vt(t,"sameAs")>=0&&(this.propertyActions[this.rdfFactory.id(this.rdfFactory.namedNode(`${Yt}sameAs`))]=[function(t,e,r,n,s){return t.equate(e,n),!0}]),Vt(t,"InverseFunctionalProperty")>=0&&(this.classActions[this.rdfFactory.id(this.rdfFactory.namedNode(`${Yt}InverseFunctionalProperty`))]=[function(t,e,r,n,s){return t.newPropertyAction(e,Jt)}]),Vt(t,"FunctionalProperty")>=0&&(this.classActions[this.rdfFactory.id(this.rdfFactory.namedNode(`${Yt}FunctionalProperty`))]=[function(t,e,r,n,s){return t.newPropertyAction(e,Zt)}])}addStatement(t){return this.add(t.subject,t.predicate,t.object,t.graph),this.statements.length}add(t,e,r,n){var s,i,a;if(1===arguments.length){if(t instanceof Array)for(s=0;s<t.length;s++)this.add(t[s]);else q(t)?this.add(t.subject,t.predicate,t.object,t.graph):I(t)&&this.add(t.statements);return this}n||(n=this.fetcher?this.fetcher.appNode:this.rdfFactory.defaultGraph()),"string"==typeof t&&(t=this.rdfFactory.namedNode(t)),e=$t.fromValue(e);const o=$t.fromValue(r);if(n=$t.fromValue(n),!M(t))throw new Error("Subject is not a subject type");if(!L(e))throw new Error(`Predicate ${e} is not a predicate type`);if(!D(o))throw new Error(`Object ${o} is not an object type`);if(!$(n))throw new Error("Why is not a graph type");this.predicateCallback&&this.predicateCallback(this,e,n);var h=this.id(this.canon(e)),l=!1;if(i=this.propertyActions[h])for(s=0;s<i.length;s++)l=l||i[s](this,t,e,o,n);if(this.holds(t,e,o,n))return null;var c=[this.id(this.canon(t)),h,this.id(this.canon(o)),this.id(this.canon(n))];for(a=this.rdfFactory.quad(t,e,o,n),s=0;s<4;s++){var u=this.index[s],d=c[s];u[d]||(u[d]=[]),u[d].push(a)}this.statements.push(a);for(const t of this.dataCallbacks)t(a);return a}canon(t){if(!t)return t;const e=this.redirections[this.id(t)];if(e)return e;switch(t.termType){case l:return new S(t.value);case f:return t;case d:return new tt;case p:case m:return t;case c:return new G(t.value,t.language,t.datatype);case a:return new W(t.value);case u:return new ut(t.value);default:throw new Error(`Term Type not recognized for canonization: ${t.termType}`)}}check(){this.checkStatementList(this.statements);for(var t=0;t<4;t++){var e=this.index[t];for(var r in e)e.hasOwnProperty(r)&&this.checkStatementList(e[r],t)}}checkStatementList(t,e){void 0===e&&(e=0);for(var r,n=" found in "+["subject","predicate","object","why"][e]+" index.",s=0;s<t.length;s++){for(var i=[(r=t[s]).subject,r.predicate,r.object,r.graph],a=function(t,e){for(var r=0;r<t.length;r++)if(t[r].subject.equals(e.subject)&&t[r].predicate.equals(e.predicate)&&t[r].object.equals(e.object)&&t[r].why.equals(e.graph))return!0},o=0;o<4;o++){var h=this.canon(i[o]),l=this.id(h);this.index[o][l]&&a(this.index[o][l],r)}if(!a(this.statements,r))throw new Error("Statement list does not statement "+r+"@"+r.graph+n)}}close(){return this}compareTerms(t,e){return Object.prototype.hasOwnProperty.call(t,"compareTerm")?t.compareTerm(e):s[t.termType]<s[e.termType]?-1:s[t.termType]>s[e.termType]?1:t.value<e.value?-1:t.value>e.value?1:0}copyTo(t,e,r){r||(r=[]);var n=this.statementsMatching(t);-1!==Vt(r,"two-direction")&&n.concat(this.statementsMatching(void 0,void 0,t));for(var s=0;s<n.length;s++){var i=n[s];switch(i.object.termType){case"NamedNode":this.add(e,i.predicate,i.object);break;case"Literal":case"BlankNode":case"Collection":this.add(e,i.predicate,i.object.copy(this))}-1!==Vt(r,"delete")&&this.remove(i)}}equate(t,e){const r=this.canon(t),n=this.canon(e);var s=this.compareTerms(r,n);return!s||(s<0?this.replaceWith(n,r):this.replaceWith(r,n))}formula(t){return new te(t)}get length(){return this.statements.length}match(t,e,r,n){return this.statementsMatching($t.fromValue(t),$t.fromValue(e),$t.fromValue(r),$t.fromValue(n))}mentionsURI(t){var e="<"+t+">";return!!this.subjectIndex[e]||!!this.objectIndex[e]||!!this.predicateIndex[e]}newExistential(t){if(!t)return this.bnode();var e=this.sym(t);return this.declareExistential(e)}newPropertyAction(t,e){var r=this.id(t);this.propertyActions[r]||(this.propertyActions[r]=[]),this.propertyActions[r].push(e);for(var n=this.statementsMatching(void 0,t,void 0),s=!1,i=0;i<n.length;i++)s=s||e(this,n[i].subject,t,n[i].object);return s}newUniversal(t){var e=this.sym(t);return this._universalVariables||(this._universalVariables=[]),this._universalVariables.push(e),e}variable(t){return new ut(t)}nextSymbol(t){for(var e=0;;e++){var r=t.value+"#n"+e;if(!this.mentionsURI(r))return this.sym(r)}}query(t,e,r,n){return Gt.call(this,t,e,r,n)}querySync(t){var e=[],r=!1;if(t.sync=!0,Gt.call(this,t,function(t){e.push(t)},null,function(){r=!0}),!r)throw new Error("Sync query should have called done function");return e}remove(t){if(t instanceof Array){for(var e=0;e<t.length;e++)this.remove(t[e]);return this}if(I(t))return this.remove(t.statements);var r=this.statementsMatching(t.subject,t.predicate,t.object,t.graph);if(!r.length)throw new Error("Statement to be removed is not on store: "+t);return this.removeStatement(r[0]),this}removeDocument(t){this.removeMetadata(t);for(var e=this.statementsMatching(void 0,void 0,void 0,t).slice(),r=0;r<e.length;r++)this.removeStatement(e[r]);return this.removeMatches(t,null,null),this}removeMetadata(t){const e=this.sym("chrome://TheCurrentSession"),r="http://www.w3.org/2007/ont/link#",n=this.statementsMatching(void 0,this.sym(`${r}requestedURI`),this.rdfFactory.literal(t.value),e).map(t=>t.subject);for(var s=0;s<n.length;s++){const t=n[s];if(null!=t){let n;const s=this.any(t,this.sym(`${r}status`),null,e);if(null!=s){n=this.statementsMatching(s,this.sym(`${r}status`),null,e).slice();for(var i=0;i<n.length;i++)this.removeStatement(n[i])}const a=this.any(t,this.sym(`${r}response`),null,e);if(null!=a)for(n=this.statementsMatching(a,null,null,e).slice(),i=0;i<n.length;i++)this.removeStatement(n[i]);for(n=this.statementsMatching(t,null,null,e).slice(),i=0;i<n.length;i++)this.removeStatement(n[i])}}return this.removeMatches(this.sym(t.value),null,null,e),this}removeMany(t,e,r,n,s){for(var i=this.statementsMatching(t,e,r,n,!1),a=[],o=0;o<i.length;o++)a.push(i[o]);for(s&&(a=a.slice(0,s)),o=0;o<a.length;o++)this.remove(a[o])}removeMatches(t,e,r,n){return this.removeMany(t,e,r,n),this}removeStatement(t){for(var e=[t.subject,t.predicate,t.object,t.graph],r=0;r<4;r++){var n=this.canon(e[r]),s=this.id(n);this.index[r][s]&&this.rdfArrayRemove(this.index[r][s],t)}this.rdfArrayRemove(this.statements,t);for(const e of this.dataRemovalCallbacks)e(t);return this}removeStatements(t){for(var e=0;e<t.length;e++)this.remove(t[e]);return this}replaceWith(t,e){for(var r=this.id(t),n=this.id(e),s=function(t){var e=t[r];if(e){var s=t[n];t[n]=s?e.concat(s):e,delete t[r]}},i=0;i<4;i++)s(this.index[i]);if(this.redirections[r]=e,t.value){if(this.aliases[n]||(this.aliases[n]=[]),this.aliases[n].push(t),this.aliases[r])for(i=0;i<this.aliases[r].length;i++)this.redirections[this.id(this.aliases[r][i])]=e,this.aliases[n].push(this.aliases[r][i]);this.add(e,this.sym("http://www.w3.org/2007/ont/link#uri"),t),this.fetcher&&this.fetcher.nowKnownAs(t,e)}return s(this.classActions),s(this.propertyActions),!0}allAliases(t){var e=this.aliases[this.id(this.canon(t))]||[];return e.push(this.canon(t)),e}sameThings(t,e){if(t.equals(e))return!0;var r=this.canon(t);if(!r)return!1;var n=this.canon(e);return!!n&&r.value===n.value}setPrefixForURI(t,e){if(("tab"!==t||!this.namespaces.tab)&&"ns"!==t.slice(0,2)&&"default"!==t.slice(0,7)){for(let t in this.namespaces)this.namespaces[t]==e&&delete this.namespaces[t];this.namespaces[t]=e}}statementsMatching(t,e,r,n,s){var i,a,o=[t,e,r,n],h=[],l=[],c=[],u=[];for(i=0;i<4;i++)h[i]=this.canon($t.fromValue(o[i])),h[i]?(u.push(i),l[i]=this.id(h[i])):c.push(i);if(0===u.length)return this.statements;if(1===u.length)return i=u[0],(a=this.index[i][l[i]])&&s&&a.length>1&&(a=a.slice(0,1)),a||[];var d,f,p=1e10;for(f=0;f<u.length;f++){if(i=u[f],!(a=this.index[i][l[i]]))return[];a.length<p&&(p=a.length,d=f)}for(var m=u[d],w=this.index[m][l[m]],g=u.slice(0,d).concat(u.slice(d+1)),v=[],b=["subject","predicate","object","why"],y=0;y<w.length;y++){var T=w[y];for(f=0;f<g.length;f++)if(i=g[f],!this.canon(T[b[i]]).equals(h[i])){T=null;break}if(null!=T&&(v.push(T),s))break}return v}uris(t){var e=this.canon(t),r=this.aliases[this.id(e)];if(!e.value)return[];var n=[e.value];if(r)for(var s=0;s<r.length;s++)n.push(r[s].uri);return n}serialize(t,e,r,n){return qt(r,this,t,e,void 0,n={...n||{},namespaces:n?.namespaces?{...this.namespaces,...n.namespaces}:{...this.namespaces}})}}n(te,"handleRDFType",void 0),te.handleRDFType=Kt;const ee=gt("http://www.w3.org/1999/02/22-rdf-syntax-ns#");function re(t,e){function r(n,s,i){const a=t.statementsMatching(n,ee("rest"),null,e);if(1!==a.length)throw new Error(`Bad list structure: no rest at ${n}`);const o=t.statementsMatching(n,ee("first"),null,e);if(1!==o.length)throw new Error(`Bad list structure: rest but ${o.length} firsts at ${n}`);const h=[o[0].object].concat(s),l=i.concat(a).concat(o),c=t.statementsMatching(null,ee("rest"),n,e);if(0===c.length){const r=new Z(h);return t.remove(l),void function(t,e,r,n){for(const s of t.statementsMatching(r,null,null,n)){const r=new nt(e,s.predicate,s.object,n);t.remove(s),t.add(r)}for(const s of t.statementsMatching(null,r,null,n))t.remove(s),t.add(new nt(s.subject,e,s.object,n));for(const s of t.statementsMatching(null,null,r,n))t.remove(s),t.add(new nt(s.subject,s.predicate,e,n))}(t,r,n,e)}if(1!==c.length)throw new Error(`Bad list structure: ${c.length} pres at ${n}`);const u=c[0].subject;if("BlankNode"!==u.termType)throw new Error(`Bad list element node ${u} type: ${u.termType} `);r(u,h,l)}!function(t,e){const r=ee("nil");for(const n of t.statementsMatching(r,null,null,e)){t.remove(n);const r=new Z;t.add(new nt(r,n.predicate,n.object,e))}for(const n of t.statementsMatching(null,null,r,e))if(!n.predicate.sameTerm(ee("rest"))){t.remove(n);const r=new Z;t.add(new nt(n.subject,n.predicate,r,e))}}(t,e),t.statementsMatching(null,ee("rest"),ee("nil"),e).forEach(t=>{if("BlankNode"!==t.subject.termType)throw new Error(`Bad list element node ${t.subject} type: ${t.subject.termType} `);r(t.subject,[],[])})}var ne="http://www.w3.org/2000/10/swap/log#",se=function(t){return t},ie=function(t){return t},ae=function(t){if(t.length>0)throw"missing.js: oops nnonempty dict not imp";return[]},oe=function(t){return t.length},he=function(t,e,r){if(void 0===t.slice)throw"@@ mising.js: No .slice function for "+t+" of type "+typeof t;return void 0===r||null==r?t.slice(e):t.slice(e,r)},le=Error("dummy error stop iteration"),ce=function(t){return this.last=0,this.li=t,this.next=function(){if(this.last==this.li.length)throw le;return this.li[this.last++]},this},ue=function(t,e){return t.indexOf(e)},de=function(t,e){if(!t){if(e)throw"python Assertion failed: "+e;throw"(python) Assertion failed."}};String.prototype.encode=function(t){if("utf-8"!=t)throw"UTF8_converter: can only do utf-8";return function(t){t=t.replace(/\r\n/g,"\n");for(var e="",r=0;r<t.length;r++){var n=t.charCodeAt(r);n<128?e+=String.fromCharCode(n):n>127&&n<2048?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e}(this)},String.prototype.decode=function(t){if("utf-8"!=t)throw"UTF8_converter: can only do utf-8";return this};var fe=function(t,e){return ht(e,t)},pe="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil",me="http://www.w3.org/2002/07/owl#sameAs",we="\t\r\n !\"#$%&'()*.,+/;<=>?@[\\]^`{|}~",ge=we+":",ve=new RegExp("^([-+]?[0-9]+)(\\.[0-9]+)?([eE][-+]?[0-9]+)?","g"),be=new RegExp("^[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9](T[0-9][0-9]:[0-9][0-9](:[0-9][0-9](\\.[0-9]*)?)?)?Z?"),ye=new RegExp("[\\s#]"),Te=new RegExp('[\\\\\\r\\n\\"]',"g"),xe=new RegExp("^[a-zA-Z0-9]+(-[a-zA-Z0-9]+)*","g");function Ne(t,e){var r=t.charAt(e+1);return""===r||ye.test(r)}const Ae=function(t,e,r,n,s,i,a,o){return new Ce(t,e,r,n,s,i,a,o)};class Ce{constructor(t,e,r,n,s,i,a,o){void 0===e&&(e=null),void 0===r&&(r=""),void 0===n&&(n=null),void 0===s&&(s=""),void 0===i&&(i=null),void 0===a&&(a=""),void 0===o&&(o=null),this._bindings=new ae([]),this._flags=a,""!=r&&(de(r.indexOf(":")>=0,"Document URI not absolute: "+r),this._bindings[""]=r+"#"),this._store=t,s&&t.setGenPrefix(s),this._thisDoc=r,this.source=t.sym(r),this.lines=0,this.statementCount=0,this.hasNil=!1,this.startOfLine=0,this.previousLine=0,this._genPrefix=s,this.keywords=new ie(["a","this","bind","has","is","of","true","false"]),this.keywordsSet=0,this._anonymousNodes=new ae([]),this._variables=new ae([]),this._parentVariables=new ae([]),this._reason=o,this._reason2=null,this._baseURI=n||r||null,de(!this._baseURI||this._baseURI.indexOf(":")>=0),this._genPrefix||(this._thisDoc?this._genPrefix=this._thisDoc+"#_g":this._genPrefix=RDFSink_uniqueURI()),null==e?this._thisDoc?this._formula=t.formula(r+"#_formula"):this._formula=t.formula():this._formula=e,this._context=this._formula,this._parentContext=null}here(t){return this._genPrefix+"_L"+this.lines+"C"+(t-this.startOfLine+1)}formula(){return this._formula}loadStream(t){return this.loadBuf(t.read())}loadBuf(t){return this.startDoc(),this.feed(t),this.endDoc()}feed(t){for(var e=t.decode("utf-8"),r=0;r>=0;){var n=this.skipSpace(e,r);if(n<0)return;if((r=this.directiveOrStatement(e,n))<0)throw Oe(this._thisDoc,this.lines,e,n,"expected directive or statement")}}directiveOrStatement(t,e){var r,n=this.skipSpace(t,e);return n<0?n:(r=this.directive(t,n))>=0||(r=this.statement(t,n))>=0?this.checkDot(t,r):r}tok(t,e,r){if("@"==e.slice(r,r+1))r+=1;else if(Vt(this.keywords,t)<0)return-1;var n=r+oe(t);return e.slice(r,n)==t&&we.indexOf(e.charAt(n))>=0?n:-1}directive(t,e){if((i=this.skipSpace(t,e))<0)return i;var r=new ie([]);if((i=this.tok("bind",t,e))>0)throw Oe(this._thisDoc,this.lines,t,e,"keyword bind is obsolete: use @prefix");if((i=this.tok("keywords",t,e))>0){if((e=this.commaSeparatedList(t,i,r,!1))<0)throw Oe(this._thisDoc,this.lines,t,e,"'@keywords' needs comma separated list of words");return this.setKeywords(he(r,null,null)),e}if((i=this.tok("forAll",t,e))>0){if((e=this.commaSeparatedList(t,i,r,!0))<0)throw Oe(this._thisDoc,this.lines,t,e,"Bad variable list after @forAll");var n=new ce(r);try{for(;;){var s=n.next();(Vt(this._variables,s)<0||Vt(this._parentVariables,s)>=0)&&(this._variables[s]=this._context.newUniversal(s))}}catch(t){if(t!=le)throw t}return e}if((i=this.tok("forSome",t,e))>0){if((e=this.commaSeparatedList(t,i,r,this.uri_ref2))<0)throw Oe(this._thisDoc,this.lines,t,e,"Bad variable list after @forSome");n=new ce(r);try{for(;;)s=n.next(),this._context.declareExistential(s)}catch(t){if(t!=le)throw t}return e}if((i=this.tok("prefix",t,e))>=0){var i,a=new ie([]);if((e=this.qname(t,i,a))<0)throw Oe(this._thisDoc,this.lines,t,i,"expected qname after @prefix");if((i=this.uri_ref2(t,e,a))<0)throw Oe(this._thisDoc,this.lines,t,e,"expected <uriref> after @prefix _qname_");var o=a[1].uri;return this._baseURI?o=fe(this._baseURI,o):de(o.indexOf(":")>=0,"With no base URI, cannot handle relative URI for NS"),de(o.indexOf(":")>=0),this._bindings[a[0][0]]=o,this.bind(a[0][0],function(t){return encodeURI(t)}(o)),i}if((i=this.tok("base",t,e))>=0){if(a=new ie([]),(e=this.uri_ref2(t,i,a))<0)throw Oe(this._thisDoc,this.lines,t,i,"expected <uri> after @base ");if(o=a[0].uri,!this._baseURI)throw Oe(this._thisDoc,this.lines,t,i,"With no previous base URI, cannot use relative URI in @base  <"+o+">");return o=fe(this._baseURI,o),de(o.indexOf(":")>=0),this._baseURI=o,e}return-1}bind(t,e){""==t||this._store.setPrefixForURI(t,e)}setKeywords(t){null==t?this.keywordsSet=0:(this.keywords=t,this.keywordsSet=1)}startDoc(){}endDoc(){return this.hasNil&&this._store.rdfFactory.supports.COLLECTIONS&&re(this._store,this.source),this._formula}makeStatement(t){t[0].add(t[2],t[1],t[3],this.source),(t[2].uri&&t[2].uri===pe||t[3].uri&&t[3].uri===pe)&&(this.hasNil=!0),this.statementCount+=1}statement(t,e){var r=new ie([]);if((e=this.object(t,e,r))<0)return e;var n=this.property_list(t,e,r[0]);if(n<0)throw Oe(this._thisDoc,this.lines,t,e,"expected propertylist");return n}subject(t,e,r){return this.item(t,e,r)}verb(t,e,r){if((s=this.skipSpace(t,e))<0)return s;var n=new ie([]);if((s=this.tok("has",t,e))>=0){if((e=this.prop(t,s,n))<0)throw Oe(this._thisDoc,this.lines,t,s,"expected property after 'has'");return r.push(new se(["->",n[0]])),e}if((s=this.tok("is",t,e))>=0){if((e=this.prop(t,s,n))<0)throw Oe(this._thisDoc,this.lines,t,s,"expected <property> after 'is'");if((s=this.skipSpace(t,e))<0)throw Oe(this._thisDoc,this.lines,t,e,"End of file found, expected property after 'is'");var s;if(e=s,(s=this.tok("of",t,e))<0)throw Oe(this._thisDoc,this.lines,t,e,"expected 'of' after 'is' <prop>");return r.push(new se(["<-",n[0]])),s}if((s=this.tok("a",t,e))>=0)return r.push(new se(["->",this._store.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type")])),s;if("<="==t.slice(e,e+2))return r.push(new se(["<-",this._store.sym(ne+"implies")])),e+2;if("="==t.slice(e,e+1))return">"==t.slice(e+1,e+2)?(r.push(new se(["->",this._store.sym(ne+"implies")])),e+2):(r.push(new se(["->",this._store.sym(me)])),e+1);if(":="==t.slice(e,e+2))return r.push(new se(["->",ne+"becomes"])),e+2;if((s=this.prop(t,e,n))>=0)return r.push(new se(["->",n[0]])),s;if(">-"==t.slice(e,e+2)||"<-"==t.slice(e,e+2))throw Oe(this._thisDoc,this.lines,t,s,">- ... -> syntax is obsolete.");return-1}prop(t,e,r){return this.item(t,e,r)}item(t,e,r){return this.path(t,e,r)}blankNode(t){return this._context.bnode(t,this._reason2)}path(t,e,r){if((s=this.nodeOrLiteral(t,e,r))<0)return s;for(;"!^.".indexOf(t.slice(s,s+1))>=0;){var n=t.slice(s,s+1);if("."==n&&Ne(t,s))break;var s,i=r.pop(),a=this.blankNode(this.here(s));if((s=this.node(t,s+1,r))<0)throw Oe(this._thisDoc,this.lines,t,s,"EOF found in middle of path syntax");var o=r.pop();"^"==n?this.makeStatement(new se([this._context,o,a,i])):this.makeStatement(new se([this._context,o,i,a])),r.push(a)}return s}anonymousNode(t){if(e=this._anonymousNodes[t])return e;var e=this._store.bnode(t);return this._anonymousNodes[t]=e,e}node(t,e,r,n){void 0===n&&(n=null);var s=n;if((c=this.skipSpace(t,e))<0)return c;e=c;var i=t.slice(e,e+1);if("["==i){var a=this.here(e);if((c=this.skipSpace(t,e+1))<0)throw Oe(this._thisDoc,this.lines,t,e,"EOF after '['");if("="==t.slice(c,c+1)){e=c+1;var o=new ie([]);if(!((c=this.objectList(t,e,o))>=0))throw Oe(this._thisDoc,this.lines,t,e,"objectList expected after [= ");if(s=o[0],oe(o)>1){var h=new ce(o);try{for(;;){var l=h.next();this.makeStatement(new se([this._context,this._store.sym(me),s,l]))}}catch(t){if(t!=le)throw t}}if((c=this.skipSpace(t,c))<0)throw Oe(this._thisDoc,this.lines,t,e,"EOF when objectList expected after [ = ");if(";"==t.slice(c,c+1))var c=c+1}if(null==s&&(s=this.blankNode(a)),(e=this.property_list(t,c,s))<0)throw Oe(this._thisDoc,this.lines,t,c,"property_list expected");if((c=this.skipSpace(t,e))<0)throw Oe(this._thisDoc,this.lines,t,e,"EOF when ']' expected after [ <propertyList>");if("."==t.slice(c,c+1))return r.push(s),c;if("]"!=t.slice(c,c+1))throw Oe(this._thisDoc,this.lines,t,c,"']' expected");return r.push(s),c+1}if("{"==i){if("$"==t.slice(e+1,e+2)){c=(e+=1)+1;for(var u=new ie([]),d=!0;;){if((e=this.skipSpace(t,c))<0)throw Oe(this._thisDoc,this.lines,t,e,"needed '$}', found end.");if("$}"==t.slice(e,e+2)){c=e+2;break}if(d)d=!1;else{if(","!=t.slice(e,e+1))throw Oe(this._thisDoc,this.lines,t,e,"expected: ','");e+=1}var f=new ie([]);if((c=this.item(t,e,f))<0)throw Oe(this._thisDoc,this.lines,t,e,"expected item in set or '$}'");u.push(f[0])}return r.push(this._store.newSet(u,this._context)),c}c=e+1;var p=this._parentContext;this._parentContext=this._context;var m=this._anonymousNodes,w=this._parentVariables;this._parentVariables=this._variables,this._anonymousNodes=new ae([]),this._variables=this._variables.slice();var g=this._reason2;for(this._reason2=null,null==s&&(s=this._store.formula()),this._context=s;;){if((e=this.skipSpace(t,c))<0)throw Oe(this._thisDoc,this.lines,t,e,"needed '}', found end.");if("}"==t.slice(e,e+1)){c=e+1;break}if((c=this.directiveOrStatement(t,e))<0)throw Oe(this._thisDoc,this.lines,t,e,"expected statement or '}'")}return this._anonymousNodes=m,this._variables=this._parentVariables,this._parentVariables=w,this._context=this._parentContext,this._reason2=g,this._parentContext=p,r.push(s.close()),c}if("("==i){var v=this._store.list;for("$"==t.slice(e+1,e+2)&&(v=this._store.newSet,e+=1),c=e+1,u=new ie([]);;){if((e=this.skipSpace(t,c))<0)throw Oe(this._thisDoc,this.lines,t,e,"needed ')', found end.");if(")"==t.slice(e,e+1)){c=e+1;break}if(f=new ie([]),(c=this.item(t,e,f))<0)throw Oe(this._thisDoc,this.lines,t,e,"expected item in list or ')'");u.push(f[0])}return r.push(v(u,this._context)),c}if((c=this.tok("this",t,e))>=0)throw Oe(this._thisDoc,this.lines,t,e,"Keyword 'this' was ancient N3. Now use @forSome and @forAll keywords.");return(c=this.tok("true",t,e))>=0?(r.push(!0),c):(c=this.tok("false",t,e))>=0?(r.push(!1),c):null==s&&(c=this.uri_ref2(t,e,r))>=0?c:-1}property_list(t,e,r){for(;;){if((c=this.skipSpace(t,e))<0)throw Oe(this._thisDoc,this.lines,t,e,"EOF found when expected verb in property list");if(":-"!=t.slice(c,c+2)){e=c;var n=new ie([]);if((c=this.verb(t,e,n))<=0)return e;var s=new ie([]);if((e=this.objectList(t,c,s))<0)throw Oe(this._thisDoc,this.lines,t,c,"objectList expected");var i=new ce(s);try{for(;;){var a=i.next(),o=n[0],h=o[0],l=o[1];"->"==h?this.makeStatement(new se([this._context,l,r,a])):this.makeStatement(new se([this._context,l,a,r]))}}catch(t){if(t!=le)throw t}if((c=this.skipSpace(t,e))<0)throw Oe(this._thisDoc,this.lines,t,c,"EOF found in list of objects");if(";"!=t.slice(e,e+1))return e;e+=1}else{e=c+2;var c,u=new ie([]);if((c=this.node(t,e,u,r))<0)throw Oe(this._thisDoc,this.lines,t,e,"bad {} or () or [] node after :- ");e=c}}}commaSeparatedList(t,e,r,n){if((s=this.skipSpace(t,e))<0)throw Oe(this._thisDoc,this.lines,t,s,"EOF found expecting comma sep list");if("."==t.charAt(s))return e;if(n)var s=this.uri_ref2(t,s,r);else s=this.bareWord(t,s,r);if(s<0)return-1;for(;;){if((e=this.skipSpace(t,s))<0)return e;var i=t.slice(e,e+1);if(","!=i)return"."!=i?-1:e;if((s=n?this.uri_ref2(t,e+1,r):this.bareWord(t,e+1,r))<0)throw Oe(this._thisDoc,this.lines,t,s,"bad list content")}}objectList(t,e,r){if((e=this.object(t,e,r))<0)return-1;for(;;){var n=this.skipSpace(t,e);if(n<0)throw Oe(this._thisDoc,this.lines,t,n,"EOF found after object");if(","!=t.slice(n,n+1))return n;if((e=this.object(t,n+1,r))<0)return e}}checkDot(t,e){var r=this.skipSpace(t,e);if(r<0)return r;if("."==t.slice(r,r+1))return r+1;if("}"==t.slice(r,r+1))return r;if("]"==t.slice(r,r+1))return r;throw Oe(this._thisDoc,this.lines,t,r,"expected '.' or '}' or ']' at end of statement")}uri_ref2(t,e,r){var n=new ie([]);if((d=this.qname(t,e,n))>=0){var s=n[0],i=s[0],a=s[1];if(null==i){de(0,"not used?");var o=this._baseURI+"#"}else if(!(o=this._bindings[i])){if("_"==i)return r.push(this.anonymousNode(a)),d;throw Oe(this._thisDoc,this.lines,t,e,"Prefix "+i+" not bound.")}var h=this._store.sym(o+a);return Vt(this._variables,h)>=0?r.push(this._variables[h]):r.push(h),d}if((e=this.skipSpace(t,e))<0)return-1;if("?"==t.charAt(e)){var l=new ie([]);return(d=this.variable(t,e,l))>0?(r.push(l[0]),d):-1}if("<"==t.charAt(e)){for(var c=e+=1;e<oe(t);){if(">"==t.charAt(e)){var u=t.slice(c,e);return this._baseURI?u=fe(this._baseURI,u):de(u.indexOf(":")>=0,"With no base URI, cannot deal with relative URIs"),"#"==t.slice(e-1,e)&&"#"!=he(u,-1,null)&&(u+="#"),h=this._store.sym(u),Vt(this._variables,h)>=0?r.push(this._variables[h]):r.push(h),e+1}e+=1}throw Oe(this._thisDoc,this.lines,t,d,"unterminated URI reference")}if(this.keywordsSet){var d;if(l=new ie([]),(d=this.bareWord(t,e,l))<0)return-1;if(Vt(this.keywords,l[0])>=0)throw Oe(this._thisDoc,this.lines,t,e,'Keyword "'+l[0]+'" not allowed here.');return r.push(this._store.sym(this._bindings[""]+l[0])),d}return-1}skipSpace(t,e){for(var r=e||0;r<t.length;r++){var n=t.charAt(r);if(" \n\r\t\f\v            ​\u2028\u2029　".indexOf(n)<0){if("#"!==t.charAt(r))return r;for(;;r++){if(r===t.length)return-1;if("\n"===t.charAt(r)){this.lines=this.lines+1;break}}}else"\n"===t.charAt(r)&&(this.lines=this.lines+1)}return-1}variable(t,e,r){if((n=this.skipSpace(t,e))<0)return-1;if("?"!=t.slice(n,n+1))return-1;var n;if(e=n+=1,"0123456789-".indexOf(t.charAt(n))>=0)throw Oe(this._thisDoc,this.lines,t,n,"Varible name can't start with '"+t.charAt(n)+"s'");for(;e<oe(t)&&ge.indexOf(t.charAt(e))<0;)e+=1;if(null==this._parentContext)throw Oe(this._thisDoc,this.lines,t,n,"Can't use ?xxx syntax for variable in outermost level: "+t.slice(n-1,e));return r.push(this._store.variable(t.slice(n,e))),e}bareWord(t,e,r){var n=this.skipSpace(t,e);if(n<0)return-1;var s=t.charAt(n);if("0123456789-".indexOf(s)>=0)return-1;if(ge.indexOf(s)>=0)return-1;for(e=n;e<oe(t);){var i=t.charAt(e);if("."===i){if(Ne(t,e))break}else if(ge.indexOf(i)>=0)break;e+=1}return r.push(t.slice(n,e)),e}qname(t,e,r){if((e=this.skipSpace(t,e))<0)return-1;var n=t.charAt(e);if("0123456789-+".indexOf(n)>=0)return-1;if(ge.indexOf(n)<0){var s=n;for(e+=1;e<oe(t);){if("."===(n=t.charAt(e))){if(Ne(t,e))break}else if(ge.indexOf(n)>=0)break;s+=n,e+=1}}else s="";if(e<oe(t)&&":"==t.charAt(e)){var i=s;for(e+=1,s="";e<oe(t);){if("."===(n=t.charAt(e))){if(Ne(t,e))break}else if(ge.indexOf(n)>=0)break;s+=n,e+=1}return r.push(new se([i,s])),e}return s&&this.keywordsSet&&Vt(this.keywords,s)<0?(r.push(new se(["",s])),e):-1}object(t,e,r){if((i=this.subject(t,e,r))>=0)return i;{if((i=this.skipSpace(t,e))<0)return-1;e=i;var n=null;let o=t.charAt(e);if('"'==o||"'"==o){n=t.slice(e,e+3==o+o)?o+o+o:o,e+=oe(n);var s=this.strconst(t,e,n),i=s[0],a=s[1];return r.push(this._store.literal(a)),i}return-1}}nodeOrLiteral(t,e,r){if((h=this.node(t,e,r))>=0)return h;if((h=this.skipSpace(t,e))<0)return-1;e=h;var n=t.charAt(e);if("-+0987654321".indexOf(n)>=0){if(be.lastIndex=0,null!=(u=be.exec(t.slice(e))))h=e+(s=u[0]).length,s.indexOf("T")>=0?r.push(this._store.literal(s,this._store.sym("http://www.w3.org/2001/XMLSchema#dateTime"))):r.push(this._store.literal(s,this._store.sym("http://www.w3.org/2001/XMLSchema#date")));else{var s;if(ve.lastIndex=0,null==(u=ve.exec(t.slice(e))))throw Oe(this._thisDoc,this.lines,t,e,"Bad number or date syntax");h=e+ve.lastIndex,(s=t.slice(e,h)).indexOf("e")>=0?r.push(this._store.literal(parseFloat(s),this._store.sym("http://www.w3.org/2001/XMLSchema#double"))):t.slice(e,h).indexOf(".")>=0?r.push(this._store.literal(parseFloat(s),this._store.sym("http://www.w3.org/2001/XMLSchema#decimal"))):r.push(this._store.literal(parseInt(s),this._store.sym("http://www.w3.org/2001/XMLSchema#integer")))}return h}if('"'==t.charAt(e)){if('"""'==t.slice(e,e+3))var i='"""';else i='"';e+=oe(i);var a=null,o=this.strconst(t,e,i),h=o[0],l=o[1],c=null;if("@"==t.slice(h,h+1)){var u;if(xe.lastIndex=0,null==(u=xe.exec(t.slice(h+1))))throw Oe(this._thisDoc,startline,t,e,"Bad language code syntax on string literal, after @");e=xe.lastIndex+h+1,c=t.slice(h+1,e),h=e}if("^^"==t.slice(h,h+2)){var d=new ie([]);h=this.uri_ref2(t,h+2,d),a=d[0]}return r.push(this._store.literal(l,c||a)),h}return-1}strconst(t,e,r){for(var n=e,s="",i=this.lines;n<oe(t);){if(e=n+oe(r),t.slice(n,e)==r)return new se([e,s]);if('"'!=t.charAt(n)){if(Te.lastIndex=0,!Te.exec(t.slice(n)))throw Oe(this._thisDoc,i,t,n,"Closing quote missing in string at ^ in "+t.slice(n-20,n)+"^"+t.slice(n,n+20));if(e=n+Te.lastIndex-1,s+=t.slice(n,e),'"'!=(h=t.charAt(e)))if("\r"!=h){if("\n"==h){if('"'==r)throw Oe(this._thisDoc,i,t,e,"newline found in string literal");this.lines=this.lines+1,s+=h,n=e+1,this.previousLine=this.startOfLine,this.startOfLine=n}else if("\\"==h){if(n=e+1,!(h=t.slice(n,n+1)))throw Oe(this._thisDoc,i,t,e,"unterminated string literal (2)");var a=ue('abfrtvn\\"',h);if(a>=0)s+='a\b\f\r\t\v\n\\"'.charAt(a),n+=1;else if("u"==h)n=(o=this.uEscape(t,n+1,i))[0],s+=h=o[1];else{if("U"!=h)throw Oe(this._thisDoc,this.lines,t,e,"bad escape");var o,h;n=(o=this.UEscape(t,n+1,i))[0],s+=h=o[1]}}}else n=e+1;else n=e}else s=s+'"',n=n+1}throw Oe(this._thisDoc,this.lines,t,e,"unterminated string literal")}uEscape(t,e,r){for(var n=e,s=0,i=0;s<4;){var a=t.slice(n,n+1).toLowerCase();if(n+=1,""==a)throw Oe(this._thisDoc,r,t,e,"unterminated string literal(3)");var o=ue("0123456789abcdef",a);if(o<0)throw Oe(this._thisDoc,r,t,e,"bad string literal hex escape");i=16*i+o,s+=1}var h=String.fromCharCode(i);return new se([n,h])}UEscape(t,e,r){for(var n=e,s=0,i="\\U";s<8;){var a=t.slice(n,n+1).toLowerCase();if(n+=1,""==a)throw Oe(this._thisDoc,r,t,e,"unterminated string literal(3)");if(ue("0123456789abcdef",a)<0)throw Oe(this._thisDoc,r,t,e,"bad string literal hex escape");i+=a,s+=1}var o,h=(o="0x"+he(i,2,10)-0,String.fromCharCode(o));return new se([n,h])}}function Oe(t,e,r,n,s){let i=e+1,a="Line "+i+" of <"+t+">: Bad syntax: "+s+'\nat: "'+r.slice(n,n+30)+'"',o=new SyntaxError(a,t,i);return o.lineNo=i,o.characterInFile=n,o.syntaxProblem=s,o}const Ee={...mt,supports:{[dt.collections]:!0,[dt.defaultGraphType]:!1,[dt.equalsMethod]:!0,[dt.identity]:!1,[dt.id]:!0,[dt.reversibleId]:!1,[dt.variableType]:!0},collection:t=>new Z(t),id(t){return F(t)?`( ${t.elements.map(t=>this.id(t)).join(", ")} )`:_(t)?ut.toString(t):mt.id(t)},termToNQ:t=>t.termType===f?Z.toNT(t):mt.termToNQ(t)},Re=Ee;function Se(t,e){return"string"==typeof e?t.rdfFactory.literal(e):Object.prototype.hasOwnProperty.call(e,"@list")?!0===t.rdfFactory.supports.COLLECTIONS?function(t,e){if(!Array.isArray(e))throw new TypeError("Object must be an array");return t.rdfFactory.collection(e.map(e=>Se(t,e)))}(t,e["@list"]):function(t,e){const r=e["@id"]?je(t,e):t.rdfFactory.blankNode(),n=e["@list"].map(e=>Se(t,e)),s=Bt(t.rdfFactory,r,n);return t.addAll(s),r}(t,e):Object.prototype.hasOwnProperty.call(e,"@id")?je(t,e):Object.prototype.hasOwnProperty.call(e,"@language")?t.rdfFactory.literal(e["@value"],e["@language"]):Object.prototype.hasOwnProperty.call(e,"@type")?t.rdfFactory.literal(e["@value"],t.rdfFactory.namedNode(e["@type"])):Object.prototype.hasOwnProperty.call(e,"@value")?t.rdfFactory.literal(e["@value"]):t.rdfFactory.literal(e)}async function ke(t,e,r){const n=r&&Object.prototype.hasOwnProperty.call(r,"termType")?r.value:r,s=await o.e(515).then(o.t.bind(o,515,23));return(await s.default.flatten(JSON.parse(t),null,{base:n})).reduce((t,e)=>Ie(t,r,e),e)}function je(t,e){return e["@id"].startsWith("_:")?t.rdfFactory.blankNode(e["@id"].substring(2)):t.rdfFactory.namedNode(e["@id"])}function Ie(t,e,r){const n=r["@id"]?je(t,r):t.rdfFactory.blankNode();for(const s of Object.keys(r)){if("@id"===s)continue;if("@graph"==s){const e=n,i=r[s];for(let r=0;r<i.length;r++)t=Ie(t,e,i[r])}const i=r[s];if(Array.isArray(i))for(let r=0;r<i.length;r++)t.addStatement(Fe(t,n,s,i[r],e));else t.addStatement(Fe(t,n,s,i,e))}return t}function Fe(t,e,r,n,s){let i,a;return"@type"===r?(i=t.rdfFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),a=t.rdfFactory.namedNode(n)):(i=t.rdfFactory.namedNode(r),a=Se(t,n)),t.rdfFactory.quad(e,i,a,t.rdfFactory.namedNode(s))}function De(t){const e=(t=t.trim()).match(/^<([^>]*)>/);if(e)return{type:"iri",value:e[1]};const r=t.match(/^_:([^\s]+)/);if(r)return{type:"blank",value:r[1]};const n=t.match(/^"([^"\\]*(?:\\.[^"\\]*)*)"/);if(n){const e=n[1].replace(/\\"/g,'"').replace(/\\\\/g,"\\").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t"),r=t.slice(n[0].length),s=r.match(/^@([a-zA-Z]+(?:-[a-zA-Z0-9]+)*)/);if(s)return{type:"literal",value:e,language:s[1]};const i=r.match(/^\^\^<([^>]*)>/);return i?{type:"literal",value:e,datatype:i[1]}:{type:"literal",value:e}}return null}function Me(t,e){switch(e.type){case"iri":return t.namedNode(e.value);case"blank":return t.blankNode(e.value);case"literal":return e.language?t.literal(e.value,e.language):e.datatype?t.literal(e.value,t.namedNode(e.datatype)):t.literal(e.value,t.namedNode("http://www.w3.org/2001/XMLSchema#string"))}}if(void 0===Le)var Le={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12};class _e{constructor(t,e){this.options=e||{},this.kb=t,this.target=e.target||{graph:{subjects:{},prefixes:{},terms:{}}},this.blankNodes=[],this.htmlOptions={selfClosing:"br img input area base basefont col colgroup source wbr isindex link meta param hr"},this.theOne="_:"+(new Date).getTime(),this.language=null,this.vocabulary=null,this.blankCounter=0,this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"}],this.inXHTMLMode=!1,this.absURIRE=/[\w\_\-]+:\S+/,this.finishedHandlers=[],this.init()}addTriple(t,e,r,n){var s,i,a,o;s=void 0===e?mt.namedNode(this.options.base):this.toRDFNodeObject(e),a=this.toRDFNodeObject(r),i=this.toRDFNodeObject(n),o=mt.namedNode(this.options.base),this.kb.add(s,a,i,o)}ancestorPath(t){for(var e="";t&&t.nodeType!==Le.DOCUMENT_NODE;)e="/"+t.localName+e,t=t.parentNode;return e}copyMappings(t){var e={};for(var r in t)e[r]=t[r];return e}copyProperties(){}deriveDateTimeType(t){for(var e=0;e<_e.dateTimeTypes.length;e++){var r=_e.dateTimeTypes[e].pattern.exec(t);if(r&&r[0].length===t.length)return _e.dateTimeTypes[e].type}return null}init(){}newBlankNode(){return this.blankCounter++,"_:"+this.blankCounter}newSubjectOrigin(t,e){}parseCURIE(t,e,r){var n,s=t.indexOf(":");if(s>=0){var i=t.substring(0,s);if(""===i)return(n=e[""])?n+t.substring(s+1):null;if("_"===i)return"_:"+t.substring(s+1);if(_e.NCNAME.test(i)&&(n=e[i]))return n+t.substring(s+1)}return null}parseCURIEOrURI(t,e,r){return this.parseCURIE(t,e,r)||this.resolveAndNormalize(r,t)}parsePredicate(t,e,r,n,s,i){if(""===t)return null;var a=this.parseTermOrCURIEOrAbsURI(t,e,i?null:r,n,s);return a&&0===a.indexOf("_:")?null:a}parsePrefixMappings(t,e){for(var r=this.tokenize(t),n=null,s=0;s<r.length;s++)":"===r[s][r[s].length-1]?n=r[s].substring(0,r[s].length-1):n&&(e[n]=this.options.base?ht(r[s],this.options.base):r[s],n=null)}static parseRDFaDOM(t,e,r){var n=new _e(e,{base:r});t.baseURI||(t.baseURI=r),n.process(t,{baseURI:r})}parseSafeCURIEOrCURIEOrURI(t,e,r){return"["===(t=this.trim(t)).charAt(0)&&"]"===t.charAt(t.length-1)?0===(t=(t=t.substring(1,t.length-1)).trim(t)).length?null:"_:"===t?this.theOne:this.parseCURIE(t,e,r):this.parseCURIEOrURI(t,e,r)}parseTermOrCURIEOrAbsURI(t,e,r,n,s){t=this.trim(t);var i=this.parseCURIE(t,n,s);if(i)return i;if(r){if(e&&!this.absURIRE.exec(t))return e+t;var a=r[t];if(a)return a;if(a=r[t.toLowerCase()])return a}return this.absURIRE.exec(t)?this.resolveAndNormalize(s,t):null}parseTermOrCURIEOrURI(t,e,r,n,s){t=this.trim(t);var i=this.parseCURIE(t,n,s);if(i)return i;var a=r[t];return a||((a=r[t.toLowerCase()])?a:e&&!this.absURIRE.exec(t)?e+t:this.resolveAndNormalize(s,t))}parseURI(t){return t}process(t,e){var r;e=e||{},t.nodeType===Le.DOCUMENT_NODE?(t.baseURI&&!e.baseURI&&(e.baseURI=t.baseURI),r=t.baseURI,(t=t.documentElement).baseURI||(t.baseURI=r),this.setContext(t)):t.parentNode.nodeType===Le.DOCUMENT_NODE&&this.setContext(t);var n=[],s=function(t){if(!t&&e&&e.baseURI)return e.baseURI;var r=t.indexOf("#");return r>=0&&(t=t.substring(0,r)),e&&e.baseURIMap&&(t=e.baseURIMap(t)),t};for(n.push({current:t,context:this.push(null,s(t.baseURI))});n.length>0;){var i=n.shift();if(i.parent){if(i.context.parent&&i.context.parent.listMapping===i.listMapping)continue;for(let t in i.listMapping){var a=i.listMapping[t];if(0!==a.length){var o=[];for(let t=0;t<a.length;t++)o.push(this.newBlankNode());for(let t=0;t<o.length;t++)this.addTriple(i.parent,o[t],"http://www.w3.org/1999/02/22-rdf-syntax-ns#first",a[t]),this.addTriple(i.parent,o[t],"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest",{type:_e.objectURI,value:t+1<o.length?o[t+1]:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"});this.addTriple(i.parent,i.subject,t,{type:_e.objectURI,value:o[0]})}else this.addTriple(i.parent,i.subject,t,{type:_e.objectURI,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"})}}else{var h=i.current,l=i.context,c=!1,u=null,d=null,f=null,p=l.prefixes,m=!1,w=[],g=l.listMapping,v=!l.parent,b=l.language,y=l.vocabulary;r=this.parseURI(s(h.baseURI)),h.item=null;var T=h.getAttributeNode("vocab");if(T){let t=this.trim(T.value);if(t.length>0){y=t;var x=r.spec;this.addTriple(h,x,"http://www.w3.org/ns/rdfa#usesVocabulary",{type:_e.objectURI,value:y})}else y=this.vocabulary}for(var N=0;N<h.attributes.length;N++){var A=h.attributes[N];if("x"===A.nodeName.charAt(0)&&0===A.nodeName.indexOf("xmlns:")){m||(p=this.copyMappings(p),m=!0);var C=A.nodeName.substring(6),O=_e.trim(A.value);p[C]=this.options.base?ht(O,this.options.base):O}}var E=h.getAttributeNode("prefix");E&&(m||(p=this.copyMappings(p),m=!0),this.parsePrefixMappings(E.value,p));var R=null;for(let t=0;!R&&t<this.langAttributes.length;t++)R=h.getAttributeNodeNS(this.langAttributes[t].namespaceURI,this.langAttributes[t].localName);if(R){let t=_e.trim(R.value);b=t.length>0?t:null}var S,k,j=h.getAttributeNode("rel"),I=h.getAttributeNode("rev"),F=h.getAttributeNode("typeof"),D=h.getAttributeNode("property"),M=h.getAttributeNode("datatype"),L=this.inHTMLMode?h.getAttributeNode("datetime"):null,_=h.getAttributeNode("content"),U=h.getAttributeNode("about"),P=h.getAttributeNode("src"),q=h.getAttributeNode("resource"),H=h.getAttributeNode("href"),X=h.getAttributeNode("inlist"),B=[];if(j){k=this.tokenize(j.value);for(let t=0;t<k.length;t++)(S=this.parsePredicate(k[t],y,l.terms,p,r,this.inHTMLMode&&null!==D))&&B.push(S)}var V=[];if(I){k=this.tokenize(I.value);for(let t=0;t<k.length;t++)(S=this.parsePredicate(k[t],y,l.terms,p,r,this.inHTMLMode&&D))&&V.push(S)}if(this.inHTMLMode&&(j||I)&&D&&(0===B.length&&(j=null),0===V.length&&(I=null)),j||I?(U&&(u=this.parseSafeCURIEOrCURIEOrURI(U.value,p,r)),F&&(f=u),u||(h.parentNode.nodeType===Le.DOCUMENT_NODE?u=s(h.baseURI):l.parentObject&&(u=s(h.parentNode.baseURI)===l.parentObject?s(h.baseURI):l.parentObject)),q&&(d=this.parseSafeCURIEOrCURIEOrURI(q.value,p,r)),d||(H?d=this.resolveAndNormalize(r,encodeURI(H.value)):P?d=this.resolveAndNormalize(r,encodeURI(P.value)):!F||U||this.inXHTMLMode&&("head"===h.localName||"body"===h.localName)||(d=this.newBlankNode())),!F||U||!this.inXHTMLMode||"head"!==h.localName&&"body"!==h.localName?F&&!U&&(f=d):f=u):!D||_||M?(U&&(u=this.parseSafeCURIEOrCURIEOrURI(U.value,p,r)),!u&&q&&(u=this.parseSafeCURIEOrCURIEOrURI(q.value,p,r)),!u&&H&&(u=this.resolveAndNormalize(r,encodeURI(H.value))),!u&&P&&(u=this.resolveAndNormalize(r,encodeURI(P.value))),u||(h.parentNode.nodeType===Le.DOCUMENT_NODE?u=s(h.baseURI):!this.inXHTMLMode&&!this.inHTMLMode||"head"!==h.localName&&"body"!==h.localName?F?u=this.newBlankNode():l.parentObject&&(u=s(h.parentNode.baseURI)===l.parentObject?s(h.baseURI):l.parentObject,D||(c=!0)):u=s(h.parentNode.baseURI)===l.parentObject?s(h.baseURI):l.parentObject),F&&(f=u)):(U&&(u=this.parseSafeCURIEOrCURIEOrURI(U.value,p,r),F&&(f=u)),u||h.parentNode.nodeType!==Le.DOCUMENT_NODE?!u&&l.parentObject&&(u=s(h.parentNode.baseURI)===l.parentObject?s(h.baseURI):l.parentObject):(u=s(h.baseURI),F&&(f=u)),F&&!f&&(q&&(f=this.parseSafeCURIEOrCURIEOrURI(q.value,p,r)),!f&&H&&(f=this.resolveAndNormalize(r,encodeURI(H.value))),!f&&P&&(f=this.resolveAndNormalize(r,encodeURI(P.value))),f||!this.inXHTMLMode&&!this.inHTMLMode||"head"!==h.localName&&"body"!==h.localName||(f=u),f||(f=this.newBlankNode()),d=f)),u&&(U||q||f)){var z=u;F&&!U&&!q&&d&&(z=d),this.newSubjectOrigin(h,z)}if(f){k=this.tokenize(F.value);for(let t=0;t<k.length;t++){var $=this.parseTermOrCURIEOrAbsURI(k[t],y,l.terms,p,r);$&&this.addTriple(h,f,_e.typeURI,{type:_e.objectURI,value:$})}}if(u&&u!==l.parentObject&&(g={},v=!0),d){if(j&&X)for(let t=0;t<B.length;t++){let e=g[B[t]];e||(e=[],g[B[t]]=e),e.push({type:_e.objectURI,value:d})}else if(j)for(let t=0;t<B.length;t++)this.addTriple(h,u,B[t],{type:_e.objectURI,value:d});if(I)for(let t=0;t<V.length;t++)this.addTriple(h,d,V[t],{type:_e.objectURI,value:u})}else{if(u&&!d&&(j||I)&&(d=this.newBlankNode()),j&&X)for(let t=0;t<B.length;t++){let e=g[B[t]];e||(e=[],g[S]=e),w.push({predicate:B[t],list:e})}else if(j)for(let t=0;t<B.length;t++)w.push({predicate:B[t],forward:!0});if(I)for(let t=0;t<V.length;t++)w.push({predicate:V[t],forward:!1})}if(D){var W=null,Q=null;M?(W=""===M.value?_e.PlainLiteralURI:this.parseTermOrCURIEOrAbsURI(M.value,y,l.terms,p,r),Q=L&&!_?L.value:W===_e.XMLLiteralURI||W===_e.HTMLLiteralURI?null:_?_.value:h.textContent):_?(W=_e.PlainLiteralURI,Q=_.value):L?(Q=L.value,(W=_e.deriveDateTimeType(Q))||(W=_e.PlainLiteralURI)):j||I||(q&&(Q=this.parseSafeCURIEOrCURIEOrURI(q.value,p,r)),!Q&&H?Q=this.resolveAndNormalize(r,encodeURI(H.value)):!Q&&P&&(Q=this.resolveAndNormalize(r,encodeURI(P.value))),Q&&(W=_e.objectURI)),W||(F&&!U?(W=_e.objectURI,Q=f):(Q=h.textContent,this.inHTMLMode&&"time"===h.localName&&(W=_e.deriveDateTimeType(Q)),W||(W=_e.PlainLiteralURI))),k=this.tokenize(D.value);for(let t=0;t<k.length;t++){let e=this.parsePredicate(k[t],y,l.terms,p,r);if(e)if(X){let t=g[e];t||(t=[],g[e]=t),t.push(W===_e.XMLLiteralURI||W===_e.HTMLLiteralURI?{type:W,value:h.childNodes}:{type:W||_e.PlainLiteralURI,value:Q,language:b})}else W===_e.XMLLiteralURI||W===_e.HTMLLiteralURI?this.addTriple(h,u,e,{type:W,value:h.childNodes}):this.addTriple(h,u,e,{type:W||_e.PlainLiteralURI,value:Q,language:b})}}if(u&&!c)for(let t=0;t<l.incomplete.length;t++)l.incomplete[t].list?l.incomplete[t].list.push({type:_e.objectURI,value:u}):l.incomplete[t].forward?this.addTriple(h,l.subject,l.incomplete[t].predicate,{type:_e.objectURI,value:u}):this.addTriple(h,u,l.incomplete[t].predicate,{type:_e.objectURI,value:l.subject});var G=null,Y=u;c?((G=this.push(l,l.subject)).parentObject=s(h.parentNode.baseURI)===l.parentObject?s(h.baseURI):l.parentObject,G.incomplete=l.incomplete,G.language=b,G.prefixes=p,G.vocabulary=y):((G=this.push(l,u)).parentObject=d||u||l.subject,G.prefixes=p,G.incomplete=w,d&&(Y=d,g={},v=!0),G.listMapping=g,G.language=b,G.vocabulary=y),v&&n.unshift({parent:h,context:l,subject:Y,listMapping:g});for(var Z=h.lastChild;Z;Z=Z.previousSibling)Z.nodeType===Le.ELEMENT_NODE&&n.unshift({current:Z,context:G})}}this.inHTMLMode&&this.copyProperties();for(let e=0;e<this.finishedHandlers.length;e++)this.finishedHandlers[e](t)}push(t,e){return{parent:t,subject:e||(t?t.subject:null),parentObject:null,incomplete:[],listMapping:t?t.listMapping:{},language:t?t.language:this.language,prefixes:t?t.prefixes:this.target.graph.prefixes,terms:t?t.terms:this.target.graph.terms,vocabulary:t?t.vocabulary:this.vocabulary}}resolveAndNormalize(t,e){return ht(e,t)}setContext(t){"html"===t.localName&&"XHTML+RDFa 1.1"===t.getAttribute("version")?this.setXHTMLContext():"html"===t.localName||"http://www.w3.org/1999/xhtml"===t.namespaceURI?"undefined"!=typeof document&&document.doctype?"-//W3C//DTD XHTML+RDFa 1.0//EN"===document.doctype.publicId&&"http://www.w3.org/MarkUp/DTD/xhtml-rdfa-1.dtd"===document.doctype.systemId?(console.log("WARNING: RDF 1.0 is not supported.  Defaulting to HTML5 mode."),this.setHTMLContext()):"-//W3C//DTD XHTML+RDFa 1.1//EN"===document.doctype.publicId&&"http://www.w3.org/MarkUp/DTD/xhtml-rdfa-2.dtd"===document.doctype.systemId?this.setXHTMLContext():this.setHTMLContext():this.setHTMLContext():this.setXMLContext()}setHTMLContext(){this.setInitialContext(),this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"},{namespaceURI:null,localName:"lang"}],this.inXHTMLMode=!1,this.inHTMLMode=!0}setInitialContext(){this.vocabulary=null,this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"}]}setXHTMLContext(){this.setInitialContext(),this.inXHTMLMode=!0,this.inHTMLMode=!1,this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"},{namespaceURI:null,localName:"lang"}],this.target.graph.terms.alternate="http://www.w3.org/1999/xhtml/vocab#alternate",this.target.graph.terms.appendix="http://www.w3.org/1999/xhtml/vocab#appendix",this.target.graph.terms.bookmark="http://www.w3.org/1999/xhtml/vocab#bookmark",this.target.graph.terms.cite="http://www.w3.org/1999/xhtml/vocab#cite",this.target.graph.terms.chapter="http://www.w3.org/1999/xhtml/vocab#chapter",this.target.graph.terms.contents="http://www.w3.org/1999/xhtml/vocab#contents",this.target.graph.terms.copyright="http://www.w3.org/1999/xhtml/vocab#copyright",this.target.graph.terms.first="http://www.w3.org/1999/xhtml/vocab#first",this.target.graph.terms.glossary="http://www.w3.org/1999/xhtml/vocab#glossary",this.target.graph.terms.help="http://www.w3.org/1999/xhtml/vocab#help",this.target.graph.terms.icon="http://www.w3.org/1999/xhtml/vocab#icon",this.target.graph.terms.index="http://www.w3.org/1999/xhtml/vocab#index",this.target.graph.terms.last="http://www.w3.org/1999/xhtml/vocab#last",this.target.graph.terms.license="http://www.w3.org/1999/xhtml/vocab#license",this.target.graph.terms.meta="http://www.w3.org/1999/xhtml/vocab#meta",this.target.graph.terms.next="http://www.w3.org/1999/xhtml/vocab#next",this.target.graph.terms.prev="http://www.w3.org/1999/xhtml/vocab#prev",this.target.graph.terms.previous="http://www.w3.org/1999/xhtml/vocab#previous",this.target.graph.terms.section="http://www.w3.org/1999/xhtml/vocab#section",this.target.graph.terms.stylesheet="http://www.w3.org/1999/xhtml/vocab#stylesheet",this.target.graph.terms.subsection="http://www.w3.org/1999/xhtml/vocab#subsection",this.target.graph.terms.start="http://www.w3.org/1999/xhtml/vocab#start",this.target.graph.terms.top="http://www.w3.org/1999/xhtml/vocab#top",this.target.graph.terms.up="http://www.w3.org/1999/xhtml/vocab#up",this.target.graph.terms.p3pv1="http://www.w3.org/1999/xhtml/vocab#p3pv1",this.target.graph.terms.related="http://www.w3.org/1999/xhtml/vocab#related",this.target.graph.terms.role="http://www.w3.org/1999/xhtml/vocab#role",this.target.graph.terms.transformation="http://www.w3.org/1999/xhtml/vocab#transformation"}setXMLContext(){this.setInitialContext(),this.inXHTMLMode=!1,this.inHTMLMode=!1}tokenize(t){return this.trim(t).split(/\s+/)}static tokenize(t){return this.trim(t).split(/\s+/)}toRDFNodeObject(t){if(void 0!==t){if("string"==typeof t)return"_:"===t.substring(0,2)?(void 0===this.blankNodes[t.substring(2)]&&(this.blankNodes[t.substring(2)]=new S(t.substring(2))),this.blankNodes[t.substring(2)]):mt.namedNode(t);switch(t.type){case _e.objectURI:return"_:"===t.value.substring(0,2)?(void 0===this.blankNodes[t.value.substring(2)]&&(this.blankNodes[t.value.substring(2)]=new S(t.value.substring(2))),this.blankNodes[t.value.substring(2)]):mt.namedNode(t.value);case _e.PlainLiteralURI:return new G(t.value,t.language||"");case _e.XMLLiteralURI:case _e.HTMLLiteralURI:var e="";return Object.keys(t.value).forEach(r=>{e+=Ct(t.value[r],this.htmlOptions)}),new G(e,"",new W(t.type));default:return new G(t.value,"",new W(t.type))}}}trim(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}static trim(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}_e.XMLLiteralURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#XMLLiteral",_e.HTMLLiteralURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#HTML",_e.PlainLiteralURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#PlainLiteral",_e.objectURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#object",_e.typeURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",_e.nameChar="[-A-Z_a-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�က0-F.0-9·̀-ͯ‿-⁀]",_e.nameStartChar="[A-Za-zÀ-ÖØ-öø-ÿĀ-ıĴ-ľŁ-ňŊ-žƀ-ǃǍ-ǰǴ-ǵǺ-ȗɐ-ʨʻ-ˁΆΈ-ΊΌΎ-ΡΣ-ώϐ-ϖϚϜϞϠϢ-ϳЁ-ЌЎ-яё-ќў-ҁҐ-ӄӇ-ӈӋ-ӌӐ-ӫӮ-ӵӸ-ӹԱ-Ֆՙա-ֆא-תװ-ײء-غف-يٱ-ڷں-ھۀ-ێې-ۓەۥ-ۦअ-हऽक़-ॡঅ-ঌএ-ঐও-নপ-রলশ-হড়-ঢ়য়-ৡৰ-ৱਅ-ਊਏ-ਐਓ-ਨਪ-ਰਲ-ਲ਼ਵ-ਸ਼ਸ-ਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઋઍએ-ઑઓ-નપ-રલ-ળવ-હઽૠଅ-ଌଏ-ଐଓ-ନପ-ରଲ-ଳଶ-ହଽଡ଼-ଢ଼ୟ-ୡஅ-ஊஎ-ஐஒ-கங-சஜஞ-டண-தந-பம-வஷ-ஹఅ-ఌఎ-ఐఒ-నప-ళవ-హౠ-ౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹೞೠ-ೡഅ-ഌഎ-ഐഒ-നപ-ഹൠ-ൡก-ฮะา-ำเ-ๅກ-ຂຄງ-ຈຊຍດ-ທນ-ຟມ-ຣລວສ-ຫອ-ຮະາ-ຳຽເ-ໄཀ-ཇཉ-ཀྵႠ-Ⴥა-ჶᄀᄂ-ᄃᄅ-ᄇᄉᄋ-ᄌᄎ-ᄒᄼᄾᅀᅌᅎᅐᅔ-ᅕᅙᅟ-ᅡᅣᅥᅧᅩᅭ-ᅮᅲ-ᅳᅵᆞᆨᆫᆮ-ᆯᆷ-ᆸᆺᆼ-ᇂᇫᇰᇹḀ-ẛẠ-ỹἀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼΩK-Å℮ↀ-ↂぁ-ゔァ-ヺㄅ-ㄬ가-힣一-龥〇〡-〩_]",_e.NCNAME=new RegExp("^"+_e.nameStartChar+_e.nameChar+"*$"),_e.dateTimeTypes=[{pattern:/-?P(?:[0-9]+Y)?(?:[0-9]+M)?(?:[0-9]+D)?(?:T(?:[0-9]+H)?(?:[0-9]+M)?(?:[0-9]+(?:\.[0-9]+)?S)?)?/,type:"http://www.w3.org/2001/XMLSchema#duration"},{pattern:/-?(?:[1-9][0-9][0-9][0-9]|0[1-9][0-9][0-9]|00[1-9][0-9]|000[1-9])-[0-9][0-9]-[0-9][0-9]T(?:[0-1][0-9]|2[0-4]):[0-5][0-9]:[0-5][0-9](?:\.[0-9]+)?(?:Z|[+\-][0-9][0-9]:[0-9][0-9])?/,type:"http://www.w3.org/2001/XMLSchema#dateTime"},{pattern:/-?(?:[1-9][0-9][0-9][0-9]|0[1-9][0-9][0-9]|00[1-9][0-9]|000[1-9])-[0-9][0-9]-[0-9][0-9](?:Z|[+\-][0-9][0-9]:[0-9][0-9])?/,type:"http://www.w3.org/2001/XMLSchema#date"},{pattern:/(?:[0-1][0-9]|2[0-4]):[0-5][0-9]:[0-5][0-9](?:\.[0-9]+)?(?:Z|[+\-][0-9][0-9]:[0-9][0-9])?/,type:"http://www.w3.org/2001/XMLSchema#time"},{pattern:/-?(?:[1-9][0-9][0-9][0-9]|0[1-9][0-9][0-9]|00[1-9][0-9]|000[1-9])-[0-9][0-9]/,type:"http://www.w3.org/2001/XMLSchema#gYearMonth"},{pattern:/-?[1-9][0-9][0-9][0-9]|0[1-9][0-9][0-9]|00[1-9][0-9]|000[1-9]/,type:"http://www.w3.org/2001/XMLSchema#gYear"}];const Ue=_e.parseRDFaDOM;class Pe{constructor(t){this.store=t,this.bnodes={},this.why=null,this.reify=!1}frameFactory(t,e,r){return{NODE:1,ARC:2,parent:e,parser:t,store:t.store,element:r,lastChild:0,base:null,lang:null,node:null,nodeType:null,listIndex:1,rdfid:null,datatype:null,collection:!1,terminateFrame:function(){this.collection&&this.node.close()},addSymbol:function(t,e){e=ht(e,this.base),this.node=this.store.sym(e),this.nodeType=t},loadTriple:function(){if(this.parent.parent.collection?this.parent.parent.node.append(this.node):this.store.add(this.parent.parent.node,this.parent.node,this.node,this.parser.why),null!=this.parent.rdfid){var t=this.store.sym(ht("#"+this.parent.rdfid,this.base));this.store.add(t,this.store.sym(Pe.ns.RDF+"type"),this.store.sym(Pe.ns.RDF+"Statement"),this.parser.why),this.store.add(t,this.store.sym(Pe.ns.RDF+"subject"),this.parent.parent.node,this.parser.why),this.store.add(t,this.store.sym(Pe.ns.RDF+"predicate"),this.parent.node,this.parser.why),this.store.add(t,this.store.sym(Pe.ns.RDF+"object"),this.node,this.parser.why)}},isTripleToLoad:function(){return null!=this.parent&&null!=this.parent.parent&&this.nodeType===this.NODE&&this.parent.nodeType===this.ARC&&this.parent.parent.nodeType===this.NODE},addNode:function(t){this.addSymbol(this.NODE,t),this.isTripleToLoad()&&this.loadTriple()},addCollection:function(){this.nodeType=this.NODE,this.node=this.store.collection(),this.collection=!0,this.isTripleToLoad()&&this.loadTriple()},addCollectionArc:function(){this.nodeType=this.ARC},addBNode:function(t){null!=t?null!=this.parser.bnodes[t]?this.node=this.parser.bnodes[t]:this.node=this.parser.bnodes[t]=this.store.bnode():this.node=this.store.bnode(),this.nodeType=this.NODE,this.isTripleToLoad()&&this.loadTriple()},addArc:function(t){t===Pe.ns.RDF+"li"&&(t=Pe.ns.RDF+"_"+this.parent.listIndex,this.parent.listIndex++),this.addSymbol(this.ARC,t)},addLiteral:function(t){this.parent.datatype&&this.parent.datatype!==Pe.ns.RDF+"langString"?this.node=this.store.literal(t,this.store.sym(this.parent.datatype)):this.node=this.store.literal(t,this.lang),this.nodeType=this.NODE,this.isTripleToLoad()&&this.loadTriple()}}}getAttributeNodeNS(t,e,r){var n=null;if(t.getAttributeNodeNS)n=t.getAttributeNodeNS(e,r);else for(var s,i=t.attributes,a=0;a<i.length;++a)if((s=i[a]).namespaceURI===e&&(s.prefix?s.prefix+":"+r:r)===s.nodeName){n=s;break}return n}parse(t,e,r){var n,s=t.childNodes;if(this.cleanParser(),t.nodeType===Pe.nodeType.DOCUMENT){for(var i=0;i<s.length;i++)if(s[i].nodeType===Pe.nodeType.ELEMENT){n=s[i];break}}else{if(t.nodeType!==Pe.nodeType.ELEMENT)throw new Error("RDFParser: can't find root in "+e+". Halting. ");n=t}this.why=r;var a=this.frameFactory(this);return this.base=e,a.base=e,a.lang=null,this.parseDOM(this.buildFrame(a,n)),!0}parseDOM(t){for(var e,r=function(t){var e="";if(null==t.namespaceURI)throw new Error("RDF/XML syntax error: No namespace for "+t.localName+" in "+this.base);return t.namespaceURI&&(e+=t.namespaceURI),t.localName?e+=t.localName:t.nodeName&&(t.nodeName.indexOf(":")>=0?e+=t.nodeName.split(":")[1]:e+=t.nodeName),e}.bind(this),n=!0;t.parent;){var s=t.element,i=s.attributes;if(s.nodeType===Pe.nodeType.TEXT||s.nodeType===Pe.nodeType.CDATA_SECTION)t.parent.nodeType===t.NODE&&(t.addArc(Pe.ns.RDF+"value"),t=this.buildFrame(t)),t.addLiteral(s.nodeValue);else if(r(s)!==Pe.ns.RDF+"RDF")if(t.parent&&t.parent.collection&&(t.addCollectionArc(),(t=this.buildFrame(t,t.element)).parent.element=null),t.parent&&t.parent.nodeType&&t.parent.nodeType!==t.ARC){t.addArc(r(s)),this.reify&&(e=this.getAttributeNodeNS(s,Pe.ns.RDF,"ID"))&&(t.rdfid=e.nodeValue,s.removeAttributeNode(e));var a=this.getAttributeNodeNS(s,Pe.ns.RDF,"parseType"),o=this.getAttributeNodeNS(s,Pe.ns.RDF,"datatype");if(o&&(t.datatype=o.nodeValue,s.removeAttributeNode(o)),a){var h=a.nodeValue;"Literal"===h?(t.datatype=Pe.ns.RDF+"XMLLiteral",(t=this.buildFrame(t)).addLiteral(s.innerHTML||s.childNodes),n=!1):"Resource"===h?((t=this.buildFrame(t,t.element)).parent.element=null,t.addBNode()):"Collection"===h&&((t=this.buildFrame(t,t.element)).parent.element=null,t.addCollection()),s.removeAttributeNode(a)}if(0!==i.length){var l=this.getAttributeNodeNS(s,Pe.ns.RDF,"resource"),c=this.getAttributeNodeNS(s,Pe.ns.RDF,"nodeID");t=this.buildFrame(t),l?(t.addNode(l.nodeValue),s.removeAttributeNode(l)):c?(t.addBNode(c.nodeValue),s.removeAttributeNode(c)):t.addBNode();for(var u=i.length-1;u>=0;u--){var d=this.buildFrame(t);d.addArc(r(i[u])),r(i[u])===Pe.ns.RDF+"type"?this.buildFrame(d).addNode(i[u].nodeValue):this.buildFrame(d).addLiteral(i[u].nodeValue)}}else 0===s.childNodes.length&&this.buildFrame(t).addLiteral("")}else{var f=this.getAttributeNodeNS(s,Pe.ns.RDF,"about");if(e=this.getAttributeNodeNS(s,Pe.ns.RDF,"ID"),f&&e)throw new Error("RDFParser: "+s.nodeName+" has both rdf:id and rdf:about. Halting. Only one of these properties may be specified on a node.");if(!f&&e)t.addNode("#"+e.nodeValue),s.removeAttributeNode(e);else if(null==f&&null==e){var p=this.getAttributeNodeNS(s,Pe.ns.RDF,"nodeID");p?(t.addBNode(p.nodeValue),s.removeAttributeNode(p)):t.addBNode()}else t.addNode(f.nodeValue),s.removeAttributeNode(f);var m=this.getAttributeNodeNS(s,Pe.ns.RDF,"type");Pe.ns.RDF+"Description"!==r(s)&&(m={nodeValue:r(s)}),null!=m&&(this.store.add(t.node,this.store.sym(Pe.ns.RDF+"type"),this.store.sym(ht(m.nodeValue,t.base)),this.why),m.nodeName&&s.removeAttributeNode(m));for(var w=i.length-1;w>=0;w--)this.store.add(t.node,this.store.sym(r(i[w])),this.store.literal(i[w].nodeValue,t.lang),this.why)}for(s=t.element;t.parent;){for(var g=t;null==s;)s=(t=t.parent).element;var v=s.childNodes&&s.childNodes[t.lastChild];if(v&&n){if((v.nodeType===Pe.nodeType.ELEMENT||v.nodeType===Pe.nodeType.TEXT||v.nodeType===Pe.nodeType.CDATA_SECTION)&&(v.nodeType!==Pe.nodeType.TEXT&&v.nodeType!==Pe.nodeType.CDATA_SECTION||1===s.childNodes.length)){t.lastChild++,t=this.buildFrame(g,s.childNodes[t.lastChild-1]);break}t.lastChild++}else{if(t.terminateFrame(),!(t=t.parent))break;s=t.element,n=!0}}}}cleanParser(){this.bnodes={},this.why=null}buildFrame(t,e){var r=this.frameFactory(this,t,e);if(t&&(r.base=t.base,r.lang=t.lang),!e||e.nodeType===Pe.nodeType.TEXT||e.nodeType===Pe.nodeType.CDATA_SECTION)return r;var n=e.attributes,s=e.getAttributeNode("xml:base");null!=s&&(r.base=s.nodeValue,e.removeAttribute("xml:base"));var i=e.getAttributeNode("xml:lang");null!=i&&(r.lang=i.nodeValue,e.removeAttribute("xml:lang"));for(var a=n.length-1;a>=0;a--)if("xml"===n[a].nodeName.substr(0,3)){if("xmlns:"===n[a].name.slice(0,6)){var o=n[a].nodeValue;this.base&&(o=ht(o,this.base)),this.store.setPrefixForURI(n[a].name.slice(6),o)}e.removeAttributeNode(n[a])}return r}}function qe(t,e,r){var n,s,i,a=["INSERT","DELETE","WHERE"],o=gt("http://www.w3.org/ns/pim/patch#"),h=Ae(e,e,r,r,null,null,"",null),l={},c=function(t,e,r,n,s){return"Line "+(e+1)+" of <"+t+">: Bad syntax:\n   "+s+'\n   at: "'+r.slice(n,n+30)+'"'};n=0;var u=e.sym(r+"#query");for(l.query=u;;){if((s=h.skipSpace(t,n))<0)return l;if(";"===t[s]){if((n=h.skipSpace(t,s+1))<0)return l;s=n}var d=!1;for(i=0;i<a.length;i++){var f=a[i];if(t.slice(s,s+f.length)===f){if((n=h.skipSpace(t,s+f.length))<0)throw c(h._thisDoc,h.lines,t,s+f.length,"found EOF, needed {...} after "+f);if(("INSERT"===f||"DELETE"===f)&&"DATA"===t.slice(n,n+4)){if((s=h.skipSpace(t,n+4))<0)throw c(h._thisDoc,h.lines,t,n+4,"needed {...} after INSERT DATA "+f);n=s}var p=[];if((s=h.node(t,n,p))<0)throw c(h._thisDoc,h.lines,t,n,"bad syntax or EOF in {...} after "+f);l[f.toLowerCase()]=p[0],e.add(u,o(f.toLowerCase()),p[0]),d=!0,n=s}}if(!d&&"@prefix"===t.slice(s,s+7)){if((n=h.directive(t,s))<0)throw c(h._thisDoc,h.lines,t,n,"bad syntax or EOF after @prefix ");n=h.checkDot(t,n),d=!0}if(!d)throw c(h._thisDoc,h.lines,t,s,"Unknown syntax at start of statememt: '"+t.slice(s).slice(0,20)+"'")}}function He(t,e,r,n="text/turtle",s){n=(n=n||O).split(";")[0];try{if(n===v||n===O)Ae(e,e,r,r,null,null,"",null).loadBuf(t),i();else if(n===N)new Pe(e).parse(It(t),r,e.sym(r)),i();else if(n===R)Ue(It(t,{contentType:R}),e,r),i();else if(n===w)Ue(It(t,{contentType:w}),e,r),i();else if(n===A||n===C)qe(t,e,r),i();else if(n===g)ke(t,e,r).then(i).catch(a);else{if(n!==T&&n!==y)throw void 0===n?new Error("contentType is undefined"):new Error("Don't know how to parse "+n+" yet");!function(t,e,r){const n=t.split(/\r?\n/);for(const t of n){const n=t.trim();if(!n||n.startsWith("#"))continue;const s=n.replace(/\s*\.\s*$/,""),i=[];let a="",o=!1,h=!1;for(let t=0;t<s.length;t++){const e=s[t];h?(a+=e,h=!1):"\\"!==e?'"'!==e?o||" "!==e&&"\t"!==e?a+=e:a&&(i.push(a),a=""):(a+=e,o=!o):(a+=e,h=!0)}if(a&&i.push(a),!(i.length<3))try{const n=De(i[0]),s=De(i[1]),a=De(i[2]),o=i[3]?De(i[3]):null;if(!n||!s||!a){r(new Error(`Failed to parse line: ${t}`),null);continue}r(null,e.quad(Me(e,n),Me(e,s),Me(e,a),o?Me(e,o):e.defaultGraph()))}catch(t){r(t,null)}}r(null,null)}(t,Re,(t,r)=>{t?a(t):r?e.add(r.subject,r.predicate,r.object,r.graph):i()})}}catch(t){a(t)}function i(){s&&s(null,e)}function a(t){if(n!==g||n!==T||n!==y){if(!s){let e=new Error(t+" while trying to parse <"+r+"> as "+n);throw e.cause=t,e}s(t,e)}}He.handled={"text/n3":!0,"text/turtle":!0,"application/rdf+xml":!0,"application/xhtml+xml":!0,"text/html":!0,"application/sparql-update":!0,"application/sparql-update-single-match":!0,"application/ld+json":!0,"application/nquads":!0,"application/n-quads":!0}}n(Pe,"ns",{RDF:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDFS:"http://www.w3.org/2000/01/rdf-schema#"}),n(Pe,"nodeType",{ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12});const Xe={"text/n3":!0,"text/turtle":!0,"application/rdf+xml":!0,"application/xhtml+xml":!0,"text/html":!0,"application/ld+json":!0},Be={rdf:N,owl:N,n3:"text/n3",ttl:"text/turtle",nt:"text/n3",acl:"text/n3",html:"text/html",xml:"text/xml"},Ve=t=>({link:gt("http://www.w3.org/2007/ont/link#",t),http:gt("http://www.w3.org/2007/ont/http#",t),httph:gt("http://www.w3.org/2007/ont/httph#",t),rdf:gt("http://www.w3.org/1999/02/22-rdf-syntax-ns#",t),rdfs:gt("http://www.w3.org/2000/01/rdf-schema#",t),dc:gt("http://purl.org/dc/elements/1.1/",t),ldp:gt("http://www.w3.org/ns/ldp#",t)}),ze=Ve();class $e{constructor(t,e){n(this,"response",void 0),n(this,"dom",void 0),this.response=t,this.dom=e}}n($e,"pattern",void 0);class We extends $e{static toString(){return"RDFXMLHandler"}static register(t){t.mediatypes[N]={q:.9}}parse(t,e,r){let n=t.store;this.dom||(this.dom=It(e));let s=this.dom.documentElement;if(s&&"parsererror"===s.nodeName)return t.failFetch(r,"Badly formed XML in "+r.resource.value,"parse_error");let i=new Pe(n);try{i.parse(this.dom,r.original.value,r.original)}catch(e){return t.failFetch(r,"Syntax error parsing RDF/XML! "+e,"parse_error")}return r.noMeta||n.add(r.original,ze.rdf("type"),ze.link("RDFDocument"),t.appNode),t.doneFetch(r,this.response)}}We.pattern=new RegExp("application/rdf\\+xml");class Qe extends $e{static toString(){return"XHTMLHandler"}static register(t){t.mediatypes[R]={q:.8}}parse(t,e,r){let n,s;this.dom||(this.dom=It(e));let i=t.store,a=this.dom.getElementsByTagName("title");a.length>0&&i.add(r.resource,ze.dc("title"),i.rdfFactory.literal(a[0].textContent),r.resource);let o=this.dom.getElementsByTagName("link");for(let e=o.length-1;e>=0;e--)n=o[e].getAttribute("rel"),s=!1,n||(n=o[e].getAttribute("rev"),s=!0),n&&t.linkData(r.original,n,o[e].getAttribute("href"),r.resource,s);let h=this.dom.getElementsByTagName("script");for(let t=0;t<h.length;t++){let e=h[t].getAttribute("type");Xe[e]&&(He(h[t].textContent,i,r.original.value,e),He(h[t].textContent,i,r.original.value,e))}if(r.noMeta||i.add(r.resource,ze.rdf("type"),ze.link("WebPage"),t.appNode),!r.noRDFa&&Ue)try{Ue(this.dom,i,r.original.value)}catch(e){let n="Error trying to parse "+r.resource+" as RDFa:\n"+e+":\n"+e.stack;return t.failFetch(r,n,"parse_error")}return t.doneFetch(r,this.response)}}Qe.pattern=new RegExp("application/xhtml");class Ge extends $e{static toString(){return"XMLHandler"}static register(t){t.mediatypes["text/xml"]={q:.5},t.mediatypes["application/xml"]={q:.5}}static isElement(t){return t.nodeType===Node.ELEMENT_NODE}parse(t,e,r){let n=It(e);for(let s=0;s<n.childNodes.length;s++){const i=n.childNodes[s];if(Ge.isElement(i)){let s=i.namespaceURI;if(s&&s===s.rdf)return t.addStatus(r.req,"Has XML root element in the RDF namespace, so assume RDF/XML."),new We(this.response,n).parse(t,e,r);break}}if(n.doctype&&"html"===n.doctype.name&&n.doctype.publicId.match(/^-\/\/W3C\/\/DTD XHTML/)&&n.doctype.systemId.match(/http:\/\/www.w3.org\/TR\/xhtml/))return t.addStatus(r.req,"Has XHTML DOCTYPE. Switching to XHTML Handler.\n"),new Qe(this.response,n).parse(t,e,r);let s=n.getElementsByTagName("html")[0];if(s){let i=s.getAttribute("xmlns");if(i&&i.match(/^http:\/\/www.w3.org\/1999\/xhtml/))return t.addStatus(r.req,"Has a default namespace for XHTML. Switching to XHTMLHandler.\n"),new Qe(this.response,n).parse(t,e,r)}return t.failFetch(r,"Unsupported dialect of XML: not RDF or XHTML namespace, etc.\n"+e.slice(0,80),901)}}Ge.pattern=new RegExp("(text|application)/(.*)xml");class Ye extends $e{static toString(){return"HTMLHandler"}static register(t){t.mediatypes["text/html"]={q:.8}}parse(t,e,r){let n=t.store;if(er(e))return t.addStatus(r.req,"Has an XML declaration. We'll assume it's XHTML as the content-type was text/html.\n"),new Qe(this.response).parse(t,e,r);if(function(t){const e=t.indexOf("<!DOCTYPE html"),r=t.indexOf(">");return!(-1===e||-1===r||e>r)&&-1!==t.substr(e,r-e).indexOf("XHTML")}(e))return t.addStatus(r.req,"Has XHTML DOCTYPE. Switching to XHTMLHandler.\n"),new Qe(this.response).parse(t,e,r);if(function(t){return!!t.match(/[^(<html)]*<html\s+[^<]*xmlns=['"]http:\/\/www.w3.org\/1999\/xhtml["'][^<]*>/)}(e))return t.addStatus(r.req,"Has default namespace for XHTML, so switching to XHTMLHandler.\n"),new Qe(this.response).parse(t,e,r);let s=new RegExp("<title>([\\s\\S]+?)</title>","im").exec(e);return s&&n.add(r.resource,ze.dc("title"),n.rdfFactory.literal(s[1]),r.resource),n.add(r.resource,ze.rdf("type"),ze.link("WebPage"),t.appNode),t.addStatus(r.req,"non-XML HTML document, not parsed for data."),t.doneFetch(r,this.response)}}Ye.pattern=new RegExp("text/html");class Ze extends $e{static toString(){return"JsonLdHandler"}static register(t){t.mediatypes["application/ld+json"]={q:.9}}async parse(t,e,r,n){const s=t.store;try{return await ke(e,s,r.original.value),t.store.add(r.original,ze.rdf("type"),ze.link("RDFDocument"),t.appNode),t.doneFetch(r,n)}catch(e){const s="Error trying to parse "+r.resource+" as JSON-LD:\n"+e;return t.failFetch(r,s,"parse_error",n)}}}Ze.pattern=/application\/(ld\+json|activity\+json)/;class Je extends $e{static toString(){return"TextHandler"}static register(t){t.mediatypes["text/plain"]={q:.5}}parse(t,e,r){return er(e)?(t.addStatus(r.req,"Warning: "+r.resource+" has an XML declaration. We'll assume it's XML but its content-type wasn't XML.\n"),new Ge(this.response).parse(t,e,r)):e.slice(0,500).match(/xmlns:/)?(t.addStatus(r.req,"May have an XML namespace. We'll assume it's XML but its content-type wasn't XML.\n"),new Ge(this.response).parse(t,e,r)):(t.addStatus(r.req,"Plain text document, no known RDF semantics."),t.doneFetch(r,this.response))}}Je.pattern=new RegExp("text/plain");class Ke extends $e{static toString(){return"N3Handler"}static register(t){t.mediatypes["text/n3"]={},t.mediatypes["text/turtle"]={}}parse(t,e,r,n){let s=t.store,i=Ae(s,s,r.original.value,r.original.value,null,null,"",null);try{i.loadBuf(e)}catch(e){let s="Error trying to parse "+r.resource+" as Notation3:\n"+e;return t.failFetch(r,s,"parse_error",n)}return t.addStatus(r.req,"N3 parsed: "+i.statementCount+" triples in "+i.lines+" lines."),t.store.add(r.original,ze.rdf("type"),ze.link("RDFDocument"),t.appNode),t.doneFetch(r,this.response)}}Ke.pattern=new RegExp("(application|text)/(x-)?(rdf\\+)?(n3|turtle)");const tr={RDFXMLHandler:We,XHTMLHandler:Qe,XMLHandler:Ge,HTMLHandler:Ye,TextHandler:Je,N3Handler:Ke,JsonLdHandler:Ze};function er(t){return!!t.match(/\s*<\?xml\s+version\s*=[^<>]+\?>/)}class rr{constructor(t,e={}){n(this,"store",void 0),n(this,"timeout",void 0),n(this,"_fetch",void 0),n(this,"mediatypes",void 0),n(this,"appNode",void 0),n(this,"requested",void 0),n(this,"timeouts",void 0),n(this,"redirectedTo",void 0),n(this,"fetchQueue",void 0),n(this,"fetchCallbacks",void 0),n(this,"nonexistent",void 0),n(this,"lookedUp",void 0),n(this,"handlers",void 0),n(this,"ns",void 0),n(this,"fireCallbacks",void 0),this.store=t||new te,this.ns=Ve(this.store.rdfFactory),this.timeout=e.timeout||3e4;let r=e.fetch||"undefined"!=typeof globalThis&&globalThis.fetch||void 0!==o.g&&(o.g.solidFetcher||o.g.solidFetch||o.g.fetch)||"undefined"!=typeof window&&(window.solidFetcher||window.solidFetch||window.fetch);if(!r)throw new Error("No fetch function available. If using Node.js < 18, install a fetch polyfill.");"undefined"!=typeof window&&r===window.fetch?this._fetch=r.bind(window):void 0!==o.g&&r===o.g.fetch?this._fetch=r.bind(o.g):this._fetch=r,this.appNode=this.store.sym("chrome://TheCurrentSession"),this.store.fetcher=this,this.requested={},this.timeouts={},this.redirectedTo={},this.fetchQueue={},this.fetchCallbacks={},this.nonexistent={},this.lookedUp={},this.handlers=[],this.mediatypes={"image/*":{q:.9},"*/*":{q:.1}},Nt(this,["request","fail","refresh","retract","done"]),Object.keys(e.handlers||tr).map(t=>this.addHandler(tr[t]))}static crossSiteProxy(t){return rr.crossSiteProxyTemplate?rr.crossSiteProxyTemplate.replace("{uri}",encodeURIComponent(t)):void 0}static offlineOverride(t){let e=t;var r;return"undefined"!=typeof window&&window.panes&&(r=window.panes.UI)&&r.preferences&&r.preferences.get("offlineModeUsingLocalhost")&&"http://"===e.slice(0,7)&&"localhost/"!==e.slice(7,17)&&(e="http://localhost/"+e.slice(7),wt.warn("Localhost kludge for offline use: actually getting <"+e+">")),e}static proxyIfNecessary(t){var e;if("undefined"!=typeof window&&window.panes&&(e=window.panes.UI)&&e.isExtension)return t;if("undefined"!=typeof $SolidTestEnvironment&&$SolidTestEnvironment.localSiteMap){let e=t.split("/").slice(2);const r=(t,e)=>{let n=e[t.shift()];return n?"string"==typeof n?n+t.join("/"):t?r(t,n):null:null},n=r(e,$SolidTestEnvironment.localSiteMap);if(n)return n}return rr.crossSiteProxyTemplate&&"undefined"!=typeof document&&document.location&&"https:"===(""+document.location).slice(0,6)&&"http:"===t.slice(0,5)?rr.crossSiteProxyTemplate.replace("{uri}",encodeURIComponent(t)):t}static unsupportedProtocol(t){let e=lt(t);return"tel"===e||"mailto"===e||"urn"===e}static setCredentials(t,e={}){void 0===e.credentials&&(void 0!==e.withCredentials?e.credentials=e.withCredentials?"include":"omit":e.credentials="include")}load(t,e={}){if(e=Object.assign({},e),t instanceof Array)return Promise.all(t.map(t=>this.load(t,Object.assign({},e))));let r=k(t);r=r.split("#")[0],e=this.initFetchOptions(r,e);const n=this.appNode,s=this.store,i=s.statementsMatching(void 0,this.ns.link("requestedURI"),s.sym(r),n).map(t=>t.subject);for(const t of i){const r=s.any(t,this.ns.link("response"),null,n);if(null!=r){const t=s.statementsMatching(r,this.ns.link("outOfDate"),!0,n);s.remove(t),e.force=!0,e.clearPreviousData=!0}}const a=this.initFetchOptions(r,e);return this.pendingFetchPromise(r,a.baseURI,a)}async pendingFetchPromise(t,e,r){let n;return!r.force&&await this.fetchQueue[e]?n=this.fetchQueue[e]:(n=Promise.race([this.setRequestTimeout(t,r),this.fetchUri(t,r)]),this.fetchQueue[e]=n,this.cleanupFetchRequest(e,void 0,this.timeout)),n.then(e=>(t in this.timeouts&&(this.timeouts[t].forEach(clearTimeout),delete this.timeouts[t]),e))}cleanupFetchRequest(t,e,r){void 0!==e&&console.warn("_options is deprecated"),this.timeouts[t]=(this.timeouts[t]||[]).concat(setTimeout(()=>{this.isPending(t)||delete this.fetchQueue[t]},r))}initFetchOptions(t,e){let r=this.store;!e.method||"GET"===e.method.toUpperCase()||(e.force=!0),e.resource=r.rdfFactory.namedNode(t),e.baseURI=e.baseURI||t,e.original=r.rdfFactory.namedNode(e.baseURI),e.req=r.bnode(),e.headers=e.headers||{},e.contentType&&(e.headers["content-type"]=e.contentType),e.force&&(e.cache="no-cache");let n=this.acceptString();e.headers.accept=n;let s=rr.offlineOverride(t);e.requestedURI=s,rr.setCredentials(s,e);let i=rr.proxyIfNecessary(s);return s!==i&&(e.proxyUsed=!0),e.actualProxyURI=i,e}fetchUri(t,e){if(!t)return Promise.reject(new Error("Cannot fetch an empty uri"));if(rr.unsupportedProtocol(t))return this.failFetch(e,"fetcher: Unsupported protocol","unsupported_protocol");let r=this.getState(t);if(e.force)delete this.nonexistent[t];else{if("fetched"===r)return Promise.resolve(this.doneFetch(e,{status:200,ok:!0,statusText:"Already loaded into quadstore."}));if("failed"===r&&404===this.requested[t]){let r="Previously failed: "+this.requested[t],n={url:t,status:this.requested[t],statusText:r,responseText:r,headers:new Headers,ok:!1,body:null,bodyUsed:!1,size:0,timeout:0};return this.failFetch(e,r,this.requested[t],n)}}this.fireCallbacks("request",[t]),this.requested[t]=!0,e.noMeta||this.saveRequestMetadata(t,e);let{actualProxyURI:n}=e;return this._fetch(n,e).then(r=>this.handleResponse(r,t,e),r=>{let s={url:n,status:999,statusText:(r.name||"network failure")+": "+(r.errno||r.code||r.type),responseText:r.message,headers:new Headers,ok:!1,body:null,bodyUsed:!1,size:0,timeout:0};return this.handleError(s,t,e)})}nowOrWhenFetched(t,e,r,n={}){const s=k(t);"function"==typeof e?r=e:void 0===e||(H(e)?n.referringTerm=e:n=e),this.load(s,n).then(t=>{if(r)if(t)if(t.ok)r(!0,"OK",t);else{let e="HTTP error: Status "+t.status+" ("+t.statusText+")";t.responseText&&(e+=" "+t.responseText),r(!1,e,t)}else r(!1,"@@ nowOrWhenFetched:  no response object!")},function(t){var e=t.message||t.statusText;e="Failed to load  <"+s+"> "+e,t.response&&t.response.status&&(e+=" status: "+t.response.status),r(!1,e,t.response)})}addStatus(t,e){let r=new Date;e="["+r.getHours()+":"+r.getMinutes()+":"+r.getSeconds()+"."+r.getMilliseconds()+"] "+e;let n=this.store;const s=n.the(t,this.ns.link("status"));F(s)?s.append(n.rdfFactory.literal(e)):wt.warn("web.js: No list to add to: "+s+","+e)}failFetch(t,e,r,n){this.addStatus(t.req,e),t.noMeta||this.store.add(t.original,this.ns.link("error"),this.store.rdfFactory.literal(e));let s=(t.method||"GET").toUpperCase();("GET"===s||"HEAD"===s)&&(t.resource.equals(t.original),this.requested[it(t.original.value)]=r,this.fireCallbacks("fail",[t.original.value,e]));var i=new Error("Fetcher: "+e);return i.status=r,i.statusText=e,i.response=n,Promise.reject(i)}linkData(t,e,r,n,s){if(!r)return;let i,a=this.store,o=a.rdfFactory.namedNode(ht(r,t.value));if("alternate"===e||"seeAlso"===e||"meta"===e||"describedby"===e){if(o.value===t.value)return;i=this.ns.rdfs("seeAlso")}else i="type"===e?a.rdfFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"):a.rdfFactory.namedNode(ht(encodeURIComponent(e),"http://www.iana.org/assignments/link-relations/"));s?a.add(o,i,t,n):a.add(t,i,o,n)}parseLinkHeader(t,e,r){if(!t)return;const n=/[^\(\)<>@,;:"\/\[\]\?={} \t]+=(([^\(\)<>@,;:"\/\[\]\?={} \t]+)|("[^"]*"))/g,s=t.match(/<[^>]*>\s*(\s*;\s*[^()<>@,;:"/[\]?={} \t]+=(([^\(\)<>@,;:"\/\[\]\?={} \t]+)|("[^"]*")))*(,|$)/g);if(null!=s)for(let t=0;t<s.length;t++){let i=s[t].split(">"),a=i[0].substring(1),o=i[1].match(n);if(null==o)return;for(let t=0;t<o.length;t++){let n=o[t].split("=")[1].replace(/["']/g,"");this.linkData(e,n,a,r)}}}doneFetch(t,e){return this.addStatus(t.req,"Done."),this.requested[t.original.value]="done",this.fireCallbacks("done",[t.original.value]),e.req=t.req,e}nowKnownAs(t,e){this.lookedUp[t.value]?this.lookedUp[e.value]||this.lookUpThing(e,t):this.lookedUp[e.value]&&(this.lookedUp[t.value]||this.lookUpThing(t,e))}putBack(t,e={}){const r=k(t);let n=new W(r).doc();return e.contentType=e["content-type"]||e["Content-Type"]||e.contentType||O,"application/ld+json"===e.contentType?new Promise((r,s)=>{qt(n,this.store,n.uri,e.contentType,(n,i)=>{n?s(n):(e.data=i,this.webOperation("PUT",t,e).then(t=>r(t)).catch(t=>s(t)))})}):(e.data=qt(n,this.store,n.value,e.contentType),this.webOperation("PUT",r,e))}webCopy(t,e,r){return this.webOperation("GET",t).then(t=>this.webOperation("PUT",e,{data:t.responseText,contentType:r}))}delete(t,e){return this.webOperation("DELETE",t,e).then(e=>(this.requested[t]=404,this.nonexistent[t]=!0,this.unload(this.store.rdfFactory.namedNode(t)),e))}async createIfNotExists(t,e=O,r=""){const n=this;try{var s=await n.load(t)}catch(i){if(404===i.response.status){try{s=await n.webOperation("PUT",t.value,{data:r,contentType:e})}catch(t){throw t}return delete n.requested[t.value],s}throw i}return s}createContainer(t,e,r){let n={"content-type":O,link:this.ns.ldp("BasicContainer")+'; rel="type"'};e&&(n.slug=e);let s={headers:n};return r&&(s.body=r),this.webOperation("POST",t,s)}invalidateCache(t){const e=k(t),r=this;if(r.fetchQueue&&r.fetchQueue[e]&&(r.fetchQueue[e].PromiseStatus,delete r.fetchQueue[e]),r.requested[e]&&"done"!==r.requested[e]&&"failed"!==r.requested[e]&&404!==r.requested[e]){let t=`Rdflib: fetcher: Destructive operation on <${r.requested[e]}> file being fetched! `+e;console.error(t)}else delete r.requested[e],delete r.nonexistent[e]}webOperation(t,e,r={}){const n=k(e);r.method=t,r.body=r.data||r.body,r.force=!0;const s=this;if(r.body&&!r.contentType)throw new Error("Web operation sending data must have a defined contentType.");return r.contentType&&(r.headers=r.headers||{},r.headers["content-type"]=r.contentType),rr.setCredentials(n,r),new Promise(function(e,i){s._fetch(n,r).then(r=>{if(r.ok)"PUT"!==t&&"PATCH"!==t&&"POST"!==t&&"DELETE"!==t||s.invalidateCache(n),r.text?r.text().then(t=>{r.responseText=t,e(r)}):e(r);else{let e="Web error: "+r.status;r.statusText&&(e+=" ("+r.statusText+")"),e+=" on "+t+" of <"+n+">",r.responseText&&(e+=": "+r.responseText);let s=new Error(e);s.response=r,i(s)}},e=>{i(new Error("Fetch error for "+t+" of <"+n+">:"+e))})})}lookUpThing(t,e){let r=this.store.uris(t);return r=r.map(t=>it(t)),r.forEach(t=>{this.lookedUp[t]=!0}),this.load(r,{referringTerm:e})}getHeader(t,e){const r=this.store,n=t.value,s=r.each(void 0,this.ns.link("requestedURI"),r.rdfFactory.literal(n));for(let t=0;t<s.length;t++){let n=s[t];if(void 0!==n){let t=r.any(n,this.ns.link("response"));if(void 0!==t&&r.anyValue(t,this.ns.http("status"))&&r.anyValue(t,this.ns.http("status")).startsWith("2")){let n=r.each(t,this.ns.httph(e.toLowerCase()));return n.length?n.map(t=>t.value):[]}}}}saveRequestMetadata(t,e){let r=e.req,n=this.store,s=e.referringTerm;this.addStatus(e.req,"Accept: "+e.headers.accept),H(s)&&n.add(n.rdfFactory.namedNode(t),this.ns.link("requestedBy"),s,this.appNode),e.original&&e.original.value!==t&&n.add(r,this.ns.link("orginalURI"),n.rdfFactory.literal(e.original.value),this.appNode);const i=new Date,a="["+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds()+"] ";n.add(r,this.ns.rdfs("label"),n.rdfFactory.literal(a+" Request for "+t),this.appNode),n.add(r,this.ns.link("requestedURI"),n.rdfFactory.literal(t),this.appNode),n.add(r,this.ns.link("status"),n.collection(),this.appNode)}saveResponseMetadata(t,e){const r=this.store;let n=r.bnode();return r.add(e.req,this.ns.link("response"),n,this.appNode),r.add(n,this.ns.http("status"),r.rdfFactory.literal(t.status),this.appNode),r.add(n,this.ns.http("statusText"),r.rdfFactory.literal(t.statusText),this.appNode),t.headers.forEach((t,s)=>{r.add(n,this.ns.httph(s),this.store.rdfFactory.literal(t),this.appNode),"content-type"===s&&r.add(e.resource,this.ns.rdf("type"),r.rdfFactory.namedNode(Tt(t).value),this.appNode)}),n}objectRefresh(t){let e=this.store.uris(t);if(void 0!==e)for(let t=0;t<e.length;t++)this.refresh(this.store.rdfFactory.namedNode(it(e[t])))}refresh(t,e){this.fireCallbacks("refresh",arguments),this.nowOrWhenFetched(t,{force:!0,clearPreviousData:!0},e)}refreshIfExpired(t,e){let r=this.getHeader(t,"Expires");!r||new Date(r[0]).getTime()<=(new Date).getTime()?this.refresh(t,e):e(!0,"Not expired",{})}retract(t){this.store.removeMany(void 0,void 0,void 0,t),t.value&&delete this.requested[it(t.value)],this.fireCallbacks("retract",arguments)}getState(t){return void 0===this.requested[t]?"unrequested":!0===this.requested[t]?"requested":"done"===this.requested[t]?"fetched":"redirected"===this.requested[t]?this.getState(this.redirectedTo[t]):"failed"}isPending(t){return!0===this.requested[t]}unload(t){this.store.removeDocument(t),delete this.requested[t.value]}addHandler(t){this.handlers.push(t),t.register(this)}retryNoCredentials(t,e){e.retriedWithNoCredentials=!0,delete this.requested[t],delete this.fetchQueue[t];let r=Object.assign({},e,{credentials:"omit"});return this.addStatus(e.req,"Abort: Will retry with credentials SUPPRESSED to see if that helps"),this.load(t,r)}isCrossSite(t){if("undefined"==typeof document||!document.location)return!1;const e=ot,r=""+document.location;return(e(r)&&e(t)&&e(r))!==e(t)}handleError(t,e,r){if(this.isCrossSite(e)){if(r.credentials&&"include"===r.credentials&&!r.retriedWithNoCredentials)return this.retryNoCredentials(e,r);let t=rr.crossSiteProxy(e);if(t&&!r.proxyUsed)return this.redirectToProxy(t,r)}var n;return t instanceof Error?n="Fetch error: "+t.message:(n=t.statusText,t.responseText&&(n+=` ${t.responseText}`)),this.failFetch(r,n,t.status||998,t)}addType(t,e,r,n){let s=e;if(n){var i=r.any(s,this.ns.link("requestedURI"));i&&i.value!==n&&r.add(r.rdfFactory.namedNode(n),this.ns.rdf("type"),t,this.appNode)}for(;;){const e=r.any(s,this.ns.link("requestedURI"));if(e&&e.value&&r.add(r.rdfFactory.namedNode(e.value),this.ns.rdf("type"),t,this.appNode),s=r.any(void 0,r.rdfFactory.namedNode("http://www.w3.org/2007/ont/link#redirectedRequest"),s),!s)break;var a=r.any(s,r.rdfFactory.namedNode("http://www.w3.org/2007/ont/link#response"));if(!a)break;var o=r.any(a,r.rdfFactory.namedNode("http://www.w3.org/2007/ont/http#status"));if(!o)break;if("301"!==o&&"302"!==o)break}}handleResponse(t,e,r){const n=this.store,s=t.headers,i=r.req,a=this.saveResponseMetadata(t,r),o=this.normalizedContentType(r,s)||"";let h=s.get("content-location");if(0===t.status)return this.handleError(t,e,r);if(t.status>=400)return 404===t.status&&(this.nonexistent[r.original.value]=!0,this.nonexistent[e]=!0),this.saveErrorResponse(t,a).then(()=>{let e=r.resource+" "+t.statusText;return this.failFetch(r,e,t.status,t)});var l=null,c=null;if(h&&(c=ht(h,e))!==e&&(l=c),200===t.status){if(this.addType(this.ns.link("Document"),i,n,e),l&&this.addType(this.ns.link("Document"),i,n,l),r.clearPreviousData){const t=n.statementsMatching(void 0,void 0,void 0,r.resource).slice();for(let e=0;e<t.length;e++)n.removeStatement(t[e])}let t=o.includes("image/")||o.includes("application/pdf");o&&t&&(this.addType(n.rdfFactory.namedNode("http://purl.org/dc/terms/Image"),i,n,e),l&&this.addType(n.rdfFactory.namedNode("http://purl.org/dc/terms/Image"),i,n,l))}if(h){if(!r.force&&l&&"done"===this.requested[c])return this.doneFetch(r,t);this.requested[c]=!0}this.parseLinkHeader(s.get("link"),r.original,i);let u=this.handlerForContentType(o,t);return u?t.text().then(e=>(t.responseText=e,u.parse(this,e,r,t))):(this.addStatus(i,"Fetch over. No data handled."),this.doneFetch(r,t))}saveErrorResponse(t,e){let r=this.store;return t.text().then(t=>{t.length>10&&r.add(e,this.ns.http("content"),r.rdfFactory.literal(t),e)})}handlerForContentType(t,e){if(!t)return null;let r=this.handlers.find(e=>t.match(e.pattern));return r?new r(e):null}guessContentType(t){return Be[t.split(".").pop()]}normalizedContentType(t,e){if(t.forceContentType)return t.forceContentType;let r=e.get("content-type");if(!r||r.includes("application/octet-stream")){let e=this.guessContentType(t.resource.value);if(e)return e}let n=lt(t.resource.value);return!r&&["file","chrome"].includes(n)?"text/xml":r}redirectToProxy(t,e){this.addStatus(e.req,"BLOCKED -> Cross-site Proxy to <"+t+">"),e.proxyUsed=!0;const r=this.store,n=e.req;e.noMeta||(r.add(n,this.ns.link("redirectedTo"),r.rdfFactory.namedNode(t),n),this.addStatus(n,"redirected to new request")),this.requested[e.resource.value]="redirected",this.redirectedTo[e.resource.value]=t;let s=Object.assign({},e);return s.baseURI=e.resource.value,this.fetchUri(t,s).then(t=>(s.noMeta||r.add(n,this.ns.link("redirectedRequest"),s.req,this.appNode),t))}setRequestTimeout(t,e){return new Promise(r=>{this.timeouts[t]=(this.timeouts[t]||[]).concat(setTimeout(()=>{!this.isPending(t)||e.retriedWithNoCredentials||e.proxyUsed||r(this.failFetch(e,`Request to ${t} timed out`,"timeout"))},this.timeout))})}addFetchCallback(t,e){this.fetchCallbacks[t]?this.fetchCallbacks[t].push(e):this.fetchCallbacks[t]=[e]}acceptString(){let t="";for(let e in this.mediatypes){""!==t&&(t+=", "),t+=e;for(let r in this.mediatypes[e])t+=";"+r+"="+this.mediatypes[e][r]}return t}}n(rr,"HANDLERS",void 0),n(rr,"CONTENT_TYPE_BY_EXT",void 0),n(rr,"crossSiteProxyTemplate",void 0),rr.HANDLERS=tr,rr.CONTENT_TYPE_BY_EXT=Be;const nr={parseJSON:function(t,e,r){var n,s,i,a={},o=r.sym(e);for(var h in t){0===h.indexOf("_:")?a[h]?n=a[h]:(n=r.bnode(h),a[h]=n):n=r.sym(h);var l=t[h];for(var c in l){var u=l[c];for(var d in s=r.sym(c),u){var f=u[d];if("uri"===f.type)i=r.sym(f.value),r.add(n,s,i,o);else if("BlankNode"===f.type)a[f.value]?i=a[f.value]:(i=r.bnode(f.value),a[f.value]=i),r.add(n,s,i,o);else{if("Literal"!==f.type)throw new Error("error: unexpected termtype: "+d.type);i=f.datatype?r.literal(f.value,void 0,r.sym(f.datatype)):f.lang?r.literal(f.value,f.lang):r.literal(f.value),r.add(n,s,i,o)}}}}}};function sr(t){var e=0;function r(t){var e="",r=t.statements;for(var n in r)wt.debug("Found statement: "+r),e+=a()+r[n]+"\n";return e}function n(t){var e="";for(var r in t.constraints){var n=t.constraints[r];e+=a()+"FILTER ( "+n.describe(r)+" ) \n"}return e}function s(t){for(var i="",o=0;o<t.optional.length;o++)wt.debug("Found optional query"),i+=a()+"OPTIONAL { \n",e++,i+=r(t.optional[o]),i+=n(t.optional[o]),i+=s(t.optional[o]),e--,i+=a()+"}\n";return i}function i(t){var i=a()+"WHERE \n{ \n";return e++,i+=r(t),i+=n(t),i+=s(t),e--,i+"}"}function a(){for(var t="",r=0;r<e;r++)t+="    ";return t}return function(t){return function(t){for(var e=a()+"SELECT ",r=0;r<t.vars.length;r++)e+=t.vars[r]+" ";return e+"\n"}(t)+i(t.pat)}(t)}function ir(t,e,r){var n=[];function s(t){if(n[t])return n[t];var e=r.variable(t);return n[t]=e,e}function i(t){return"string"==typeof t&&t.match(/[^ \n\t]/)}function a(t){return"string"==typeof t&&t.match(/^[\?\$]/)}function o(t){return"string"==typeof t?t.replace(/^&lt;/,"<").replace(/&gt;$/,">"):t}function h(t){return"string"==typeof t&&t.match(/^<[^>]*>$/)}function l(t){return"string"==typeof t&&(t.match(/^_:/)||t.match(/^$/))}function c(t){return"string"==typeof t&&t.match(/:$/)}function u(t){return"string"==typeof t&&t.match(/^:|^[^_][^:]*:/)}function d(t){return t.split(":")[0]}function f(t){return t.split(":")[1]}function p(t){return h(t)?t.slice(1,t.length-1):t}function m(t){var e=-1===t.indexOf("'")?null:t.indexOf("'"),n=-1===t.indexOf('"')?null:t.indexOf('"');if(!e&&!n){var s=new Array(1);return s[0]=t,s}var i,a,o=new Array(2);if(!e||n&&n<e)i='"',a=n;else{if(n&&!(e&&e<n))return wt.error("SQARQL QUERY OOPS!"),o;i="'",a=e}o[0]=t.slice(0,a);var h,l=t.slice(a+1).indexOf(i);return-1===l?(wt.error("SPARQL parsing error: no matching parentheses in literal "+t),t):(t.slice(l+a+2).match(/^\^\^/)?(h=t.slice(l+a+2).indexOf(" "),o[1]=r.literal(t.slice(a+1,a+1+l),r.sym(p(t.slice(a+4+l,a+2+l+h)))),o=o.concat(m(t.slice(l+a+3+h)))):t.slice(l+a+2).match(/^@/)?(h=t.slice(l+a+2).indexOf(" "),o[1]=r.literal(t.slice(a+1,a+1+l),t.slice(a+3+l,a+2+l+h),null),o=o.concat(m(t.slice(l+a+2+h)))):(o[1]=r.literal(t.slice(a+1,a+1+l)),wt.info("Literal found: "+o[1]),o=o.concat(m(t.slice(l+a+2)))),o)}function w(t){t=t.replace(/\(/g," ( ").replace(/\)/g," ) ").replace(/</g," <").replace(/>/g,"> ").replace(/{/g," { ").replace(/}/g," } ").replace(/[\t\n\r]/g," ").replace(/; /g," ; ").replace(/\. /g," . ").replace(/, /g," , "),wt.info("New str into spaceDelimit: \n"+t);var e=[],r=t.split(" ");for(var n in r)i(r[n])&&(e=e.concat(r[n]));return e}function g(t,e){for(var r=0;r<e.length;r++)if("string"==typeof e[r]&&e[r].toLowerCase()===t.toLowerCase())return r;return null}function v(t,e){for(var r=[],n=0;n<e.length;n++)"string"==typeof e[n]&&e[n].toLowerCase()===t.toLowerCase()&&r.push(n);return r}function b(t,e,r){wt.info("Looking for a close bracket of type "+r+" in "+t);for(var n=0,s=0;s<t.length;s++)if(t[s]===e&&n++,t[s]===r&&n--,n<0)return s;return wt.error("Statement had no close parenthesis in SPARQL query"),0}function y(t){return this.describe=function(e){return e+" = "+t.toNT()},this.test=function(e){return t.equals(e)},this}function T(t){this.describe=function(e){return"REGEXP( '"+t+"' , "+e+" )"},this.test=function(e){var r=new RegExp(t);return!!e.value&&r.test(e.value)}}function x(t,e){3!==t.length||"Variable"!==t[0].termType||"NamedNode"!==t[2].termType&&"Literal"!==t[2].termType?6===t.length&&"string"==typeof t[0]&&"regexp"===t[0].toLowerCase()&&"("===t[1]&&")"===t[5]&&","===t[3]&&"Variable"===t[4].termType&&"Literal"===t[2].termType&&(wt.debug("Constraint added: "+t),e.constraints[t[4]]=new T(t[2].value)):"="===t[1]||">"===t[1]||"<"===t[1]?(wt.debug("Constraint added: "+t),e.constraints[t[0]]=new y(t[2])):wt.warn("I don't know how to handle the constraint: "+t)}function N(t,e){wt.debug("Optional query: "+t+" not yet implemented.");var n=r.formula();A(t,n),e.optional.push(n)}function A(t,e){var n,i,c=function(t){for(var e=[],n=0;n<t.length;n++)"string"==typeof t[n]?(t[n]=o(t[n]),a(t[n])?e[n]=s(t[n].slice(1)):l(t[n])?(wt.info(t[n]+" was identified as a bnode."),e[n]=r.bnode()):h(t[n])?(wt.info(t[n]+" was identified as a symbol."),e[n]=r.sym(p(t[n]))):u(t[n])?(wt.info(t[n]+" was identified as a prefixed symbol"),E[d(t[n])]?e[n]=r.sym(t[n]=E[d(t[n])]+f(t[n])):(wt.error("SPARQL error: "+t[n]+" with prefix "+d(t[n])+" does not have a correct prefix entry."),e[n]=t[n])):e[n]=t[n]):e[n]=t[n];return e}(t);for(wt.debug("WHERE: "+c);g("OPTIONAL",c);)i=g("OPTIONAL",c),wt.debug("OPT: "+i+" "+c[i]+" in "+c),"{"!==c[i+1]&&wt.warn("Bad optional opening bracket in word "+i),-1===(n=b(c.slice(i+2),"{","}"))?wt.error("No matching bracket in word "+i):(N(c.slice(i+2,i+2+n),e),i=g("OPTIONAL",c),n=b(c.slice(i+2),"{","}"),c.splice(i,n+3));for(wt.debug("WHERE after optionals: "+c);g("FILTER",c);){var m=g("FILTER",c);"("!==c[m+1]&&wt.warn("Bad filter opening bracket in word "+m),-1===(n=b(c.slice(m+2),"(",")"))?wt.error("No matching bracket in word "+m):(x(c.slice(m+2,m+2+n),e),m=g("FILTER",c),n=b(c.slice(m+2),"(",")"),c.splice(m,n+3))}wt.debug("WHERE after filters and optionals: "+c),function(t,e){var r=new Array(1);r[0]=-1;for(var n=r.concat(v(".",t)),s=[],i=0;i<n.length-1;i++)s[i]=t.slice(n[i]+1,n[i+1]);for(i in s){wt.info("s+p+o "+i+" = "+s[i]);var a=s[i][0];s[i].splice(0,1);var o=r.concat(v(";",s[i]));o.push(s[i].length);for(var h=[],l=0;l<o.length-1;l++)h[l]=s[i].slice(o[l]+1,o[l+1]);for(i in h){wt.info("p+o "+i+" = "+s[i]);var c=h[i][0];h[i].splice(0,1);var u=r.concat(v(",",h[i]));u.push(h[i].length);var d=[];for(l=0;l<u.length-1;l++)d[l]=h[i].slice(u[l]+1,u[l+1]);for(i in d){var f=d[i][0];wt.info("Subj="+a+" Pred="+c+" Obj="+f),e.add(a,c,f)}}}}(c,e)}wt.info("SPARQL input: \n"+t);var C=new Qt,O=function(t){var e=m(t),r=[];for(var n in e)r="string"==typeof e[n]?r.concat(w(e[n])):r.concat(e[n]);return r=function(t){for(var e=t,r=0;r<e.length;r++)if("a"===e[r]&&(e[r]="<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>"),"is"===e[r]&&"of"===e[r+2]){e.splice(r,1),e.splice(r+1,1);var n=e[r-1];e[r-1]=e[r+1],e[r+1]=n}return e}(r),wt.info("SPARQL Tokens: "+r),r}(t),E=function(t){var e=v("PREFIX",t),r=[];for(var n in e){var s=t[e[n]+1],i=t[e[n]+2];if(c(s))if(h(i)){wt.info("Prefix found: "+s+" -> "+i);var a=d(s),o=p(i);r[a]=o}else wt.error("Invalid SPARQL symbol: "+i);else wt.error("Invalid SPARQL prefix: "+s)}return r}(O);E.rdf||(E.rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"),E.rdfs||(E.rdfs="http://www.w3.org/2000/01/rdf-schema#");var R=g("SELECT",O),S=g("WHERE",O);if(R<0||S<0||R>S)return wt.error("Invalid or nonexistent SELECT and WHERE tags in SPARQL query"),!1;if(function(t,e){for(var r in wt.info("SPARQL vars: "+t),t)if(a(t[r])){wt.info("Added "+t[r]+" to query variables from SPARQL");var n=s(t[r].slice(1));e.vars.push(n),n.label=t[r].slice(1)}else wt.warn("Incorrect SPARQL variable in SELECT: "+t[r])}(O.slice(R+1,S),C),A(O.slice(S+2,O.length-1),C.pat),e)return C;for(var k in C.pat.statements){var j=C.pat.statements[k];"NamedNode"===j.subject.termType&&r.fetcher&&r.fetcher.lookUpThing(j.subject,"sparql:"+j.subject),"NamedNode"===j.object.termType&&r.fetcher&&r.fetcher.lookUpThing(j.object,"sparql:"+j.object)}return C}class ar{constructor(t){if(n(this,"store",void 0),n(this,"ifps",void 0),n(this,"fps",void 0),n(this,"patchControl",void 0),n(this,"ns",void 0),(t=t||new te).updater)throw new Error("You can't have two UpdateManagers for the same store");t.fetcher||(t.fetcher=new rr(t)),this.store=t,t.updater=this,this.ifps={},this.fps={},this.ns={},this.ns.link=gt("http://www.w3.org/2007/ont/link#"),this.ns.http=gt("http://www.w3.org/2007/ont/http#"),this.ns.httph=gt("http://www.w3.org/2007/ont/httph#"),this.ns.ldp=gt("http://www.w3.org/ns/ldp#"),this.ns.rdf=gt("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),this.ns.rdfs=gt("http://www.w3.org/2000/01/rdf-schema#"),this.ns.rdf=gt("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),this.ns.owl=gt("http://www.w3.org/2002/07/owl#"),this.patchControl=[]}patchControlFor(t){return this.patchControl[t.value]||(this.patchControl[t.value]=[]),this.patchControl[t.value]}isHttpUri(t){return"http"===t.slice(0,4)}flagAuthorizationMetadata(t){t||(t=this.store);const e=t.fetcher?.appNode,r=t.statementsMatching(void 0,this.ns.link("requestedURI"),void 0,e).map(t=>t.subject);for(const n of r){const r=t.any(n,this.ns.link("response"),null,e);null!=r&&t.add(r,this.ns.link("outOfDate"),!0,e)}}async checkEditable(t,e){if(!t)return!1;e||(e=this.store);const r=this.editable(t,e);return void 0!==r?r:(await(e.fetcher?.load(t)),this.editable(t,e))}editable(t,e){if(!t)return!1;if(e||(e=this.store),t=k(t),!this.isHttpUri(t)&&e.holds(e.rdfFactory.namedNode(t),e.rdfFactory.namedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),e.rdfFactory.namedNode("http://www.w3.org/2007/ont/link#MachineEditableDocument")))return"LOCALFILE";var r,n=!1;const s=e.fetcher?.appNode;for(var i,a=e.each(void 0,this.ns.link("requestedURI"),it(t),s),o=0;o<a.length;o++)if(void 0!==(r=a[o])){const a=e.any(r,this.ns.link("response"),null,s);if(void 0!==a){if(e.anyJS(a,this.ns.link("outOfDate"),null,s))continue;var h=e.anyValue(a,this.ns.httph("wac-allow"));if(h)for(var l of h.split(",")){var c=l.split("=");if(c[0].includes("user")&&!c[1].includes("write")&&!c[1].includes("append"))return!1}var u=e.each(a,this.ns.httph("accept-patch"));if(u.length)for(let t=0;t<u.length;t++){if((i=u[t].value.trim()).indexOf("application/sparql-update")>=0)return"SPARQL";if(i.indexOf("application/sparql-update-single-match")>=0)return"SPARQL";if(i.indexOf("text/n3")>=0)return"N3PATCH"}var d=e.each(a,this.ns.httph("ms-author-via"));if(d.length)for(let t=0;t<d.length;t++){if((i=d[t].value.trim()).indexOf("SPARQL")>=0)return"SPARQL";if(i.indexOf("DAV")>=0)return"DAV"}if(!this.isHttpUri(t))return!!h&&"LOCALFILE";var f=e.each(a,this.ns.http("status"));if(f.length)for(let t=0;t<f.length;t++)200!==f[t]&&404!==f[t]||(n=!0)}}if(0===a.length);else if(n)return!1}anonymize(t){return"_:"===t.toNT().substr(0,2)&&this.mentioned(t)?"?"+t.toNT().substr(2):t.toNT()}anonymizeNT(t){return this.anonymize(t.subject)+" "+this.anonymize(t.predicate)+" "+this.anonymize(t.object)+" ."}nTriples(t){return`${t.subject.toNT()} ${t.predicate.toNT()} ${t.object.toNT()} .`}statementBnodes(t){return[t.subject,t.predicate,t.object].filter(function(t){return X(t)})}statementArrayBnodes(t){var e=[];for(let r=0;r<t.length;r++)e=e.concat(this.statementBnodes(t[r]));e.sort();var r=[];for(let t=0;t<e.length;t++)0!==t&&e[t].equals(e[t-1])||r.push(e[t]);return r}cacheIfps(){this.ifps={};var t=this.store.each(void 0,this.ns.rdf("type"),this.ns.owl("InverseFunctionalProperty"));for(let e=0;e<t.length;e++)this.ifps[t[e].value]=!0;this.fps={},t=this.store.each(void 0,this.ns.rdf("type"),this.ns.owl("FunctionalProperty"));for(let e=0;e<t.length;e++)this.fps[t[e].value]=!0}bnodeContext2(t,e,r){var n,s,i=this.store.statementsMatching(void 0,void 0,t,e);for(let t=0;t<i.length;t++)if(this.fps[i[t].predicate.value]){if(!(n=i[t].subject).isBlank)return[i[t]];if(r&&(s=this.bnodeContext2(n,e,r-1)))return s.concat([i[t]])}i=this.store.statementsMatching(t,void 0,void 0,e);for(let t=0;t<i.length;t++)if(this.ifps[i[t].predicate.value]){if(!(n=i[t].object).isBlank)return[i[t]];if(r&&(s=this.bnodeContext2(n,e,r-1)))return s.concat([i[t]])}return null}bnodeContext1(t,e){for(var r=0;r<3;r++){var n=this.bnodeContext2(t,e,r);if(null!==n)return n}return this.store.connectedStatements(t,e)}mentioned(t){return 0!==this.store.statementsMatching(t,null,null,null).length||0!==this.store.statementsMatching(null,t).length||0!==this.store.statementsMatching(null,null,t).length}bnodeContext(t,e){var r=[];if(t.length){this.cacheIfps();for(let s=0;s<t.length;s++){var n=t[s];this.mentioned(n)&&(r=r.concat(this.bnodeContext1(n,e)))}}return r}statementContext(t){var e=this.statementBnodes(t);return this.bnodeContext(e,t.graph)}contextWhere(t){var e=this;return t&&0!==t.length?"WHERE { "+t.map(function(t){return e.anonymizeNT(t)}).join("\n")+" }\n":""}fire(t,e,r,n={}){return Promise.resolve().then(()=>{if(!t)throw new Error("No URI given for remote editing operation: "+e);return n.noMeta=!0,n.contentType=n.contentType||"application/sparql-update",n.body=e,this.store.fetcher.webOperation("PATCH",t,n)}).then(n=>{if(!n.ok){let r="UpdateManager: update failed for <"+t+"> status="+n.status+", "+n.statusText+"\n   for query: "+e;throw new Error(r)}r(t,n.ok,n.responseText,n)}).catch(e=>{r(t,!1,e.message,e)})}update_statement(t){if(!t||t.graph){var e=this,r=this.statementContext(t);return{statement:t?[t.subject,t.predicate,t.object,t.graph]:void 0,statementNT:t?this.anonymizeNT(t):void 0,where:e.contextWhere(r),set_object:function(t,r){var n=this.where;n+="DELETE DATA { "+this.statementNT+" } ;\n",n+="INSERT DATA { "+this.anonymize(this.statement[0])+" "+this.anonymize(this.statement[1])+" "+this.anonymize(t)+"  . }\n",e.fire(this.statement[3].value,n,r)}}}}insert_statement(t,e){var r=t instanceof Array?t[0]:t,n=this.contextWhere(this.statementContext(r));if(t instanceof Array){var s="";for(let e=0;e<t.length;e++)s+=t[e]+"\n";n+="INSERT DATA { "+s+" }\n"}else n+="INSERT DATA { "+this.anonymize(t.subject)+" "+this.anonymize(t.predicate)+" "+this.anonymize(t.object)+"  . }\n";this.fire(r.graph.value,n,e)}delete_statement(t,e){var r=t instanceof Array?t[0]:t,n=this.contextWhere(this.statementContext(r));if(t instanceof Array){var s="";for(let e=0;e<t.length;e++)s+=t[e]+"\n";n+="DELETE DATA { "+s+" }\n"}else n+="DELETE DATA { "+this.anonymize(t.subject)+" "+this.anonymize(t.predicate)+" "+this.anonymize(t.object)+"  . }\n";this.fire(r.graph.value,n,e)}requestDownstreamAction(t,e){var r=this.patchControlFor(t);if(r.pendingUpstream)if(r.downstreamAction){if(""+r.downstreamAction!=""+e)throw new Error("Can't wait for > 1 different downstream actions")}else r.downstreamAction=e;else e(t)}clearUpstreamCount(t){this.patchControlFor(t).upstreamCount=0}getUpdatesVia(t){var e=this.store.fetcher.getHeader(t,"updates-via");return e&&e.length?e[0].trim():null}addDownstreamChangeListener(t,e){var r=this.patchControlFor(t);r.downstreamChangeListeners||(r.downstreamChangeListeners=[]),r.downstreamChangeListeners.push(e),this.setRefreshHandler(t,t=>{this.reloadAndSync(t)})}reloadAndSync(t){var e=this.patchControlFor(t),r=this;if(e.reloading)e.outOfDate=!0;else{e.reloading=!0;var n=1e3,s=function(){r.reload(r.store,t,function(t,r,i){if(t){if(e.downstreamChangeListeners)for(let t=0;t<e.downstreamChangeListeners.length;t++)e.downstreamChangeListeners[t]();e.reloading=!1,e.outOfDate&&(e.outOfDate=!1,s())}else e.reloading=!1,i&&0===i.status&&(e.reloading=!0,setTimeout(s,n*=2))})};s()}}setRefreshHandler(t,e){let r=this.getUpdatesVia(t);var n=e,s=this,i=this,a=1500,o=0;if(!r)return!1;r=ht(r,t.value);const h=r.replace(/^http:/,"ws:").replace(/^https:/,"wss:");var l=function(){var e;if("undefined"!=typeof WebSocket)e=new WebSocket(h);else{if("undefined"==typeof window||!window.WebSocket)return;e=window.WebSocket(h)}e.onopen=function(){a=1500,this.send("sub "+t.value),o&&i.requestDownstreamAction(t,n)};var r=s.patchControlFor(t);r.upstreamCount=0,e.onerror=function(t){},e.onclose=function(t){a*=2,o+=1,setTimeout(function(){l()},a)},e.onmessage=function(e){if(e.data&&"pub"===e.data.slice(0,3)){if("upstreamCount"in r&&(r.upstreamCount-=1,r.upstreamCount>=0))return;r.upstreamCount=0,s.requestDownstreamAction(t,n)}}};return l(),!0}updateMany(t,e=[]){const r=t.concat(e).map(t=>t.why),n=this,s=[];r.forEach(t=>{s.find(e=>e.equals(t))||s.push(t)});const i=s.map(r=>n.update(t.filter(t=>t.why.equals(r)),e.filter(t=>t.why.equals(r))));return i.length,Promise.all(i)}constructSparqlUpdateQuery(t,e,r){var n=this.contextWhere(r),s="";if(n.length){if(t.length){s+="DELETE { ";for(let e=0;e<t.length;e++)s+=this.anonymizeNT(t[e])+"\n";s+=" }\n"}if(e.length){s+="INSERT { ";for(let t=0;t<e.length;t++)s+=this.anonymizeNT(e[t])+"\n";s+=" }\n"}s+=n}else{if(t.length){s+="DELETE DATA { ";for(let e=0;e<t.length;e++)s+=this.anonymizeNT(t[e])+"\n";s+=" } \n"}if(e.length){t.length&&(s+=" ; "),s+="INSERT DATA { ";for(let t=0;t<e.length;t++)s+=this.nTriples(e[t])+"\n";s+=" }\n"}}return s}constructN3PatchQuery(t,e,r){var n="\n@prefix solid: <http://www.w3.org/ns/solid/terms#>.\n@prefix ex: <http://www.example.org/terms#>.\n\n_:patch\n";return r&&r.length>0&&(n+=`\n      solid:where {\n        ${r.map(t=>this.anonymizeNT(t)).join("\n        ")}\n      };`),t.length>0&&(n+=`\n      solid:deletes {\n        ${t.map(t=>this.anonymizeNT(t)).join("\n        ")}\n      };`),e.length>0&&(n+=`\n      solid:inserts {\n        ${e.map(t=>this.anonymizeNT(t)).join("\n        ")}\n      };`),n+"   a solid:InsertDeletePatch .\n"}update(t,e,r,n,s={}){if(!r){var i=this;return new Promise(function(r,a){i.update(t,e,function(t,e,n){e?r():a(new Error(n))},n,s)})}try{var a=this.store,o=t?I(t)?t.statements:t instanceof Array?t:[t]:[],h=e?I(e)?e.statements:e instanceof Array?e:[e]:[];if(!(o instanceof Array))throw new Error("Type Error "+typeof o+": "+o);if(!(h instanceof Array))throw new Error("Type Error "+typeof h+": "+h);if(0===o.length&&0===h.length)return r(null,!0);var l=o.length?o[0].graph:h[0].graph;if(!l){let t="Error patching: statement does not specify which document to patch:"+o[0]+", "+h[0];throw new Error(t)}if("NamedNode"!==l.termType){let t="Error patching: document not a NamedNode:"+o[0]+", "+h[0];throw new Error(t)}var c=this.patchControlFor(l),u=Date.now(),d=["subject","predicate","object","why"],f={delete:o,insert:h};["insert","delete"].map(function(t){f[t].map(function(t){if(!l.equals(t.graph))throw new Error("update: destination "+l+" inconsistent with delete quad "+t.graph);d.map(function(e){if(void 0===t[e])throw new Error("update: undefined "+e+" of statement.")})})});var p=this.editable(l.value,a);if(!1===p)throw new Error("Update: Can't make changes in uneditable "+l);if(void 0===p){if(n)throw new Error("Update: Loaded "+l+"but still can't figure out what editing protocol it supports.");return void this.store.fetcher.load(l).then(n=>{this.update(t,e,r,!0,s)},n=>{if(404!==n.response.status)throw new Error(`Update: Can't get updatability status ${l} before patching: ${n}`);this.update(t,e,r,!0,s)})}if(p.indexOf("SPARQL")>=0||p.indexOf("N3PATCH")>=0){var m=p.indexOf("SPARQL")>=0,w=[];o.length&&(w=this.statementArrayBnodes(o)),h.length&&(w=w.concat(this.statementArrayBnodes(h)));var g=this.bnodeContext(w,l),v=m?this.constructSparqlUpdateQuery(o,h,g):this.constructN3PatchQuery(o,h,g);s.contentType=m?"application/sparql-update":"text/n3",c.pendingUpstream=c.pendingUpstream?c.pendingUpstream+1:1,"upstreamCount"in c&&(c.upstreamCount+=1),this.fire(l.value,v,(t,e,n,s)=>{if(s.elapsedTimeMs=Date.now()-u,e){try{a.remove(o)}catch(t){e=!1,n="Remote Ok BUT error deleting "+o.length+" from store!!! "+t}for(let t=0;t<h.length;t++)a.add(h[t].subject,h[t].predicate,h[t].object,l)}if(r(t,e,n,s),c.pendingUpstream-=1,0===c.pendingUpstream&&c.downstreamAction){var i=c.downstreamAction;delete c.downstreamAction,i(l)}},s)}else if(p.indexOf("DAV")>=0)this.updateDav(l,o,h,r,s);else{if(!(p.indexOf("LOCALFILE")>=0))throw new Error("Unhandled edit method: '"+p+"' for "+l);try{this.updateLocalFile(l,o,h,r,s)}catch(t){r(l.value,!1,"Exception trying to write back file <"+l.value+">\n")}}}catch(t){r(void 0,!1,"Exception in update: "+t+"\n"+Mt(t))}}updateDav(t,e,r,n,s={}){let i=this.store;var a=i.any(t,this.ns.link("request"));if(!a)throw new Error("No record of our HTTP GET request for document: "+t);var o=i.any(a,this.ns.link("response"));if(!o)return null;var h=i.the(o,this.ns.httph("content-type")).value;let l=i.statementsMatching(void 0,void 0,void 0,t).slice();for(let t=0;t<e.length;t++)Ft(l,e[t]);for(let t=0;t<r.length;t++)l.push(r[t]);const c=this.serialize(t.value,l,h);var u,d=i.the(o,this.ns.httph("content-location"));return d&&(u=ht(d.value,u)),s.contentType=h,s.noMeta=!0,s.body=c,i.fetcher.webOperation("PUT",u,s).then(s=>{if(!s.ok)throw new Error(s.error);for(let t=0;t<e.length;t++)i.remove(e[t]);for(let e=0;e<r.length;e++)i.add(r[e].subject,r[e].predicate,r[e].object,t);n(t.value,s.ok,s.responseText,s)}).catch(e=>{n(t.value,!1,e.message,e)})}updateLocalFile(t,e,r,n,s={}){const i=this.store;let a=i.statementsMatching(void 0,void 0,void 0,t).slice();for(let t=0;t<e.length;t++)Ft(a,e[t]);for(let t=0;t<r.length;t++)a.push(r[t]);var o=t.value.lastIndexOf(".");if(o<1)throw new Error("Rewriting file: No filename extension: "+t.value);var h=t.value.slice(o+1);let l=rr.CONTENT_TYPE_BY_EXT[h];if(!l)throw new Error("File extension ."+h+" not supported for data write");s.body=this.serialize(t.value,a,l),s.contentType=l,i.fetcher.webOperation("PUT",t.value,s).then(s=>{if(!s.ok)return n(t.value,!1,s.error);for(let t=0;t<e.length;t++)i.remove(e[t]);for(let e=0;e<r.length;e++)i.add(r[e].subject,r[e].predicate,r[e].object,t);n(t.value,!0,"")})}serialize(t,e,r){const n=this.store;let s;if("string"==typeof e)return e;var i=Ut(n);switch(i.suggestNamespaces(n.namespaces),i.setBase(t),r){case"text/xml":case"application/rdf+xml":s=i.statementsToXML(e);break;case"text/n3":case"text/turtle":case"application/x-turtle":case"application/n3":s=i.statementsToN3(e);break;default:throw new Error("Content-type "+r+" not supported for data serialization")}return s}put(t,e,r,n){const s=this.store;let i;return Promise.resolve().then(()=>(i=this.serialize(t.value,e,r),s.fetcher.webOperation("PUT",t.value,{contentType:r,body:i}))).then(r=>{if(!r.ok)return n(t.value,r.ok,r.error,r);delete s.fetcher.nonexistent[t.value],delete s.fetcher.requested[t.value],"string"!=typeof e&&e.map(t=>{s.addStatement(t)}),n(t.value,r.ok,"",r)}).catch(e=>{n(t.value,!1,e.message)})}reload(t,e,r){var n=Date.now();t.fetcher.nowOrWhenFetched(e.value,{force:!0,noMeta:!0,clearPreviousData:!0},function(t,s,i){if(t)if(i.onErrorWasCalled||200!==i.status)r(!1,"Non-HTTP error reloading data: "+s,i);else{var a=Date.now()-n;e.reloadTimeTotal||(e.reloadTimeTotal=0),e.reloadTimeCount||(e.reloadTimeCount=0),e.reloadTimeTotal+=a,e.reloadTimeCount+=1,r(!0)}else r(!1,"Error reloading data: "+s,i)})}}const or={...Re,fetcher:(t,e)=>new rr(t,e),graph:(t=void 0,e=void 0)=>new te(t,e||{rdfFactory:Re}),lit(t,e,r){return this.literal(""+t,e||r)},st(t,e,r,n){return this.quad(t,e,r,n)}},hr=or;class lr{constructor(t,e){this.parent=t,this.via=e,this.connected=!1,this.pending={},this.subscribed={},this.socket={};try{this.socket=new WebSocket(e),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onmessage=this.onMessage,this.socket.onerror=this.onError}catch(t){this.onError(t)}}_decode(t){var e,r,n,s,i,a,o;for(r in s={},i=function(){var r,n,s,i;for(i=[],r=0,n=(s=t.split("&")).length;r<n;r++)e=s[r],i.push(e.split("="));return i}())e=i[r],o=(a=[decodeURIComponent(e[0]),decodeURIComponent(e[1])])[1],null==s[n=a[0]]&&(s[n]=[]),s[n].push(o);return s}_send(t,e,r){var n,s;return s=[t,e,r].join(" "),"function"==typeof(n=this.socket).send?n.send(s):void 0}_subscribe(t){return this._send("sub",t,""),this.subscribed[t]=!0,this.subscribed[t]}onClose(t){var e;for(e in this.connected=!1,this.subscribed)this.pending[e]=!0;return this.subscribed={},this.subscribed}onError(t){throw new Error("onError"+t)}onMessage(t){var e,r;return"ping"===(r=t.data.split(" "))[0]?"function"==typeof(e=this.socket).send?e.send("pong "+r.slice(1).join(" ")):void 0:"pub"===r[0]?this.parent.onUpdate(r[1],this._decode(r[2])):void 0}onOpen(t){var e,r;for(r in this.connected=!0,e=[],this.pending)delete this.pending[r],e.push(this._subscribe(r));return e}subscribe(t){return this.connected?this._subscribe(t):(this.pending[t]=!0,this.pending[t])}}class cr{constructor(t){this.fetcher=t,this.graph={},this.via={},this.fetcher.addCallback("headers",this.onHeaders)}onHeaders(t){var e,r,n;return null==t.headers||"undefined"==typeof WebSocket||null===WebSocket||(e=t.headers.etag,n=t.headers["updates-via"],r=t.uri,e&&n&&(this.graph[r]={etag:e,via:n},this.register(n,r))),!0}onUpdate(t,e){return this.fetcher.refresh(hr.namedNode(t))}register(t,e){return null==this.via[t]&&(this.via[t]=new lr(this,t)),this.via[t].subscribe(e)}}const ur={};for(const t in hr)"function"==typeof hr[t]&&(ur[t]=hr[t].bind(hr));const{fetcher:dr,graph:fr,lit:pr,st:mr,namedNode:wr,variable:gr,blankNode:vr,defaultGraph:br,literal:yr,quad:Tr,triple:xr}=ur,Nr=new zt,Ar=t=>Nr.fromNT(t),Cr=$t.fromValue,Or=S.nextId;class Er extends te{constructor(t){super(t),n(this,"fetcher",void 0),this.fetcher=new rr(this,{})}}class Rr extends Er{constructor(t){super(t),n(this,"updater",void 0),this.updater=new ar(this)}}})(),h})());
//# sourceMappingURL=rdflib.min.js.map